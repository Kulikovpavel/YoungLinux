<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Глава 8. Принтеры и печать</title>
    <base href="" />
    <link type="text/css" rel="stylesheet" href="http://younglinux.info/misc/print.css" />
      </head>
  <body>
              <div class="section-1">
          
    <div id="node-292" class="section-2">
  <h1 class="book-heading">Глава 8. Принтеры и печать</h1>
  <h4>Аннотация</h4>
<p>В этой главе мы узнаем о принтерах и печати файлов. После прочтения этой части, вы сможете:</p>
<ul>
<li>Оформлять документы</li>
<li>Предварительно просматривать документы перед отправкой их на принтер</li>
<li>Выбрать хороший принтер, который работает в вашей системе Linux</li>
<li>Печатать файлы и проверять состояние принтера</li>
<li>Устранять проблемы при печати</li>
<li>Находить необходимую документацию о том, как установить принтер</li>
</ul>
  <div id="node-293" class="section-3">
  <h1 class="book-heading">Печать файлов</h1>
  <p class="right">Introduction to Linux. A Hands on Guide —<br />
Введение в Linux. Руководство по работе</p>
<h3>Команда для печати</h3>
<h4>Получение файла для принтера</h4>
<p>Очень легко распечатать документ из приложения, выбрав в меню пункт <strong>Печать</strong>.</p>
<p>Для печати из командной строки используйте команду <strong>lp</strong> или <strong>lpr</strong>.<br />
<span class="mono">lp file(s)<br />
lpr file(s)<br />
</span></p>
<p>Эти команды могут читать из канала, так что вы можете распечатать вывод какой-либо команды вот так<br />
<span class="mono">command | lp</span></p>
<p>Существует множество опций, осуществляющих настройку макета страницы, установку количества копий, выбор принтер, на который вы хотите отправить печать, если у вас их больше, чем один, размер бумаги, одностороннюю или двустороннюю печать, если принтер поддерживает эту функцию, поля и т.д. Читайте man-страницы для полного обзора.</p>
<h4>Статус вашего задания на печать</h4>
<p>После того как файл принят в очередь печати, данному заданию на печать присваивается идентификационный номер:</p>
<pre>
davy:~> <strong>lp /etc/profile</strong>
request id is blob-253 (1 file(s))
</pre><p>
Для просмотра очереди печати используются команды <strong>lpq</strong> или <strong>lpstat</strong>. Когда они вводятся без аргументов, то отображается по умолчанию содержимое очереди печати.</p>
<pre>
davy:~> <strong>lpq</strong>
blob is ready and printing
Rank	Owner	Job	File(s)		Total Size
active	davy	253	profile		1024 bytes
davy:~> <strong>lpstat</strong>
blob-253	davy	1024	Tue 25 Jul 2006 10:20_01 AM CEST
</pre><h4>Статус принтера</h4>
<p>Какой принтер установлен по умолчанию в системе, которая имеет доступ к нескольким принтерам?</p>
<pre>
davy:~> <strong>lpstat -d</strong>
system default destination: blob
</pre><p>
Какой статус у моего принтера(ов)?</p>
<pre>
davy:~> <strong>lpstat -p</strong>
printer blob now printing blob-253. enabled since Jan 01 18:01
</pre><h4>Удаление заданий из очереди печати</h4>
<p>Если вам не нравится, что вы видите из состояния команд, используйте <strong>lprm</strong> или <strong>cancel</strong> для удаления заданий.</p>
<pre>
davy:~> <strong>lprm 253</strong>
</pre><p>
В графической среде вы можете увидеть всплывающее окно, сообщающее вам, что задание было отменено.</p>
<p>В больших системах <strong>lpc</strong> может быть использована для управления несколькими принтерами. Смотрите info- или man-страницы для каждой команды.</p>
<p>Существует множество GUI инструментов для печати, которые используются как интерфейс для <strong>lp</strong>, и у большинства графических приложений есть функции печати, которые используют <strong>lp</strong>. См. встроенную справку по функциям и специальную документацию к программам для получения дополнительной информации.</p>
<p class="note"><img src="../../../img/linuxintro/note.gif" alt="" /><strong> Почему существует две команды для каждой задачи, связанной с печатью?</strong><br />
Печать на UNIX и подобных системах имеет длинную историю. Когда-то использовались два весьма различных подхода: BSD-стиль печати и SystemV-стиль печати. Для совместимости Linux CUPS поддерживает команды обоих способов. Также следует отметить, что <strong>lp</strong> не ведет себя так же, как <strong>lpr</strong>, у <strong>lpq</strong> есть несколько различных опций, почти <strong>lpstat</strong> и <strong>lprm</strong>, но не совсем, как <strong>cancel</strong>. Не важно какую вы используете, просто используйте команды, которые наиболее удобный для вас, или с которыми у вас есть опыт работы в других UNIX-подобных системах.</p>
<h3>Форматирование</h3>
<h4>Инструменты и языки</h4>
<p>Если мы хотим получить что-то разумное от принтера, в первую очередь файл должен быть отформатирован. Помимо того, что существует обилие программного обеспечения для оформления, Linux поставляется с базовыми UNIX-инструментами и языками для форматирования.</p>
<p>Современные системы Linux поддерживают прямую печать, без форматирования пользователем целого ряда типов файлов: текст, PDF, PostScript и несколько графических форматов, таких как PNG, JPEG, BMP и GIF.</p>
<p>Для тех форматов файлов, которым необходимо форматирование, Linux поставляется с большим количеством соответствующих инструментов, таких как команды <strong>pdf2ps</strong>, <strong>fax2ps</strong> и <strong>a2ps</strong>, которые преобразуют другие форматов в PostScript. Эти команды могут создавать файлы, которые затем могут использоваться в других системах, в которых не установлены все инструменты для преобразования формата.</p>
<p>Помимо этих инструментов командной строки существует много графических программ для обработки текста. Доступно несколько офисных комплектов, многие из которых свободны. Они выполняют оформление автоматически после подачи задания на печать. Вот некоторые: OpenOffice.org, KOffice, AbiWord, WordPerfect и т.д.</p>
<p>Ниже приведены распространенные языки по отношению к печати:</p>
<ul>
<li><strong>groff</strong>: GNU версия команды <strong>roff</strong> UNIX. Является интерфейсом к groff-системе форматирования документов. Обычно она запускает команду <strong>troff</strong>, а для выбранного устройства назначается пост-процессор. Это позволяет создавать файлы PostScript.</li>
<li>TeX и макропакет LaTeX: один из наиболее широко используемых языков разметки в системах UNIX. Обычно вызывается как <strong>tex</strong>, который форматирует файлы и выводит соответствующее аппаратно-независимое представление набранного документа.<br />
Технические работы по-прежнему часто создаются в LaTeX из-за его поддержки математических формул, хотя усилия, чтобы включить эту функцию в другие приложениях, предпринимаются W3C (World Wide Web Consortium).</li>
<li>SGML и XML: Свободные парсеры, доступные для UNIX и Linux. XML является следующим поколением SGML, он образует основу для DocBook XML —  системы документов (эта книга написана на XML, например).</li>
</ul>
<p class="note"><img src="../../../img/linuxintro/tip.gif" alt="" /><strong> Печать документации</strong><br />
Man-страницы содержат предварительно отформатированные <strong>troff</strong> данные, которые должны быть приведены к соответствующему виду, прежде чем они могут быть распечатаны на принтере. Печать выполняется с использованием опции <span class="mono">-t</span> команды <strong>man</strong>:<br />
<span class="mono">man -t <em>command</em> > man-command.ps</span><br />
После чего распечатывается файл PostScript. Если место назначения печати настроено для вашей системы/аккаунта по умолчанию, вы можете просто выполнить команду <strong>man</strong> <span class="mono">-t <em>command</em></span> для отправки напрямую отформатированных страниц на принтер.</p>
<h4>Предварительный просмотр отформатированных файлов</h4>
<p>Все, что вы можете отправить на принтер, может с таким же успехом быть отображено на экране. В зависимости от формата файла, можно использовать одну из следующих команд:</p>
<ul>
<li>Файлы PostScript: с помощью команды <strong>gv</strong> (GhostView).</li>
<li>TeX dvi файлов: <strong>xdvi</strong>, или с помощью варианта для KDE - <strong>kdvi</strong>.</li>
<li>PDF файлы: <strong>xpdf, kpdf, gpdf</strong> или программа для просмотра Adobe, <strong>acroread</strong>, которая также доступна для бесплатного использования, но не является свободным программным обеспечением. </li>
<li>В таких приложениях как Firefox или OpenOffice обычно можно выбрать предварительный просмотр печати из меню.</li>
</ul>
  </div>
<div id="node-294" class="section-3">
  <h1 class="book-heading">Серверная сторона</h1>
  <p class="right">Introduction to Linux. A Hands on Guide —<br />
Введение в Linux. Руководство по работе</p>
<h3>Основное</h3>
<p>Когда-то выбор для пользователей Linux был прост: все использовали один и тот же старый LPD от принадлежащего BSD кода Net-2. В то время LPR был более популярным, однако в настоящее время современные дистрибутивы Linux используют CUPS, Common UNIX Printing System (общую систему печати UNIX). CUPS представляет собой реализацию Internet Printing Protocol (IPP), подобного HTTP стандарта RFC, заменяющего почтенный (и неуклюжий) протокол LPD. CUPS распространяется под GNU Public License. CUPS также является системой печати по умолчанию в MacOS X.</p>
<h3>Графическая конфигурация принтера</h3>
<p>Большинство дистрибутивов поставляются с графическим интерфейсом для настройки сетевых и локальных (через параллельный порт или USB) принтеров. Они позволяют выбрать принтер из списка и проверить его работоспособность. Вам не придется беспокоиться о содержимом и местонахождении конфигурационных файлов. Перед установкой принтера смотрите системную документацию.</p>
<p>CUPS можно также настроить с помощью веб-интерфейса, который работает на порте 631 вашего компьютера. Чтобы проверить, что такая возможность включена, попробуйте просмотреть localhost:631/help или localhost:631/.</p>
<h3>Покупка принтера для Linux</h3>
<p>Поскольку все больше и больше поставщиков принтеров делают драйверы доступными для CUPS, последний позволяет легко подключить практически любой принтер, который вы можете вставить в последовательный, параллельный или USB порт, а также любой принтер в сети. CUPS будет обеспечивать единообразное представление для вас и ваших приложений всех различных типов принтеров.</p>
<p>Принтеры, которые поставляются только с драйверами для Windows, могут вызывать проблемы, если у них нет иной поддержки.</p>
<p>В прошлом, вашим самым лучшим выбором был бы принтер с поддержкой PostScript в прошивке, так как почти все программное обеспечение для печати  UNIX или Linux производит печатную продукцию на PostScript, лучшем языке для печати на принтере. Принтеры PostScript, как правило, немного дороже, но PostScript - аппаратно-независимый, открытый язык программирования, и вы всегда на 100% уверены, что принтер с такой прошивкой будет работать. Однако в наши дни это уже почти не актуально.</p>
  </div>
<div id="node-295" class="section-3">
  <h1 class="book-heading">Проблемы печати</h1>
  <p class="right">Introduction to Linux. A Hands on Guide —<br />
Введение в Linux. Руководство по работе</p>
<p>В этом разделе мы обсудим, что может сделать пользователь, когда что-то идет не так. Мы не будем обсуждать все проблемы, имеющие отношение к демонам служб печати, так как это задача для системных администраторов.</p>
<h3>Не тот файл</h3>
<p>При печати не того файла, задание может быть отменено с помощью команды <strong>lprm</strong> <span class="monoi">jobID</span>, где jobID указывается в формате <em>printername-printjobnumber</em> (получить такую информацию можно с помощью команд <strong>lpq</strong> или <strong>lpstat</strong>). Это будет работать, когда другие задания ожидают печати в очереди этого принтера. Однако, вы должны действовать очень быстро, если единолично используете принтер, так как задания, как правило, становятся в очередь и отправляются на принтер в считанные секунды. Как только они появляются на принтере, то становится уже слишком поздно удалять задания инструментами Linux.</p>
<p>В подобных случаях, а также когда неправильно настроен драйвер печати, и выходит только какой-то мусор, вы можете попробовать выключить принтер. Однако, это может быть не лучшим путем решения проблемы, так как может привести к замятию бумаги и прочим нарушениям.</p>
<h3>Не получается распечатать</h3>
<p>С помощью команды <strong>lpq</strong> вы можете увидеть статус вашего задания:</p>
<pre>
elly:~> <strong>lpq</strong>
Printer: lp@blob
 Queue: 2 printable jobs
 Server: pid 29998 active
 Unspooler: pid 29999 active
 Status: waiting for subserver to exit at 09:43:20.699
 Rank   Owner/ID             Class Job Files          Size Time
1      elly@blob+997           A   997 (STDIN)         129 09:42:54
2      elly@blob+22            A    22 /etc/profile    917 09:43:20
</pre><p>
В наши дни многие принтеры имеют веб-интерфейсы, которые могут отображать информацию о состоянии, если ввести IP-адрес принтера в веб-браузере:<br />
<strong>Рисунок 8.1. Состояние принтера через веб-интерфейс</strong></p>
<div style="text-align:center;"><img src="../../../img/linuxintro/brother-webinterface.png" width="561" height="632" alt="Веб-интерфейс принтера в Linux" /></div>
<p class="note"><img src="../../../img/linuxintro/note.gif" alt="" /><strong> Веб-интерфейс CUPS в сравнении с веб-интерфейсом принтера</strong><br />
Заметьте, что это не веб-интерфейс CUPS и работает только для принтеров, поддерживающих такую функцию. Проверьте документацию вашего принтера.</p>
<p>Если ID вашего задания нет в системе и нет на принтере, обратитесь к системному администратору. Если ID вашего задания указан в выходных данных, убедитесь, что принтер в настоящее время печатает. Если это так, просто подождите, ваше задание будет выполнено в свое время.<br />
Если принтер не печатает, проверьте, что там есть бумага, физическое подключение к электроэнергии и сети передачи данных. Если все нормально, принтер может нуждаться в перезагрузке. Узнайте мнение системного администратора.</p>
<p>В случае сетевого принтера, попробуйте выполнить печать с другого хоста. Если принтер доступен с вашего собственного хоста (см. <a href="http://younglinux.info/#">Главу 10</a>, Сеть), вы можете попробовать отправить файл в его формате, <span class="mono">file.ps</span> в случае принтера PostScript, используя клиент FTP. Если это сработает, ваша система печати неправильно сконфигурирована. Если не сработает, возможно принтер не понимает формат, который вы ему скармливаете.</p>
  </div>
<div id="node-296" class="section-3">
  <h1 class="book-heading">Резюме</h1>
  <p class="right">Introduction to Linux. A Hands on Guide —<br />
Введение в Linux. Руководство по работе</p>
<p>Служба печати Linux поставляется с рядом инструментов, основанных на стандартных инструментах UNIX LPD, будь то варианты от SystemV или BSD. Ниже приведен список команд, связанных с печатью.</p>
<p><strong>Таблица 8.1. Новые команды в главе 8: Печать</strong></p>
<table>
<tr>
<td width="150"><strong>Команда</strong></td>
<td><strong>Значение</strong></td>
</tr>
<tr>
<td><strong>lpr</strong> или <strong>lp</strong></td>
<td>Печать файла</td>
</tr>
<tr>
<td><strong>lpq</strong> или <strong>lpstat</strong></td>
<td>Запрос очереди печати</td>
</tr>
<tr>
<td><strong>lprm</strong> или <strong>cancel</strong></td>
<td>Удаление задания на печать</td>
</tr>
<tr>
<td><strong>acroread</strong></td>
<td>Просмотр документов pdf</td>
</tr>
<tr>
<td><strong>groff</strong></td>
<td>Инструмент форматирования</td>
</tr>
<tr>
<td><strong>gv</strong></td>
<td>Просмотр файлов PostScript</td>
</tr>
<tr>
<td><strong>printconf</strong></td>
<td>Настройка принтеров</td>
</tr>
<tr>
<td><strong>xdvi</strong></td>
<td>Просмотр документов dvi</td>
</tr>
<tr>
<td><strong>xpdf</strong></td>
<td>Просмотр документов pdf</td>
</tr>
<tr>
<td><strong>*2ps</strong></td>
<td>Конвертация файлов в PostScript</td>
</tr>
</table>
  </div>
<div id="node-297" class="section-3">
  <h1 class="book-heading">Упражнения</h1>
  <p class="right">Introduction to Linux. A Hands on Guide —<br />
Введение в Linux. Руководство по работе</p>
<p>Настройка и тестирование принтеров означает быть под одним пользователем и иметь доступ к учетной записи суперпользователя. Если это так, то вы можете попробовать:</p>
<ul>
<li>Установку принтера с помощью графического интерфейса вашей системы.</li>
<li>Печать тестовой страницы с помощью GUI.</li>
<li>Печать тестовой страницы с помощью команды <strong>lp</strong>.</li>
<li>Печать из приложения, например, Mozilla или OpenOffice, выбрав <strong>Файл ? Печать</strong> в меню.</li>
<li>Отключите принтер от сети или локального компьютера/принт-сервера. Что происходит при попытке что-нибудь распечатать?</li>
</ul>
<p>Следующие упражнения можно делать без принтера или доступа к аккаунту root.</p>
<ul>
<li>Попробуйте создать файлы PostScript из различных исходных файлов (например, HTML, PDF, man-страниц). Посмотрите результат с помощью вьювера <strong>gv</strong>.</li>
<li>Убедитесь, что демон печати работает.</li>
<li>Как бы ни было попробуйте распечатать файл. Что происходит?</li>
<li>Создайте файл PostScript с помощью Mozilla. Проверьте его с помощью <strong>gv</strong>.</li>
<li>Конвертируйте его в формат PDF. Посмотрите с помощью <strong>xpdf</strong>.</li>
<li>Как бы вы распечатали файл GIF из командной строки?</li>
<li>Используйте <strong>a2ps</strong> для печати файл <span class="mono">/etc/profile</span> к выходному файлу. Проверьте опять с <strong>gv</strong>. Что произойдет, если вы не уточните выходной файл?</li>
</ul>
  </div>
</div>
    </div>
  </body>
</html>
