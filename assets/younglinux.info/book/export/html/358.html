<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Особенности языка C. Учебное пособие</title>
    <base href="" />
    <link type="text/css" rel="stylesheet" href="http://younglinux.info/misc/print.css" />
      </head>
  <body>
        
    <div id="node-358" class="section-1">
  <h1 class="book-heading">Особенности языка C. Учебное пособие</h1>
  <h3>Пояснительная записка</h3>
<p>Учебное пособие "Особенности языка <span class="blue">C</span>" представляет собой курс, состоящий из 22 занятий (каждое из которых рассчитано на 2 академических часа) и одной проверочной самостоятельной работы (на выполнение которой может быть отведено от 2 до 4 академических часов).</p>
<p>Курс предполагает, что обучающийся уже знаком с каким-либо иным языком программирования.</p>
<p>В данном учебном пособии рассматриваются отличительные особенности  программирования на языке <span class="blue">C</span>. Кроме того, уделяется внимание обработке строковых данных, структурам, динамическому типу данных, вводу из файла и выводу в него, передаче аргументов командной строки в программу, препроцессору, многофайловым программам, созданию библиотек. Почти каждый урок содержит задания в форме задач. В конце учебника приведены примеры решения части из них.</p>
<p>Рекомендуется при изучении языка C с помощью этого учебного пособия пользоваться операционной системой на базе ядра Linux.</p>
<p>Материалы, входящие в состав данного курса, распространяются на условии лицензии GNU FDL. Пособие не содержит неизменяемых разделов. Автором является С. Шапошникова (plustilino). Встречающиеся в книге названия могут являться торговыми марками соответствующих владельцев. </p>
<p>Учебное пособие "Особенности языка <span class="blue">C</span>" было опубликовано на сайте http://younglinux.info в период с января по апрель 2012 года. </p>
<table id="attachments" class="sticky-enabled">
 <thead><tr><th>Прикрепленный файл</th><th>Размер</th> </tr></thead>
<tbody>
 <tr class="odd"><td><a href="http://younglinux.info/sites/default/files/programmingC.pdf">Скачать pdf-версию учебного пособия &quot;Особенности языка C&quot;</a></td><td>902.27 кб</td> </tr>
</tbody>
</table>
  <div id="node-359" class="section-2">
  <h1 class="book-heading">Урок 0. Приступая к работе</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Предисловие</h3>
<p><span class="blue">C</span> — это достаточно "древний" язык программирования, он сформировался в начале 70-х. Не смотря на это обстоятельство, <span class="blue">C</span> — живой язык в том смысле, что он активно применяется в настоящее время. Он был придуман, использовался и используется для написания существенных частей программного кода Unix-подобных операционных систем. Также на нем пишут утилиты, компиляторы и реже прикладные программы. Поэтому <span class="blue">C</span> называют системным языком программирования. </p>
<p>Его живучесть можно объяснить тем, что принципы работы операционных систем относительно универсальны, они не подвержены тому прогрессу, который можно наблюдать в среде пользовательского ПО и Web-приложений. <span class="blue">C</span> не является языком достаточно высокого уровня, он близок к аппаратуре компьютера. В результате программы на <span class="blue">C</span> получаются относительно компактными и быстрыми. </p>
<p><span class="blue">C</span> не поддерживает объектно-ориентированного программирования. Поддержка ООП реализована в <span class="blue">C++</span>. Хотя последний возник на основе языка <span class="blue">C</span>, он не является его "продолжением", а представляет собой отдельный язык, который можно изучать, не зная <span class="blue">C</span>. Однако, на мой взгляд, изучение <span class="blue">C</span> будет полезно перед знакомством с его "продвинутым младшим братом", т.к. синтаксис языков похож, <span class="blue">C</span> не перегружает мозг начинающего программиста сверхвозможностями и приучает к пониманию сути происходящего.</p>
<p>Подходит ли <span class="blue">C</span> для первого знакомства с программированием? По моему скромному мнению, нет. Особенно, если первое знакомство происходит в школьном возрасте. Нельзя сказать, что синтаксис <span class="blue">C</span> сложнее, чем у <span class="blue">Pascal</span>. Но в языке <span class="blue">C</span> многое делается с помощью указателей, они играют здесь ключевую роль; а эта тема достаточно сложная для понимания и почти не изучается в школе. <span class="blue">C</span> предполагает более глубокое знание основ работы компьютера. Конечно, можно изучать программирование с использованием <span class="blue">C</span> и не изучать при этом указатели. Однако получится какое-то урезанное изучение. Получится, что человек будет думать, что знает <span class="blue">C</span>, почти ничего о нем не зная. <span class="blue">C</span> был придуман серьезными бородатыми людьми для написания серьезной программы — операционной системы UNIX. Он не был придуман для обучения начинающих, которые не всегда могут отличить ветвление от цикла. </p>
<p>Поэтому это пособие посвящается тем, для кого <span class="blue">C</span> как минимум второй изучаемый язык программирования, и они как минимум представляют себе, что такое переменная, ветвление, цикл, функция, тип данных, массив. Если вы знакомы только с языком <span class="blue">Python</span>, в котором нет массивов, это не страшно. Массивы очень похожи на списки, за одним существенным исключением. В одном python-списке элементы могут быть как одного так и различного типа, а массив всегда содержит элементы одного и того же типа. </p>
<p>С другой стороны курс "читается" для школьников, возможно с ним познакомятся и их учителя, поэтому стиль изложения адаптирован для соответствующей аудитории.</p>
<p>В результате изучения данного курса вы не познакомитесь с реальными примерами практического использования языка <span class="blue">C</span>, не научитесь решать сложные логические задачи типа олимпиадных. Вы просто будете знать особенности <span class="blue">C</span>. Это не так уж мало. На момент написания этого урока предполагается, что курс будет включать примерно 25 уроков.</p>
<h3>Литература</h3>
<p>Перед тем как приступить к созданию этого курса мной были прочитаны, пролистаны и просмотрены следующие источники:</p>
<ol>
<li>Б. Керниган, Д. Ритчи. Язык программирования C. Второе издание. - М.: "Вильямс", 2008. - 304 с.</li>
<li>X. Дейтел, П. Дейтел. Как программировать на C. </li>
<li>Н.А. Калинина, Н.И. Костюкова. Основы программирования на языке C. (intuit.ru/department/pl/c/)</li>
<li>К.Ю. Поляков. Язык программирования Си. Практический курс. (kpolyakov.narod.ru/school/c.htm)</li>
<li>Н.Н. Иванов. Программирование в Linux. Самоучитель. - СПб.: БХВ-Петербург, 2007. - 416 с. </li>
<li>Wikipedia.org</li>
</ol>
<p>Несколько слов по поводу указанных источников. Более тщательно был изучен первый, остальные достаточно поверхностно. В книге K&amp;R встречается использование конструкций и понятий языка до того, как они будут объяснены. Начиная где-то с главы 3, примеры  достаточно сложные и объёмные. Сами авторы в начале издания говорят о том, что они пытаются показать реальные примеры и стиль программирования на <span class="blue">C</span>. В данном пособии примеры будут простыми, целью их будет демонстрация понятий компьютерной науки, программирования, языка <span class="blue">C</span>, а не реализация логики решения задач, имеющих практическое значение.</p>
<p>Книга Дейтелов включает описание не только языка <span class="blue">C</span>, но и <span class="blue">C++</span> (начиная примерно с 15 главы). Данное пособие, на мой взгляд, лучше других подходит для самообразования. Содержит целостные примеры, много заданий, предупреждения о возможных ошибках и советы. Материал расчитан на людей, которые только начинают изучать программирование.</p>
<p>Курс Калининой-Костюковой содержит некоторые "архаизмы" (то, как там объявляются переменные в функциях), когда доходит до сложного, то краткие ясные и подробно разобранные примеры отсутствуют, в одном примере используется оператор <span class="geshifilter"><code class="c geshifilter-c">new</code></span> языка <span class="blue">C++</span> и тут же функция <span class="geshifilter"><code class="c geshifilter-c">malloc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> языка <span class="blue">C</span>, что странно, учитывая, что <span class="geshifilter"><code class="c geshifilter-c">new</code></span> до этого не упоминается. В остальном в курсе достаточно подробно разобраны основы языка <span class="blue">С</span>. В следствие чего, читается он легче K&amp;R.</p>
<p>Курс господина Полякова, на наш взгляд, является прежде всего курсом по алгоритмике и решению задач, в нем достаточно подробно разобраны массивы и сортировки. При работе с динамическими структурами используется язык <span class="blue">C++</span>. Курс понравился своей ясностью, четкостью и наглядностью. В свете "лицензионного соглашения", приведенного на странице курса Полякова, обещаю проследить, чтобы примеры, а также имена переменных из моего пособия не совпадали с теми, которые используются в его. Однако оттуда была сперта идея использовать в Windows среду программирования Dev-C++, которая является СПО и скачать ее можно с сайта разработчика: bloodshed.net.</p>
<p>Самоучитель Н. Иванова помог понять, как собираются многофайловые программы и используются библиотеки. Википедии использовалась для поиска дополнительной информации.</p>
<h3>Какими программами пользоваться в GNU/Linux и Windows</h3>
<p>Я предпочитаю GNU/Linux, Vim и GCC. Однако, если вас пугает Vim, то можете использовать любой текстовый редактор с подсветкой синтаксиса (например, KWrite). В таком случае в GNU/Linux у вас должны быть постоянно открытыми два окна: редактор и Консоль (оно же Терминал). В одном вы редактируете исходный код программы, в другом — даете команды. (Это наиболее удобный вариант, особенно при обучении в группе или классе.)</p>
<p><img src="../../../img/c/kwrite-terminal.png" width="650" height="259" alt="Среда программирования в GNU/Linux" /></p>
<p>У вас может быть открыто всего одно окно, если вы будете использовать Vim, т.к. он позволяет отдавать команды оболочке Bash из самого редактора. Не рекомендую пользоваться какими либо средами разработки, которые при сохранении файла создают "левые" дополнительные файлы. При обучении все должно быть ясно и просто.</p>
<p>Если вы не знакомы с Vim, но решили его попробовать, то после установки этого редактора, выполните в Bash команду <span class="geshifilter"><code class="python geshifilter-python">vimtutor</code></span>. Запустится самоучитель по Vim, у меня в Ubuntu он на русском языке. Данный учебник "проходится" как интересная игра. Конечно не за обещанные 25-30 минут, но за пару часов вы освоитесь в Vim, так что сможете в нем писать программы. В принципе для более-менее комфортной работы вам будет достаточно запомнить следующие команды Vim:<br />
<span class="geshifilter"><code class="python geshifilter-python">dd</code></span> – удалить строку и поместить ее в буфер;<br />
<span class="geshifilter"><code class="python geshifilter-python">yy</code></span> – скопировать строку в буфер, <span class="geshifilter"><code class="python geshifilter-python">2yy</code></span> – скопировать две строки (число может быть любым);<br />
<span class="geshifilter"><code class="python geshifilter-python">p</code></span> — вставить объект из буфера.</p>
<p><span class="blue">C</span> – компилируемый язык программирования. В GNU/Linux для получения исполняемых файлов используется GCC. Об этом инструменте можете прочитать в Википедии или других источниках. Сейчас вам надо запомнить следующее. Чтобы из исходного файла (будем приписывать к названиям таких файлов расширение <span class="monoi">*.с</span>) получить исполняемый файл, надо выполнить в оболочке Bash команду примерно следующего вида:</p>
<pre>gcc -o hello hello.c</pre><p>, где <span class="geshifilter"><code class="python geshifilter-python">gcc</code></span> — команда, запускающая программу, выполняющую компиляцию и иные действия; <span class="geshifilter"><code class="python geshifilter-python">-o</code></span> – ключ, сообщающий, что мы вручную указываем имя исполняемого файла; <span class="geshifilter"><code class="python geshifilter-python">hello</code></span> – имя исполняемого файла; <span class="geshifilter"><code class="python geshifilter-python">hello.<span style="color: black;">c</span></code></span> – имя файла с исходным кодом.</p>
<p>Вот как примерно работаю в GNU/Linux я при написании маленьких программ на <span class="blue">C</span>:<br />
1. Открываю Терминал.<br />
2. С помощью команды <span class="geshifilter"><code class="python geshifilter-python"><span style="color: #dc143c;">cd</span></code></span> перехожу в каталог, где собираюсь сохранять файлы.<br />
3. Запускаю Vim, передав в качестве параметра имя файла:</p>
<pre>vim hello.c</pre><p>4. Редактирую файл (i), сохраняю его (Esc->:w).<br />
5. Не выходя из Vim, в командной строке редактора даю команду на компиляцию (обратите внимание на восклицательный знак, он означает, что команда не для Vim, а для Bash):</p>
<pre>:!gcc -o hello hello.c</pre><p>6. Запускаю исполняемый файл (комбинация символов ./ обозначает текущий каталог):</p>
<pre>:!./hello</pre><p>7. Следует заметить, что после проставления двоеточия в командной строке Vim работает прокрутка истории команд, что удобно, если файл часто редактируется и снова компилируется.</p>
<p>Если вы будете работать в обычном текстовом редакторе, то в Терминале не забудьте перейти в каталог, где сохранен файл с исходным кодом.</p>
<p>В Windows можете использовать среду Dev-C++. При сохранении выбирайте тип файла "C source files (*.c)". Компиляция и запуск программы выполняется при нажатии клавиши F9. После исполнения программа сразу закрывается и результат невозможно увидеть. Чтобы этого не происходило прописывают лишние две строки (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#include &lt;conio.h&gt;</span></code></span>, <span class="geshifilter"><code class="c geshifilter-c">getch<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>).</p>
<table>
<tr>
<th>"Hello World" в GNU/Linux</th>
<th>"Hello World" в Windows</th>
</tr>
<tr>
<td>
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066;">printf</span> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Hello World<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div>
</td>
<td>
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;conio.h&gt;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066;">printf</span> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Hello World<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	getch<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div>
</td>
</tr>
</table>
<h3>Разбор "Hello World"</h3>
<p>Сразу отметим некоторые особенности языка программирования C.</p>
<p>Можно было бы сказать, что в языке <span class="blue">C</span> роль основной ветки программы берет на себя функция <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Эта функция всегда должна присутствовать в законченной программе на языке <span class="blue">C</span>, и исполнение программы начинается именно с нее. Однако объявленные внутри нее переменные не являются глобальными, а их область видимости простирается только на <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Тем не менее в языке программирования <span class="blue">C</span> почти весь программный код заключается в функции, и функция <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> является главной и обязательной.</p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> предназначена для вывода данных. Ее назначение аналогично процедуре <span class="geshifilter"><code class="python geshifilter-python">write<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></code></span> языка <span class="blue">Pascal</span> и функции <span class="geshifilter"><code class="python geshifilter-python"><span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></code></span> в <span class="blue">Python</span>. Функция <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> не создает новую строку после своего исполнения. Поэтому для перехода на новую строку используется специальный символ, который обозначается комбинацией \n. Законченные выражения на языке <span class="blue">C</span> разделяются точкой с запятой.</p>
<p>В <span class="blue">C</span> функции ввода-вывода не являются частью языка. Например, в <span class="blue">Python</span> нам ничего не надо дополнительно присоединять к файлу, чтобы пользоваться функциями <span class="geshifilter"><code class="python geshifilter-python"><span style="color: #ff7700;font-weight:bold;">print</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></code></span> и <span class="geshifilter"><code class="python geshifilter-python"><span style="color: #008000;">input</span><span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></code></span>. В C же мы не можем просто вызвать функцию <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, т.к. в самом <span class="blue">C</span> ее просто нет. Эту функцию, а также ряд других, можно подключить с помощью заголовочного файла stdio.h. Именно для этого в начале программы прописана строка <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#include &lt;stdio.h&gt;</span></code></span>. Include с английского переводится как "включить", а stdio есть сокращение от "стандартный ввод-вывод (input-output)".</p>
<p>В заголовочных файлах (они оканчиваются на <span class="monoi">*.h</span>) обычно содержаться объявления тех или иных функций. Объявление — это просто описание функции: какие параметры она принимает и что возвращает. Сам код функции (определение) находится не в заголовочном файле, а в библиотеках (других файлах), которые могут быть уже скомпилированы и расположены в системных каталогах. Перед компиляцией программы запускается препроцессор языка <span class="blue">C</span>. Помимо прочего он включает в начало файла программы содержимое указанных в ней заголовочных файлов.</p>
<h3>Задание</h3>
<p>Удалите (или закомментируйте<sup>1</sup>) первую строчку кода, после этого попробуйте  скомпилировать программу. Какие сообщения вы получили?</p>
<p><span class="mono"><sup>1</sup> // - однострочный комментарий на языке C; /* … */ - "универсальный" комментарий на языке C. </span></p>
  </div>
<div id="node-361" class="section-2">
  <h1 class="book-heading">Урок 1. Типы данных и их вывод</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Эта тема не так проста как кажется. Точнее она проста, но достаточно объемна по количеству информации. Лучше в ней разобраться до конца и запомнить некоторые вещи наизусть.</p>
<p>На этом уроке мы познакомимся с особенностями функции <span class="geshifilter"><code class="python geshifilter-python">printf<span style="color: black;">&#40;</span><span style="color: black;">&#41;</span></code></span> и типами данных: целыми и вещественными числами, символами, массивами и строками. Это далеко не все допустимые в <span class="blue">C</span> типы. Есть еще указатели, структуры, объединения, перечисления, также в <span class="blue">C</span> существует возможность определять собственные типы данных.</p>
<h3>Функция printf() и форматированный вывод</h3>
<p>Вывод символов на экран, а точнее в стандартный поток вывода, осуществляется в языке <span class="blue">C</span> помощью функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Эта функция выводит на экран строку, переданную первым аргументом, предварительно заменив в ней специальные комбинации символов преобразованными в символы данными, переданными последующими аргументами. Следующие после первой строки данные могут быть строками, символами, целыми или вещественными числами, а также указателями. У каждого типа данных имеется свое обозначение — своя спецификация формата. </p>
<p>На прошлом уроке мы выводили строку "Hello World" вот так:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Hello World<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span><br />
Однако то же самое можно было получить так:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;Hello World&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span><br />
Здесь <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>s</code></span> — это спецификация строкового формата, т.е. вместо <span class="geshifilter"><code class="python geshifilter-python"><span style="color: #66cc66;">%</span>s</code></span> будет подставлены последующие переданные в функцию данные, которые должны быть строкой. Вывод целого числа может выглядеть так:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> 5<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span><br />
Вместо числа 5 может стоять переменная целочисленного типа. Функция <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> может принимать произвольное число параметров:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %s, %d %s.<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;dogs&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;cats&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span><br />
При выводе данные подставляются по очередности следования: 3 на место первой спецификации, dogs на место второй и т.д. Т.е. следует строго соблюдать соответствие форматов и последующих данных.</p>
<p>Под выводимые данные можно выделять больше знакомест, чем необходимо. Для этого между знаком % и буквой формата прописывается целое число, обозначающие ширину поля, например так: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>10d</code></span>. По умолчанию выравнивание происходит по правому краю. Для выравнивания по левому краю перед числом ставится знак минус.</p>
<p><span class="blue"><strong>Задание</strong><br />
<img src="../../../img/c/printf.png" width="204" height="160" alt="Функция printf()" style="float:left;" />Напишите программу, которая выводила бы на экране данные примерно так, как на картинке. При этом используйте возможность задать ширину поля, а также выравнивание по левому и правому краям.</span><br />
<br /><br /></p>
<h3>Целые числа</h3>
<p>В языке <span class="blue">C</span> существует несколько типов целых чисел. Они различаются между собой объемом памяти, отводимым под переменную, а также возможностью присваивания положительных и отрицательных чисел. От объема памяти, т.е. от количества выделяемых байтов под переменную, зависит, каким может быть максимально возможное число, записанное в данную переменную. Так, если под переменную выделяется 2 байта и ей можно присваивать только положительные числа, то эти числа будут в диапазоне от 0 до 65535. (Если вы не знаете, почему это так, то спросите.)</p>
<p>Чаще всего используется тип <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span>. Вот пример, где происходит объявление и определение (присваивание значений) целочисленных переменных, а также вывод их значений на экран:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> lines<span style="color: #339933;">,</span> i<span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> count <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
&nbsp;
  lines <span style="color: #339933;">=</span> <span style="color: #0000dd;">100</span><span style="color: #339933;">;</span>
  i <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%5d %5d %5d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">,</span> count<span style="color: #339933;">+</span>10<span style="color: #339933;">,</span> lines<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Обратите внимание, что присваивать значение можно при объявлении переменных.</p>
<p><span class="blue"><strong>Задание</strong><br />
Обычно под переменную типа int отводится 4 байта. Определите (узнайте, вспомните) максимально и минимально возможные значения для переменных такого типа. Объявите в программе переменную max типа int и присвойте ей значение на единицу больше максимально допустимого. Запрограммируйте вывод значения переменной на экран. Скомпилируйте программу и запустите. Чему равна переменная? Почему?</span></p>
<p><span class="blue">Что будет, если переменной присвоить значение на единицу меньше минимально допустимого ее типом?</span></p>
<p>Помимо типа <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span> в языке программирования <span class="blue">C</span> существуют другие (модифицированные) целочисленные типы: </p>
<ul>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">short</span></code></span> — отводится меньше байтов, чем на <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span>;</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">long</span></code></span> — отводится больше байтов, чем на <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span> (не всегда, зависит от системы);</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">unsigned</span></code></span> — столько же байт как у <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span>, но без отрицательных чисел; в результате чего знаковый разряд освобождается, и количество положительных значений увеличивается;</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">unsigned</span> shot</code></span>;</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">unsigned</span> <span style="color: #993333;">long</span></code></span>.</li>
</ul>
<p>Вот по-моему и все. При выводе длинных чисел следует дополнять спецификацию формата буквой l перед буквой формата. Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%ld<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%15ld<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<h3>Символы </h3>
<p>Под символьный тип данных отводится 1 байт памяти. Также, как вам должно быть известно, у каждого символа есть соответствующее ему целое число по таблице символов (в данном случае, ASCII). </p>
<p>Тип <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span></code></span> языка программирования <span class="blue">C</span> включает диапазон чисел от -128 до 127. Значения от 0 до 127 могут быть заданы или выведены на экран в виде соответствующих символов (на самом деле не все). Если значение переменной определяется в виде символа, то символ заключается в одиночные кавычки, например, так: 'w'. Также в языке существует тип <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span></code></span> с диапазоном чисел от 0 до 255.</p>
<p>С другой стороны, если переменная задана как <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">short</span></code></span> и ей присвоено значение в диапазоне, где оно может быть представлено символом, то значение можно вывести как символ. Соответственно целочисленной переменной можно присвоить символ.</p>
<p>Если в программе вы будете использовать целые числа со значениями до 127 или 255 и  хотите сэкономить память, то объявите переменную как <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span></code></span>.</p>
<p>Получается, что в программе символы — это числа, а числа — символы. Тогда как указать, что мы хотим видеть на экране: символ или число? Для вывода на экран символов используется спецификация формата вида <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>c</code></span>.</p>
<p><span class="blue"><strong>Задание</strong><br />
Спишите программу представленную ниже. Выполните ее, объясните результат. Самостоятельно поэкспериментируйте, изменяя значения переменных и их тип.</span><br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">char</span> ch <span style="color: #339933;">=</span> <span style="color: #0000dd;">63</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> uch <span style="color: #339933;">=</span> <span style="color: #ff0000;">'r'</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">short</span> j <span style="color: #339933;">=</span> <span style="color: #ff0000;">'b'</span><span style="color: #339933;">,</span> k <span style="color: #339933;">=</span> <span style="color: #0000dd;">99</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c == %d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> ch<span style="color: #339933;">,</span> ch<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c == %d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> uch<span style="color: #339933;">,</span> uch<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c, %c<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> j<span style="color: #339933;">,</span> k<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<h3>Вещественные числа</h3>
<p>В языке <span class="blue">C</span> существует три типа чисел с плавающей точкой: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">float</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">double</span></code></span> (двойной точности) и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">long</span> <span style="color: #993333;">double</span></code></span>. Также существует три формата вывода вещественных чисел, причем они не связаны с типом, а связаны с удобством представления числа. Вещественные числа могут иметь высокую точность, очень маленькое или очень большое значение. Если выполнить функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> с такими параметрами:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">double</span> a <span style="color: #339933;">=</span> <span style="color:#800080;">0.0005</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%g<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> 0.0005<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%g<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> 0.00005<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%e<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> 0.0005<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>, то на экране мы увидим следующее:</p>
<pre>
0.000500 
0.0005 
5e-05 
5.000000e-04 
</pre><p>
В первом случае (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>f</code></span>) выводится число в обычном виде. По умолчанию точность представления числа равна шести знакам после точки. </p>
<p>Во втором случае (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>g</code></span>) число выводится как обычно, если количество значащих нулей не больше четырех. Если количество значащих нулей четыре и больше, то число выводится в нормализованном виде (третий случай). Запись 5e-5 означает 5 * 10<sup>-5</sup>, что равно 0.00005. А, например, запись 4.325e+3 является экспоненциальной записью 4.325 * 10<sup>3</sup>, что равно 4325. Если с такой формой представления чисел вы сталкиваетесь первый раз, то почитайте дополнительные источники, например, статью в Википедии "Экспоненциальная запись".</p>
<p>Четвертый формат (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>e</code></span>) выведет число исключительно в нормализованном виде, каким бы это вещественное число ни было.</p>
<p>Если при выводе требуется округлить число до определенной точности, то перед буквой-форматом ставят точку и число-указатель точности. Например, <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%.2f&quot;</span><span style="color: #339933;">,</span> <span style="color:#800080;">0.23</span><span style="color: #009900;">&#41;</span></code></span> выведет на экран 0.23, а не 0.230000. Когда требуется указать еще и поле, то его ширину прописывают перед точкой, например, <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span><span style="color:#800080;">10.3f</span></code></span>.</p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите программу, в которой должны быть две переменные любых вещественных типов. Одной переменной присвойте достаточно маленькое, а другой — большое значение. Выведите на экран значения этих переменных с использованием различных форматов. При использовании форматов <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>f</code></span> и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>e</code></span> округлите числа до трех знаков после точки.</span></p>
<h3>Массивы</h3>
<p>Переменные, содержащие массивы, в языке программирования <span class="blue">C</span> объявляются, например, так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> arr<span style="color: #009900;">&#91;</span>5<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> nums<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> f_arr<span style="color: #009900;">&#91;</span>100<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span>80<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></pre></div></p>
<p>При этом если используется константа, то она должна быть определена до своего использования следующим образом (чаще константы определяют вне функций):<br />
<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#define N 100</span></code></span></p>
<p>На самом деле <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#define</span></code></span> является командой препроцессора, используемой не только для определения констант. Когда препроцессор обрабатывает исходный файл программы, он подставляет во все места, где была упомянута константа ее значение.</p>
<p>Запомните, индексация массивов в языке программирования C начинается с нуля.</p>
<p>Присваивание значений элементам массивов можно произвести сразу или в процессе выполнения программы. Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">char</span> vowels<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #ff0000;">'a'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'e'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'i'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'o'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'u'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'y'</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> f_arr<span style="color: #009900;">&#91;</span>6<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
  f_arr<span style="color: #009900;">&#91;</span>0<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color:#800080;">25.3</span><span style="color: #339933;">;</span>
  f_arr<span style="color: #009900;">&#91;</span>4<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color:#800080;">34.2</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c, %.2f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> vowels<span style="color: #009900;">&#91;</span>4<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> f_arr<span style="color: #009900;">&#91;</span>0<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Когда переменная-массив объявляется и сразу определяется (как в случае <span class="monoi">vowels</span>), то размер массива можно не указывать, т.к. он вычисляется по количеству элементов, переданных в фигурных скобках.</p>
<h3>Строки</h3>
<p>В языке программирования <span class="blue">С</span> нет такого типа данных как строки, хотя формат вывода строки есть (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>s</code></span>). Под словами "нет такого типа данных" я подразумеваю отсутствие специального ключевого слова, которое бы определяло переменную строкового типа (по аналогии с переменными типа <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">float</span></code></span>). Строки в языке программирования <span class="blue">C</span> интерпретируются как массивы символов, последний элемент которых является самым первым (с номером 0) символом в таблице ASCII. В этом месте в таблице стоит "ничто", имеющее символьное обозначение '\0'. </p>
<p>С другой стороны, строки — это необычные массивы в том смысле, что работа с ними в языке программирования <span class="blue">C</span> несколько отличается от работы с числовыми массивами. В этом мы убедимся позже. </p>
<p>Выше мы объявили и определили массив <span class="monoi">vowels</span>. Если бы мы его определили вот так:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; <span style="color: #993333;">char</span> vowels<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #ff0000;">'a'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'e'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'i'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'o'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'u'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'y'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span></code></span><br />
или так:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; <span style="color: #993333;">char</span> vowels1<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;aeiouy&quot;</span><span style="color: #339933;">;</span></code></span><br />
то он бы был строкой. Во втором случае сами двойные кавычки "говорят" что это строка, и символ окончания строки '\0' записывается в память. </p>
<p>Массивы символов можно выводить на экран просто указав имя переменной, а вот с массивами чисел такой номер не пройдет:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> vowels<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> f_arr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// ошибка</span></pre></div></p>
<h3>Функция sizeof()</h3>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> языка <span class="blue">C</span> принимает в качестве аргумента константу, тип данных или переменную и возвращает количество байт, которые отведено под этот объект в памяти ЭВМ. </p>
<p>При выводе на экран значения, возвращаемого <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> используется формат <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>lu</code></span> (длинное целое без знака). Примеры:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a <span style="color: #339933;">=</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> b<span style="color: #009900;">&#91;</span>100<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Integer: %lu <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Float: %lu <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #993333;">float</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Array of 100 integers: %lu <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span>b<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите программу, выводящую информацию о количестве байтов, отводимых в памяти под типы данных, которые были изучены на данном уроке. При работе с массивами символов, определенными строковыми константами (в двойных кавычках), обратите внимание, что размер массива больше на единицу, чем количество видимых символов. Вспомните, почему?</span> </p>
<p><span class="blue">Если у вас на компьютере есть вторая операционная система, то скомпилируйте программу и там; сравните полученные результаты. Вот что получилось у меня в результате компиляции с помощью GCC в Xubuntu и Fedora:</span></p>
<div style="text-align:center;"><img src="../../../img/c/ubuntu_fedora.png" width="630" height="350" alt="Результат выполнения программы на C в Ubuntu и Fedora" /></div>
  </div>
<div id="node-362" class="section-2">
  <h1 class="book-heading">Урок 2. Символьный тип данных. Специальные символы</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Этот урок будет совсем небольшим по количеству теории. Здесь мы более подробно рассмотрим символьный тип данных.</p>
<p>По таблице ASCII символы с номерами (кодами) от 0 до 127 жестко определены. В этом диапазоне номера присвоены символам цифр, латинским (английским) маленьким и большим буквам, а также используемым в языке иным символам ('!', '%', '~' и т.п.). Здесь же заданы коды для различных управляющих символов, которые никак не экране не отображаются, а что-то делают (например, создают новою строку или отступ, подают звуковой сигнал и др.). Расширенная таблица ASCII кодирует символы национальных алфавитов (например, русского языка) числами лежащими в диапазоне от 128 до 255. </p>
<p>Символы цифр от '0' до '9' имеют последовательные коды от 48 до 57. Этот факт обычно используют, при "переводе" символов цифр в числа. Если мы знаем, что у '0' код 48, а был задан символ '5', имеющий код 53, то если вычесть из 53 число 48, получим число 5. Знание кодов символов цифр позволяет программировать извлечение чисел из текста. </p>
<p>Английские большие буквы (прописные) имеют последовательные коды от 65 (A) до 90 (Z), маленькие (строчные) — от 97 до 122.</p>
<p><strong><span class="blue">Задания</span></strong></p>
<ol>
<li><span class="blue">Напишите программу, в которой объявлены только две переменные символьного типа. Одной переменной присвоен, например, символ '4', а второй — '7'. Функция <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> должна выводить на экран разность и сумму чисел, которые были представлены символами и присвоены переменным. (Подсказка: все вычисления для получения результата следует выполнять непосредственно в выражении, которое будет являться одним из параметром функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>.)</span></li>
<li><span class="blue">Переменная <span class="monoi">not_num</span> содержит строку из трех символов-цифр, например "528". Необходимо получить из этой строки соответствующее ему число и присвоить его переменной <span class="monoi">num</span>. Вывести на экран результат выражения <span class="geshifilter"><code class="c geshifilter-c">num – <span style="color: #0000dd;">10</span></code></span>. (Подсказка: строка — это массив символов, следовательно, вы можете извлекать символы цифр по их индексам; при вычислении числа первый символ массива, преобразованный в число, будет означать количество сотен, второй — десятков, а третий — единиц.)</span></li>
<li><span class="blue">Известно, что символ A английского алфавита имеет код 65. Напишите программу, определяющую какие символы в этом алфавите стоят на 5, 12 и 19 местах.</span></li>
</ol>
<h3>Специальные символы</h3>
<p>Специальные символы в программном коде обозначаются двумя символами, т.к. одним их обычно обозначить невозможно. Но по сути представляют собой один символ. Например, букву 'a' можно обозначить одним символом, а как обозначить символ создания новой строки, если ему не соответствует ни один знак? Приходится выкручиваться и представлять такой неординарный символ комбинацией пары других символов: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span></code></span>. Помните при этом, что на самом деле это всего лишь один символ.<br />
Ниже перечислен ряд управляющих символов (не все) и то, что они делают:</p>
<ul>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span></code></span> — создание новой строки и переход на нее;</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\t</span>'</span></code></span> — табуляция (отступ в несколько пробелов);</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\r</span>'</span></code></span> — возврат каретки (перевод курсора в первую позицию текущей строки);</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\b</span>'</span></code></span> — возврат курсора на один символ назад с удалением этого символа.</li>
</ul>
<p>В программном коде, помимо управляющих, специальными символами могут записываться некоторые вполне обычные символы, такие как кавычки, одиночные кавычки, обратная косая черта и др. Некоторые из этих символов можно задать одним символом в одиночных кавычках. Но многие из них невозможно вставить просто так внутрь строки, т.к. они что-то значат с точки зрения синтаксиса языка. Например, обратная косая черта в строке сообщает, что начинается обозначение специального символа, двойная кавычка обозначает начало или конец строки. Поэтому такие символы также обозначаются парной комбинацией других символов:</p>
<ul>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\\</span>'</span></code></span> — обратный косая черта;</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\'</span>'</span></code></span> — одиночная кавычка;</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\&quot;</span>'</span></code></span> — двойная кавычка (не в строке можно просто <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'&quot;'</span></code></span>);</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span></code></span> — пустота, символ с кодом 0 по таблице ASCII.</li>
</ul>
<p><strong><span class="blue">Задания</span></strong></p>
<ol>
<li><span class="blue">Напишите программу, в которой бы использовалась табуляция, вывод на экран строки в двойных кавычках, в одиночных кавычках (апострофах), затирание предыдущего символа и возврат каретки (для последних двух случаев, чтобы увидеть результат, управляющие символы надо вставить внутрь строки). Проверьте, как выводится на экран строка, если в ее середине стоит нулевой символ.</span></li>
<li><span class="blue">Выведите на экран символьное обозначение управляющих символов и их номера по таблице ASCII. Пример вывода:</span><br />
<pre>
\n - 10
\t - 9
\b - 8
\r - 13 
</pre></li>
<li><span class="blue">Выясните экспериментальным путем, как вывести на экран символ %. (Существует два способа.)</span></li>
</ol>
  </div>
<div id="node-363" class="section-2">
  <h1 class="book-heading">Урок 3. Операторы ветвления</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>if-else</h3>
<p>В языке программирования <span class="blue">C</span> синтаксис оператора ветвления <span class="geshifilter"><code class="c geshifilter-c">if<span style="color: #339933;">-</span><span style="color: #b1b100;">else</span></code></span> выглядит так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>логич_выражение<span style="color: #009900;">&#41;</span> 
	выражение<span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
<span style="color: #b1b100;">else</span> 
	выражение<span style="color: #0000dd;">2</span><span style="color: #339933;">;</span></pre></div></p>
<p>Как и в других языках ветка <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span> не является обязательной.</p>
<p>В языке <span class="blue">С</span> в простых логических выражениях используются следующие знаки операторов: >, &lt;, >=, &lt;=, ==, !=.</p>
<p>В случае если тело той или иной ветки состоит из нескольких законченных выражений, разделяемых точкой с запятой, то тело заключается в фигурные скобки:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>логич_выражение<span style="color: #009900;">&#41;</span>  <span style="color: #009900;">&#123;</span>
	выражение<span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
	выражение<span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
	…
<span style="color: #009900;">&#125;</span>
<span style="color: #b1b100;">else</span> <span style="color: #009900;">&#123;</span>
	выражениеN<span style="color: #339933;">;</span>
	…
<span style="color: #009900;">&#125;</span></pre></div></p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите любую программу на языке C, в которой бы использовалась конструкция <span class="geshifilter"><code class="c geshifilter-c">if<span style="color: #339933;">-</span><span style="color: #b1b100;">else</span></code></span>.</span></p>
<p>В <span class="blue">C</span> можно использовать вложенные конструкции <span class="geshifilter"><code class="c geshifilter-c">if<span style="color: #339933;">-</span><span style="color: #b1b100;">else</span></code></span>. При этом рекомендуют вкладывать во внешнюю ветку <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span>, а не <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>, т.к. это позволяет избегать неоднозначности толкования инструкции. Посмотрите на такую конструкцию:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
		…<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">else</span>
		…<span style="color: #339933;">;</span>
<span style="color: #b1b100;">else</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
		…<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">else</span>
		…<span style="color: #339933;">;</span></pre></div></p>
<p>Для более легкого восприятия человеком отступами подчеркнуто, что куда вложено. Однако для компилятора с языка <span class="blue">C</span> отступы никакой роли не играют, и принадлежность первой ветки <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span> не очевидна. Ее можно было бы ошибочно отнести к первому <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>, в результате чего второе <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span> было бы вообще неуместным, т.к. не относилось бы ни к какому <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>. В данном случае такой ошибки не будет, т.к. компилятор руководствуется правилом: ветка <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span> относится к ближайшему к ней сверху <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>, у которого еще нет ветки <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span>. Именно поэтому здесь первое <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span> относится ко второму <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span> (т.к. оно к нему ближе), а второе <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span> к первому <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>, т.к. второе <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span> уже "покрыто" предыдущим <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span>. Теперь посмотрите вот на такую конструкцию:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
		….<span style="color: #339933;">;</span>
<span style="color: #b1b100;">else</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
		….<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">else</span>
		….<span style="color: #339933;">;</span>
<span style="color: #339933;">&lt;</span>c<span style="color: #339933;">&gt;</span>
Программист отступами показал<span style="color: #339933;">,</span> что он хочет<span style="color: #339933;">,</span> чтобы первое <span style="color: #339933;">&lt;</span>c<span style="color: #339933;">&gt;</span>else</pre></div> относилось к внешнему <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>. Однако компилятор, руководствуясь правилом отнесения веток <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span>, расценит программу вот так (если перевести на удобство чтения ее программистом):<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
		….<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">else</span>
		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
			….<span style="color: #339933;">;</span>
		<span style="color: #b1b100;">else</span>
			….<span style="color: #339933;">;</span></pre></div></p>
<p>При этом программа будет делать не то, что хотел программист: если в  выражении при первом <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span> будет возвращаться ложь, то ни один <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">else</span></code></span> просто не сработает. Однако в таких сложных случаях есть выход — это использование фигурных скобок, даже если тело условной инструкции состоит всего из одного законченного выражения:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
		….<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
<span style="color: #b1b100;">else</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>…<span style="color: #009900;">&#41;</span>
		….<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">else</span>
		….<span style="color: #339933;">;</span></pre></div></p>
<p>В таком случае программа будет восприниматься компилятором именно так, как задумал программист. </p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте и напишите программу, в которой бы использовалась вложенная конструкция <span class="geshifilter"><code class="c geshifilter-c">if<span style="color: #339933;">-</span><span style="color: #b1b100;">else</span></code></span>.</span></p>
<h3>Условное выражение</h3>
<p>В языке программирования <span class="blue">C</span> существует сокращенная запись инструкции <span class="geshifilter"><code class="c geshifilter-c">if<span style="color: #339933;">-</span><span style="color: #b1b100;">else</span></code></span> в виде условного выражения, результат которого может быть присвоен переменной:<br />
<span class="geshifilter"><code class="python geshifilter-python"><span style="color: black;">&#40;</span>логич_выражение<span style="color: black;">&#41;</span> <span style="color: #66cc66;">?</span> выражение<span style="color: #ff4500;">1</span> : выражение<span style="color: #ff4500;">2</span></code></span></p>
<p>Переводится это так. Если <span class="monoi">логич_выражение</span> вернуло истину, то все выражение возвращает <span class="monoi">выражение1</span>; если <span class="monoi">логич_выражение</span> вернуло ложь, то все выражение возвращает <span class="monoi">выражение2</span>. Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">x <span style="color: #339933;">=</span> <span style="color: #0000dd;">12</span><span style="color: #339933;">;</span>
y <span style="color: #339933;">=</span> <span style="color: #0000dd;">16</span><span style="color: #339933;">;</span>
z <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span>x <span style="color: #339933;">&gt;</span> y<span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> x <span style="color: #339933;">-</span> 1 <span style="color: #339933;">:</span> y <span style="color: #339933;">-</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> </pre></div><br />
Здесь <span class="monoi">z</span> получит значение 15. Такое условное выражение бывает очень удобно, однако область его применения ограничена простейшими случаями ветвления, т.к. невозможно создавать сложные "тела" в такой конструкции.</p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите программу, в которой бы использовалось условное выражение.</span></p>
<h3>Операторы И (&amp;&) и ИЛИ (||)</h3>
<p>Как известно логическое выражение может быть сложным. Логические операторы И и ИЛИ в языке программирования <span class="blue">C</span> обозначаются соответственно парными знаками амперсанда (&amp;&) и вертикальной черты (||). Их приоритет меньше, чем у простых логических операторов, поэтому простые логические операции при их объединении в сложные логические выражения можно не заключать в скобки. Пример сложного логического выражения на языке <span class="blue">C</span>:<br />
<span class="geshifilter"><code class="c geshifilter-c">a <span style="color: #339933;">&gt;</span> <span style="color: #0000dd;">100</span> <span style="color: #339933;">&amp;&amp;</span> b <span style="color: #339933;">!=</span> <span style="color: #0000dd;">0</span></code></span></p>
<p><strong><span class="blue">Задания</span></strong></p>
<ol>
<li><span class="blue">Напишите программу, в которой при <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span> использовалось бы сложное логическое выражение.</span></li>
<li><span class="blue">Проверьте и объясните, что выводит функция <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, если ей передать простые или сложные логические выражения. Например:</span></li>
</ol>
<p><div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a <span style="color: #339933;">==</span> b <span style="color: #339933;">&amp;&amp;</span> c <span style="color: #339933;">&lt;</span> d<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> c <span style="color: #339933;">&lt;</span> d<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<h3>Оператор switch</h3>
<p>При организации множественного выбора бывает удобно использовать не вложенные <span class="geshifilter"><code class="c geshifilter-c">if<span style="color: #339933;">-</span><span style="color: #b1b100;">else</span></code></span>, а оператор <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">switch</span></code></span>. Его синтаксис можно описать так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span>целая_переменная<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #b1b100;">case</span> константа1<span style="color: #339933;">:</span>
		операции<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">case</span> константа2<span style="color: #339933;">:</span>
		операции<span style="color: #339933;">;</span>
	….
	<span style="color: #b1b100;">default</span><span style="color: #339933;">:</span> 
		опрации<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div><br />
Это приблизительное, а не точное описание. В скобках после слова <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">switch</span></code></span> может стоять не только переменная, но и выражение, результат выполнения которого возвращает целое значение (может быть символ). Константы при <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">case</span></code></span> также могут быть результатом выполнения выражений. Константы можно группировать в одном <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">case</span></code></span> (например, <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">case</span> <span style="color: #0000dd;">12</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">13</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">18</span></code></span>). Ветка <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">default</span></code></span> не обязательна.</p>
<p>При выполнении оператора <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">switch</span></code></span>, заданное значение в круглых скобках сравнивается с константами. Как только совпадение будет найдено, все последующие вложенные во все <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">case</span></code></span> операции начинают выполняться. Т.е. происходит нечто странное: выполняются операции веток <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">case</span></code></span> (и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">default</span></code></span> тоже), константы которых не совпадают со значением при <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">switch</span></code></span>. Например, в результате выполнения вот такой программы:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">=</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">case</span> 0<span style="color: #339933;">:</span> 
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d &quot;</span><span style="color: #339933;">,</span> 0<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">case</span> 1<span style="color: #339933;">:</span> 
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d &quot;</span><span style="color: #339933;">,</span> 1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">case</span> 2<span style="color: #339933;">:</span> 
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d &quot;</span><span style="color: #339933;">,</span> 2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">default</span><span style="color: #339933;">:</span> 
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d &quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">-</span>1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>на экране будет выведено:</p>
<pre>1 2 -1</pre><p>, т.к. как только совпадение было обнаружено, все нижеследующие инструкции были выполнены.</p>
<p>Чтобы этого не происходило, в конце операций, принадлежащих определенному <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">case</span></code></span>, дописывают оператор <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000000; font-weight: bold;">break</span></code></span>, который осуществляет принудительный выход из всей конструкции (в данном случае <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">switch</span></code></span>). Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">=</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">case</span> 0<span style="color: #339933;">:</span> 
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> 0<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">case</span> 1<span style="color: #339933;">:</span> 
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> 1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">case</span> 2<span style="color: #339933;">:</span> 
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> 2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
    <span style="color: #b1b100;">default</span><span style="color: #339933;">:</span> 
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">-</span>1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span></pre></div><br />
выведет только единицу, т.к. выполнение всей инструкции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">switch</span></code></span> прервется после выполнения инструкции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000000; font-weight: bold;">break</span></code></span> при <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">case</span> <span style="color: #0000dd;">1</span></code></span>.</p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте свою программу с использованием оператора <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">switch</span></code></span>.</span></p>
  </div>
<div id="node-364" class="section-2">
  <h1 class="book-heading">Урок 4.  Циклы в языке C</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Инкремент и декремент</h3>
<p>Прежде, чем изучать циклы, следует познакомиться с часто используемым в языке <span class="blue">C</span> способом увеличения/уменьшения значений переменных на единицу. Конечно, в <span class="blue">C</span> работают такие формы изменения значений как, например, <span class="geshifilter"><code class="c geshifilter-c">a <span style="color: #339933;">+=</span> <span style="color: #0000dd;">1</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c">a <span style="color: #339933;">-=</span> <span style="color: #0000dd;">1</span></code></span>. Однако чаще используют операции инкрементирования (оператор инкремента "++") и декрементирования (оператор декремента "--"): <span class="geshifilter"><code class="c geshifilter-c">i<span style="color: #339933;">++</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">++</span>i</code></span>, <span class="geshifilter"><code class="c geshifilter-c">i<span style="color: #339933;">--</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">--</span>i</code></span>. В результате этих операций переменные увеличиваются или уменьшаются на единицу.</p>
<p>Запомните, когда вы видите выражения типа <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">++</span>i</code></span> или <span class="geshifilter"><code class="c geshifilter-c">i<span style="color: #339933;">++</span></code></span>, то в результате их выполнения значение <span class="monoi">i</span> меняется. Не надо делать вот так: <span class="geshifilter"><code class="c geshifilter-c">i <span style="color: #339933;">=</span> <span style="color: #339933;">++</span>i</code></span>. Это совершенно лишнее.  </p>
<p>Когда знак инкремента или декремента стоит перед переменной, то перед нами префиксная форма операции (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">++</span>i</code></span>, <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">--</span>i</code></span>), а когда после переменной, то постфиксная форма (<span class="geshifilter"><code class="c geshifilter-c">i<span style="color: #339933;">++</span></code></span>, <span class="geshifilter"><code class="c geshifilter-c">i<span style="color: #339933;">--</span></code></span>). Когда эти выражения не участвуют в построении более сложных выражений, то между префиксной и постфиксной формами никакой разницы нет: что <span class="geshifilter"><code class="c geshifilter-c">i<span style="color: #339933;">++</span></code></span>, что <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">++</span>i</code></span> — без разницы, в результате мы получим значение <span class="monoi">i</span> на единицу больше. Но когда эти выражения участвуют в построении более сложных, то разница между префиксной и постфиксной формами появляется и заключается в следующем: переменная над которой производится операция инкрементирования или декрементирования в постфиксной форме сначала используется в сложном выражении как есть, и только потом увеличивается на единицу; если мы имеем дело с префиксной формой, то переменная сначала изменяется, а затем используется. Например, код:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> c<span style="color: #339933;">,</span> d<span style="color: #339933;">;</span>
  a<span style="color: #339933;">=</span>b<span style="color: #339933;">=</span>c<span style="color: #339933;">=</span>d<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// выражение означает, что всем переменным присваивается 0</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;a=%d, b=%d, c=%d, d=%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> c<span style="color: #339933;">,</span> d<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  c <span style="color: #339933;">=</span> <span style="color: #339933;">++</span>a<span style="color: #339933;">;</span>
  d <span style="color: #339933;">=</span> b<span style="color: #339933;">++;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;a=%d, b=%d, c=%d, d=%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> c<span style="color: #339933;">,</span> d<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>, выведет на экране:</p>
<pre>
a=0, b=0, c=0, d=0 
a=1, b=1, c=1, d=0 
</pre><p>
Объясняется такой результат так:</p>
<ul>
<li>значение переменной <span class="monoi">a</span> было увеличено на единицу, после чего это значение было присвоено переменной <span class="monoi">c</span>;</li>
<li>значение переменной <span class="monoi">b</span> было сначала присвоено переменной <span class="monoi">d</span> и только потом увеличено на единицу.</li>
</ul>
<p>Еще один пример:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> x<span style="color: #339933;">,</span> y<span style="color: #339933;">;</span>
  x <span style="color: #339933;">=</span> y <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> x<span style="color: #339933;">++</span> <span style="color: #339933;">&gt;</span> 0<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">++</span>y <span style="color: #339933;">&gt;</span> 0<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>На экране будет выведено:</p>
<pre>
0
1
</pre><p>
Это результат логических выражений, где 0 означает ложь, а 1 — истину. В данном случае, когда <span class="monoi">x</span> сравнивается с нулем, то его значение еще не увеличено, а когда сравнивается <span class="monoi">у</span>, то его значение уже больше нуля.</p>
<p>Применять операторы инкремента и декремента можно также к переменным вещественного типа. </p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте более сложные, чем представленные выше, выражения с использованием операторов инкремента и декремента. Проверьте и объясните результат их выполнения. </span></p>
<h3>while</h3>
<p>Цикл <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> в языке программирования <span class="blue">C</span> работает также как и в других языках программирования. По аналогии с условным выражением в инструкции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>, условное выражение при <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> заключается в круглые скобки. Если тело цикла включает несколько выражений разделяемых точкой с запятой, то все тело заключается в фигурные скобки.</p>
<p><strong><span class="blue">Задание</span></strong></p>
<ol>
<li><span class="blue">Присвойте переменной <span class="monoi">star</span> значение 0. Пока значение <span class="monoi">star</span> не достигнет 55 выводите на экран в строку по одной звездочке (*).</span></li>
<li><span class="blue">С помощью цикла <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> запрограммируйте вывод на экран цифровых кодов и значений таблицы символов ASCII от 31 до 127 включительно. При этом после каждого десятого символа осуществляйте переход на новую строку. (Подсказка: чтобы переходить на новую строку, в цикле <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> надо использовать инструкцию <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>, в условии которой остаток<sup>1</sup> от деления на 10 сравнивается с нулем.)</span><br />
<img src="../../../img/c/ascii.png" width="612" height="213" alt="Вывод таблицы символов на языке программирования C" />
</li>
<li><span class="blue">Используя внешний и вложенный циклы <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> организуйте вывод таблицы умножения на экран.</span><br />
<img src="../../../img/c/table.png" width="359" height="192" alt="Вывод на языке программирования C таблицы умножения" />
</li>
</ol>
<p><span class="mono"><sup>1</sup> Операция нахождения остатка от деления в языке C обозначается знаком процента (%).</span></p>
<h3>do-while</h3>
<p>Цикл <span class="geshifilter"><code class="c geshifilter-c">do<span style="color: #339933;">-</span><span style="color: #b1b100;">while</span></code></span> отличается от <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> лишь тем, что его тело будет выполнено хотя бы один раз независимо от условия выполнения цикла. Синтаксис цикла <span class="geshifilter"><code class="c geshifilter-c">do<span style="color: #339933;">-</span><span style="color: #b1b100;">while</span></code></span> можно описать так (фигурные скобки можно опустить, если законченное выражение только одно):<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">do</span> <span style="color: #009900;">&#123;</span>
    выражение<span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
    …<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>логич_выражение<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Этот цикл называют циклом с постусловием. Его используют намного реже обычного <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span>. В принципе почти всегда можно обойтись без него, но в определенных ситуациях его использование упрощает код. Допустим требуется вывести на экран отдельные цифры числа. Любое число состоит хотя бы из одной цифры, даже число 0. Можно решить эту задачу с использованием цикла <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span>:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>a <span style="color: #339933;">&gt;</span> 0<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a <span style="color: #339933;">%</span> 10<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    a <span style="color: #339933;">=</span> a <span style="color: #339933;">/</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span></pre></div></p>
<p>Но в этом случае, если a равно 0, то цикл не выполнится ни разу. Пришлось бы перед циклом использовать инструкцию <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>, в которой сравнивать переменную с 0. Использование же цикла <span class="geshifilter"><code class="c geshifilter-c">do<span style="color: #339933;">-</span><span style="color: #b1b100;">while</span></code></span> решает эту проблему, т.к. его тело один раз выполнится даже при нулевом значении переменной:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #b1b100;">do</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a <span style="color: #339933;">%</span> 10<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    a <span style="color: #339933;">=</span> a <span style="color: #339933;">/</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span> <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>a <span style="color: #339933;">&gt;</span> 0<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте и напишите любую программу, в которой бы использовался цикл <span class="geshifilter"><code class="c geshifilter-c">do<span style="color: #339933;">-</span><span style="color: #b1b100;">while</span></code></span>.</span></p>
<h3>for</h3>
<p>Представим синтаксис заголовка цикла <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span> языка программирования <span class="blue">C</span> так:<br />
<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>часть<span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> часть<span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> часть<span style="color: #0000dd;">3</span><span style="color: #009900;">&#41;</span></code></span></p>
<p>Заголовок цикла <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span> включает три части, разделенных точкой с запятой; причем каждая часть может быть сложной, т.е. состоять из нескольких выражений, разделенных простой запятой. В первой части обычно указываются переменные и часто их начальные значения; во второй - с помощью логического(их) выражения(й) задаются условия, при которых выполняется тело цикла; в третью часть помещаются выражения, которые выполняются в конце каждой итерации цикла (чаще всего здесь изменяется значение переменной, заданной в первой части заголовка).</p>
<p>Вот так будет выглядеть программный код, выводящий таблицу символов на экран, в котором используется цикл <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span>:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">unsigned</span> <span style="color: #993333;">char</span> a<span style="color: #339933;">;</span>
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>a <span style="color: #339933;">=</span> <span style="color: #0000dd;">31</span><span style="color: #339933;">;</span> a <span style="color: #339933;">&lt;</span> <span style="color: #0000dd;">128</span><span style="color: #339933;">;</span> a<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>a <span style="color: #339933;">%</span> 10 <span style="color: #339933;">==</span> 0<span style="color: #009900;">&#41;</span>
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%4d-%c&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите программу с использованием цикла <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span>, выводящую на экран таблицу умножения (Подсказка: как и в случае с <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> следует использовать два цикла — внешний и вложенный.)</span></p>
<h3>break и continue</h3>
<p>Оператор <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000000; font-weight: bold;">break</span></code></span> позволяет прервать выполнение цикла, а <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">continue</span></code></span> — прервать текущую итерацию (проход) цикла. Почти всегда можно обойтись без этих операторов, но иногда их использование позволяет упростить программный код и сделать его более понятным. </p>
<p>Рассмотрим пару примеров. Допустим, требуется проверить массив на наличие в нем хотя бы одного элемента со значением 0. Как только ноль будет обнаружен проверять оставшуюся часть массива уже нет смысла. Поэтому, чтобы не выполнять лишних итераций, используется оператор <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000000; font-weight: bold;">break</span></code></span>.</p>
<p>Второй пример. Требуется из одного массива скопировать в другой только числа, которые больше 0. Можно с помощью <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">continue</span></code></span> прерывать итерацию цикла, если очередной элемент меньше либо равен нулю.<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #339933;">#define N 10</span>
  <span style="color: #993333;">int</span> arr<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>6<span style="color: #339933;">,</span> 5<span style="color: #339933;">,</span> <span style="color: #339933;">-</span>4<span style="color: #339933;">,</span> 3<span style="color: #339933;">,</span> <span style="color: #339933;">-</span>7<span style="color: #339933;">,</span> 2<span style="color: #339933;">,</span> 7<span style="color: #339933;">,</span> 0<span style="color: #339933;">,</span> 3<span style="color: #339933;">,</span> 9<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> new_arr<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">,</span> j<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d  &quot;</span><span style="color: #339933;">,</span> i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// просто проверка</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> 0<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Stop. Array contains zero<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
  <span style="color: #009900;">&#125;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span>0<span style="color: #339933;">,</span> j<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">&lt;=</span> 0<span style="color: #009900;">&#41;</span>
      <span style="color: #b1b100;">continue</span><span style="color: #339933;">;</span>
    new_arr<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d  &quot;</span><span style="color: #339933;">,</span> new_arr<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// проверка</span>
    j<span style="color: #339933;">++;</span>
  <span style="color: #009900;">&#125;</span>  
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div><br />
В данном случае использование <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">continue</span></code></span> совсем не очевидно с точки зрения надобности, т.к. легко можно обойтись без него, если изменить условие при <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span> на противоположное, удалить <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">continue</span></code></span>, а оставшийся код поместить в тело оператора <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>.</p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте пример, в котором уместно было бы использовать оператор <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000000; font-weight: bold;">break</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">continue</span></code></span>.</span></p>
  </div>
<div id="node-365" class="section-2">
  <h1 class="book-heading">Урок 5. Битовые операции</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Для освоения темы этого урока вам потребуются знания о системах счисления (двоичной, восьмеричной и др.), навыки перевода чисел из одной системы счисления в другую, а также вы должны иметь представление о том, что такое битовые (они же поразрядные) операции. С последним можно познакомиться по <a href="http://inf1.info/bitwise-operations" title="Битовые операции">вот этой лекции</a>.</p>
<p>В языке программирования <span class="blue">C</span> существуют следующие поразрядные операции: &amp; (И), | (ИЛИ), ^ (исключающее ИЛИ), &lt;&lt; (сдвиг влево), >> (сдвиг вправо), ~ (поразрядное дополнение до единицы). Рассмотрим на примерах, как они работают, но перед этим уделим внимание выводу в языке <span class="blue">C</span> чисел в отличных от десятичной системах счисления.</p>
<p>В <span class="blue">С</span> можно присваивать целочисленные значения в десятичной, восьмеричной и шестнадцатеричной системах счисления. Для того, чтобы присвоить переменной число в восьмеричной системе счисления, перед ним надо написать 0 (ноль), в шестнадцатеричной — 0x (ноль и икс), например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">;</span>
  a <span style="color: #339933;">=</span> <span style="color: #208080;">077</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// записано восьмеричное число</span>
  b <span style="color: #339933;">=</span> <span style="color: #208080;">0x1F</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// присвоено шестнадцатеричное число</span></pre></div></p>
<p>Любые целые числа можно выводить на экран в десятичном, восьмеричном и шестнадцатеричном представлении. Пример кода для вывода определенных ранее двух переменных в различных системаъ счисления:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %o %x %X<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span>a<span style="color: #339933;">,</span>a<span style="color: #339933;">,</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %o %x %X<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> b<span style="color: #339933;">,</span>b<span style="color: #339933;">,</span>b<span style="color: #339933;">,</span>b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В результате на экране вы увидите: </p>
<pre>
63 77 3f 3F 
31 37 1f 1F
</pre><p>
Восьмеричные и шестнадцатеричные числа используются из-за удобства при работе с двоичной системой счисления. Каждая цифра восьмеричного числа может быть заменена тремя цифрами двоичного. И каждая цифра шестнадцатеричного числа легко заменяет четыре разряда двоичного числа. Вот таблица соответствия цифр восьмеричной системы счисления числам двоичной системы:</p>
<table>
<tr>
<td>0</td>
<td>000</td>
</tr>
<tr>
<td>1</td>
<td>001</td>
</tr>
<tr>
<td>2</td>
<td>010</td>
</tr>
<tr>
<td>3</td>
<td>011</td>
</tr>
<tr>
<td>4</td>
<td>100</td>
</tr>
<tr>
<td>5</td>
<td>101</td>
</tr>
<tr>
<td>6</td>
<td>110</td>
</tr>
<tr>
<td>7</td>
<td>111</td>
</tr>
</table>
<p>Теперь допустим, что у нас есть восьмеричное число 037. По таблице легко понять, что в двоичном выражении оно будет выглядеть как 011 111.</p>
<p><span class="blue"><strong>Задание</strong></span></p>
<ol>
<li><span class="blue">Как будут выглядеть восьмеричные числа 04271 и 03566  в двоичном представлении.</span></li>
<li><span class="blue">Составьте на бумаге таблицу соответствия шестнадцатеричный цифр двоичным числам. Переведите числа 7D, FFFF, 2C9 в двоичную систему счисления.</span></li>
</ol>
<p>Итак, если бы мы при работе с поразрядными операциями использовали десятичные числа, то чтобы оценить результат нам бы каждый раз приходилось переводить десятичное число в двоичную систему счисления, что относительно трудоемко. Если же человек видит, например, восьмеричное число, то он может представить как оно выглядит в двоичном представлении, помня или держа перед глазами таблицу соответствия чисел. Например, как только мы видим 017, то можем представить в уме, как последние четыре бита ячейки памяти забиты единицами. </p>
<p>Теперь вернемся к поразрядным операциям и протестируем каждую из них. Для этого напишем небольшую программу:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">;</span>
  a <span style="color: #339933;">=</span> <span style="color: #208080;">017</span><span style="color: #339933;">;</span>
  b <span style="color: #339933;">=</span> <span style="color: #208080;">036</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;0%o &amp; 0%o = 0%o<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> a <span style="color: #339933;">&amp;</span> b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;0%o | 0%o = 0%o<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> a <span style="color: #339933;">|</span> b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;0%o ^ 0%o = 0%o<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> a <span style="color: #339933;">^</span> b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;0%o &lt;&lt; 2 = 0%o<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> a <span style="color: #339933;">&lt;&lt;</span> 2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;0%o &gt;&gt; 2 = 0%o<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> a <span style="color: #339933;">&gt;&gt;</span> 2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;~0%o = 0%o<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> ~a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Результат ее работы будет выглядеть так:</p>
<pre>
017 & 036 = 016 
017 | 036 = 037 
017 ^ 036 = 021 
017 &lt;&lt; 2 = 074 
017 >> 2 = 03 
~017 = 037777777760
</pre><p>Этот результат будет проще понять с помощью рисунка:<br />
<img src="../../../img/c/bits.png" width="700" height="394" alt="Пример результата битовых операций" /></p>
<p>В последнем случае получилось такое большое число потому, что под форматы вывода целых чисел (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>d<span style="color: #339933;">,</span> <span style="color: #339933;">%</span>o<span style="color: #339933;">,</span> <span style="color: #339933;">%</span>X</code></span>) выделяется по 4 байта.</p>
<p><span class="blue"><strong>Задание</strong></span></p>
<ul>
<li><span class="blue">Используя шестнадцатеричные числа, напишите аналогичную приведенной выше программу. Объясните результат.</span> </li>
<li><span class="blue">Попробуйте составлять сложные битовые операции (в несколько действий) и оценивать их результат.</span></li>
</ul>
<p>Теперь рассмотрим пример использования битовых операций. Допустим, у нас есть массив, требуется снять с него "маску", которая бы отражала, в какой позиции стоят отрицательные, а в какой положительные элементы. Пусть единица в бите обозначает соответствующий ей положительный элемент массива, а ноль — отрицательный. Другими словами, если у нас есть массив {4, -3, 2, 2, 8, -1}, то его "битовая маска" будет выглядеть как 101110, или в восьмеричном представлении как 056. Составим алгоритм решения этой задачи:</p>
<ol>
<li>Будем считать, что массив состоит не более чем из 32 элементов. Поэтому для хранения его "маски" достаточно переменной типа <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span>. Назовем ее <span class="monoi">mask</span> и присвоим значение 0.</li>
<li>Перебрать элементы массива в цикле <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span>. Если встречается положительный элемент, то установить соответствующий ему бит значения <span class="monoi">mask</span> в 1.</li>
<li>Вывести значение переменной <span class="monoi">mask</span> на экран в виде восьмеричного числа.</li>
</ol>
<p>Вроде бы все просто, но как установить в единицу определенный бит числа? Существует закономерность соответствия степеней двойки и двоичного представления числа:<br />
2<sup>0</sup> = 0000 0001<br />
2<sup>1</sup> = 0000 0010<br />
2<sup>2</sup> = 0000 0100<br />
2<sup>3</sup> = 0000 1000<br />
2<sup>4</sup> = 0001 0000<br />
и т.д. Если для вас эта последовательность не очевидна, то пересчитайте. Теперь если применить к <span class="monoi">mask</span> побитовую операцию | (ИЛИ), а в качестве второго операнда использовать определенную степень двойки, то один бит будет установлен в 1. Например:<br />
 (0) 0000 0000 | (2<sup>5</sup>) 0010 0000 = 0010 0000<br />
(32) 0010 0000 | (2<sup>7</sup>) 1000 0000 = 1010 0000</p>
<p>При переборе первый элемент массива имеет индекс 0, но соответствующий ему бит в <span class="monoi">mask</span> должен стоять впереди остальных. Если известно общее количество элементов массива (<span class="monoi">N</span>), то можно определить степень двойки по формуле <span class="geshifilter"><code class="c geshifilter-c">N <span style="color: #339933;">-</span> i <span style="color: #339933;">-</span> <span style="color: #0000dd;">1</span></code></span>. Действительно, имея третий положительный элемент массива из 10 элементов, следует установить в единицу восьмой с конца бит, а это значит надо использовать вторым операндом битового ИЛИ 27, а 7 как раз будет 10(N) - 2(i) - 1.</p>
<p>Другая проблема — как в языке <span class="blue">C</span> возвести число в степень. Понятно, что можно написать свой код, но скорее всего в стандартной библиотеке уже есть подобная функция. С помощью заголовочного файла math.h можно подключить библиотеку с математическими функциями. Среди них есть функция <span class="geshifilter"><code class="c geshifilter-c">pow<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которая принимает два числа и возвращает результат возведения первого числа в степень, выраженную вторым числом. Однако результат возвращается в виде вещественного числа, а нам требуется целое. Как быть? В языке программирования <span class="blue">С</span> есть операции приведения типов, которые меняют тип значения с одного на другой. Например, чтобы преобразовать значение вещественной переменной a в целое, следует написать <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span><span style="color: #009900;">&#41;</span> a</code></span>.<br />
Вот как может выглядеть вышеописанная программа:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;math.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 12</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
&nbsp;
  <span style="color: #993333;">int</span> nums<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>7<span style="color: #339933;">,</span> 3<span style="color: #339933;">,</span> 9<span style="color: #339933;">,</span> <span style="color: #339933;">-</span>5<span style="color: #339933;">,</span> <span style="color: #339933;">-</span>3<span style="color: #339933;">,</span> 2<span style="color: #339933;">,</span> 1<span style="color: #339933;">,</span> 0<span style="color: #339933;">,</span> 16<span style="color: #339933;">,</span> <span style="color: #339933;">-</span>4<span style="color: #339933;">,</span> 2<span style="color: #339933;">,</span> 0<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> mask <span style="color: #339933;">=</span> 0<span style="color: #339933;">,</span> i<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>nums<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">&gt;=</span> 0<span style="color: #009900;">&#41;</span>
      mask <span style="color: #339933;">=</span> mask <span style="color: #339933;">|</span> <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span><span style="color: #009900;">&#41;</span>pow<span style="color: #009900;">&#40;</span>2<span style="color: #339933;">,</span>N<span style="color: #339933;">-</span>i<span style="color: #339933;">-</span>1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%o<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> mask<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите предыдущую программу. Оцените как она работает<sup>1</sup>. Подумайте над тем, как вывести на экран двоичное представление восьмеричного числа. Попробуйте реализовать это.</span><br />
<span class="mono"><sup>1</sup> Если у вас не получается скомпилировать программу, добавьте в конце вызова gcc опцию <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">-</span>lm</code></span> (например, <span class="geshifilter"><code class="c geshifilter-c">gcc <span style="color: #339933;">-</span>o bits bits.<span style="color: #202020;">c</span> <span style="color: #339933;">-</span>lm</code></span>). </span> </p>
  </div>
<div id="node-366" class="section-2">
  <h1 class="book-heading">Урок 6. Посимвольный ввод и вывод. Понятие буфера</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>putchar() и getchar()</h3>
<p>В заголовочном файле stdio.h содержится объявление не только функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, но и многих других, связанных с вводом-выводом. Среди них есть функции, которые обрабатывают по одному символу за вызов — <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>.</p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> обычно принимает в качестве аргумента символ, либо символьную переменную и в результате своей работы выводит соответствующий символ на экран. Однако этой функции можно передать любое целое число, но, понятное дело, символа на экране вы можете не получить, если числу не соответствует ни один символ по таблице ASCII. Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">char</span> ch <span style="color: #339933;">=</span> <span style="color: #ff0000;">'c'</span><span style="color: #339933;">;</span>
&nbsp;
  putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'a'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  putchar<span style="color: #009900;">&#40;</span>98<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  putchar<span style="color: #009900;">&#40;</span>ch<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Результат:</p>
<pre>
ab 
c
</pre><p>
Функции <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> в определенном смысле взаимозаменяемы, т.к., используя ту или другую, можно получить один и тот же результат. Хотя программный код будет выглядеть по-разному:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Hello&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// первое Hello</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> str<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #666666; font-style: italic;">// второе Hello</span>
    putchar<span style="color: #009900;">&#40;</span>str<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В результате выполнения этого кода на экране будут напечатаны два слова "Hello", разделенные переходом на новую строку. С <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> это выглядит несколько сложнее. Как мы знаем, любая строка оканчивается нулевым по таблице ASCII символом, в данном случае этот символ служит сигналом для прекращения вывода на экран. Но если бы понадобилось вывести на экран строку, разделяя ее символы каким-нибудь другим символом (например, тире), то и в случае с <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> было бы не так все просто:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Hello&quot;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> str<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c-&quot;</span><span style="color: #339933;">,</span>str<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c%c %c&quot;</span><span style="color: #339933;">,</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\b</span>'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> str<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    putchar<span style="color: #009900;">&#40;</span>str<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'-'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>  
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c%c %c&quot;</span><span style="color: #339933;">,</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\b</span>'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Результат:</p>
<pre>
H-e-l-l-o 
H-e-l-l-o 
</pre><p>
Поэтому выбор в пользу той или иной функции зависит от ситуации и ваших предпочтений. </p>
<p>В отличие от функции <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> функция <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> не имеет параметром. Когда <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выполняется, она считывает их потока ввода один символ и возвращает его в программу. Полученный таким образом символ может быть присвоен переменной, участвовать в выражениях или выводиться на экран с помощью функций вывода.<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">;</span>
&nbsp;
  a <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c &quot;</span><span style="color: #339933;">,</span> a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  putchar<span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Если при выполнении этого кода ввести символ, то после нажатия Enter вы увидите два таких же символа на экране:</p>
<pre>
u 
u u
</pre><p>
Первый — результат выполнения функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, второй — <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Если вы перед нажатием Enter введете несколько символов, то прочитан будет только первый, остальные будут проигнорированы. Посмотрите вот на этот код:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">char</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> c<span style="color: #339933;">;</span>
&nbsp;
  a <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  putchar<span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  b <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  putchar<span style="color: #009900;">&#40;</span>b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  c <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  putchar<span style="color: #009900;">&#40;</span>c<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Как вы думает, как он будет выполняться? По идее после ввода символа, он должен сразу отображаться на экране функцией <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и запрашиваться следующий символ, потому что далее идет снова вызов <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Если вы как корректный пользователь программы сначала введете первый символ и нажмете Enter, то символ отобразиться на экране. Потом вы введете второй символ и после Enter он тоже отобразиться. И тут программа завершится, не дав ввести вам третий символ. </p>
<p><span class="blue"><strong>Задание</strong><br />
Удостоверьтесь в этом сами.</span></p>
<p>Прежде чем попытаться найти объяснение, изобразим "некорректного пользователя" и перед первым нажатием Enter введем несколько символов (больше двух). После Enter вы увидите три первых символа введенной вами строки, и программа завершиться. Хотя куда логичней было бы ожидать, что будет прочитан только первый символ, потом выведен на экран и потом запрошен следующий символ.</p>
<p><span class="blue"><strong>Задание</strong><br />
Проверьте это.</span></p>
<p>Такое странное на первый взгляд поведение программы связано не с языком <span class="blue">C</span>, а с особенностью работы операционных систем, в которых реализован буферизованный ввод-вывод. При операциях ввода-вывода выделяется область временной памяти (буфер), куда и помещаются поступающие символы. Как только поступает специальный сигнал (например, переход на новую строку при нажатии Enter), данные из буфера передаются по месту своего назначения (на экран, в переменную и др.).</p>
<p>Теперь, зная это, давайте посмотрим, что происходило в нашей программе, и сначала разберем второй случай с "некорректным пользователем", т.к. для понимания этот случай проще. Когда пользователь ввел первый символ, он попал в переменную <span class="monoi">a</span>, далее сработала функция <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span></code></span> и символ попал в буфер. Т.к. Enter'а не было, то содержимое буфера на экране не было отображено. Пользователь ввел второй символ, переменная <span class="monoi">b</span> получила свое значение, а <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span>b<span style="color: #009900;">&#41;</span></code></span> отправила это значение в буфер. Аналогично с третьим символом. Как только пользователь нажал Enter, содержимое буфера было выведено на экран. Но символы, которые были выведены на экран, были выведены не программой, а операционной системой. Программа же выводила символы еще до того, как мы нажали Enter.</p>
<p>Почему же в первом случае при выполнении программы мы смогли ввести и увидеть на экране только два символа? Когда был введен первый символ, то он был присвоен переменной <span class="monoi">a</span> и далее выведен в буфер. Затем был нажат Enter. Это сигнал для выброса данных их буфера, но это еще и символ перехода на новую строку. Этот символ '\n', наверное, и был благополучно записан в переменную <span class="monoi">b</span>. Тогда в буфере должен оказаться переход на новую строку, после этого введенный символ (уже помещенный в переменную <span class="monoi">c</span>). После нажатия Enter мы должны были бы увидеть переход  на новую строку от символа '\n' и букву. Однако печатается только буква. Почему?</p>
<p>Во многих учебниках по языку <span class="blue">C</span> приводится пример считывания символов, вводимых пользователем, и их вывод на экран:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">;</span>
&nbsp;
  a <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>a <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
    putchar<span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
    a <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
  putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div><br />
В переменной <span class="monoi">a</span> всегда хранится последний введенный символ, но перед тем как присвоить a новое значение с помощью функции <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> старое значение сбрасывается в буфер. Как только поступает символ новой строки, работа программы прекращается, а также, поскольку была нажата клавиша Enter, происходит вывод содержимого буфер на экран. Если в условии цикла <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> будет не символ '\n', а какой-нибудь другой, то программа будет продолжать обрабатывать символы, даже после нажатия Enter. В результате чего мы можем вводить и выводить множество строк текста.</p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите программу посимвольного ввода-вывода, используя в качестве признака окончания ввода любой символ, кроме '\n'. Протестируйте ее.</span></p>
<p>При совместном использовании функций <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> обычно пользуются более коротким способом записи. Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>a <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'~'</span><span style="color: #009900;">&#41;</span>
    putchar<span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p><span class="blue"><strong>Задание</strong></span></p>
<ol>
<li><span class="blue">Объясните, почему сокращенный вариант записи посимвольного ввода-вывода работает правильно. Для этого опишите последовательность операций в условии цикла <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span>.</span></li>
<li><span class="blue">Перепишите вашу программу на более короткий вариант.</span></li>
</ol>
<h3>EOF</h3>
<p>Как быть, если требуется "прочитать" с клавиатуры или файла неизвестный текст, в котором может быть абсолютно любой символ? Как сообщить программе, что ввод окончен, и при этом не использовать ни один из возможных символов?</p>
<p>В операционных системах и языках программирования вводят специальное значение, которое служит признаком окончания потока ввода или признаком конца файла. Называется это значение EOF (end of file), а его конкретное значение может быть разным, но чаще всего это число -1. EOF представляет собой константу, в программном коде обычно используется именно имя (идентификатор) константы, а не число -1. EOF определена в файле stdio.h.</p>
<p>В операционных системах GNU/Linux можно передать функции <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> значение EOF, если нажать комбинацию клавиш Ctrl + D, в Windows – Ctrl + Z.</p>
<p><span class="blue"><strong>Задание</strong><br />
Исправьте вашу программу таким образом, чтобы считывание потока символов прерывалось признаком EOF.</span></p>
<h3>Решение задач</h3>
<p>Не смотря на свою кажущуюся примитивность, функции <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">putchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> часто используются, т.к. посимвольный анализ данных при вводе-выводе не такая уж редкая задача. Используя только функцию <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, можно получить массив символов (строку) и при этом отсеять ненужные символы. Вот пример помещения в строку только цифр из потока ввода, в котором может быть набран абсолютно любой символ:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 100</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
  <span style="color: #993333;">char</span> ch<span style="color: #339933;">;</span>
  <span style="color: #993333;">char</span> nums<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
  i <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>ch <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> EOF <span style="color: #339933;">&amp;&amp;</span> i <span style="color: #339933;">&lt;</span> N<span style="color: #339933;">-</span>1<span style="color: #009900;">&#41;</span>
    <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>ch <span style="color: #339933;">&gt;=</span> 48 <span style="color: #339933;">&amp;&amp;</span> ch <span style="color: #339933;">&lt;=</span> 57<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      nums<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> ch<span style="color: #339933;">;</span>
      i<span style="color: #339933;">++;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
  nums<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> nums<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div><br />
Здесь ввод символов может прекратиться не только при поступлении значения EOF, но и в случае, если массив заполнен (<span class="geshifilter"><code class="c geshifilter-c">i <span style="color: #339933;">&lt;</span> N<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span></code></span>). В цикле <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">while</span></code></span> проверяется условие, что числовой код очередного символа принадлежит диапазону [48, 57]. Именно в этом диапазоне кодируются цифры (0-9). Если поступивший символ является символом-цифрой, то он помещается в массив по индексу <span class="monoi">i</span>, далее <span class="monoi">i</span> увеличивается на 1, указывая на следующий элемент массива. После завершения цикла к массиву символов добавляется нулевой символ, т.к. по условию задачи должна быть получена строка (именно для этого символа ранее резервируется одна ячейка массива – <span class="geshifilter"><code class="c geshifilter-c">N<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span></code></span>). </p>
<p><span class="blue"><strong>Задание</strong></span></p>
<ol>
<li><span class="blue">Напишите программу, которая считает количество введенных пользователем символов и строк.</span></li>
<li><span class="blue">Напишите программу, которая подсчитывает количество слов в строке.</span></li>
</ol>
  </div>
<div id="node-367" class="section-2">
  <h1 class="book-heading">Урок 7. Переменные, адреса и указатели</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Переменная — это область памяти, к которой мы обращаемся за находящимися там данными, используя идентификатор (в данном случае, имя переменной). При этом у этой помеченной именем области есть еще и адрес, выраженный числом и понятный компьютерной системе. Этот адрес можно получить и записать в особую переменную. Переменную, содержащую адрес области памяти, называют указателем.</p>
<p>Когда мы меняем значение обычной переменной, то, можно сказать, просто удаляем из конкретной области памяти данные и записываем туда новые. Когда мы меняем значение переменной-указателя, то начинаем работать с совершенно иным участком памяти, т.к. меняем содержащийся в ней адрес. </p>
<p>Тема указателей тесно связана с темой динамических типов данных. Когда программа компилируется, то под объявленные переменные так или иначе (в зависимости от того, где они были объявлены) выделяются участки памяти. Потом размер этих участков не меняется,  может меняться только их содержимое (значения или данные). Однако именно с помощью указателей можно захватывать и освобождать новые участки памяти уже в процессе выполнения программы. Динамические типы данных будут рассмотрены позже.</p>
<p>Прежде чем перейти к рассмотрению объявления и определения переменных-указателей, посмотрим, что из себя представляет адрес любой переменной и как его получить.<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> i <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;i=%d, &amp;i=%p <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В результате выполнения данного программного кода на экране появляется примерно следующее (шестнадцатеричное число у вас будет другим):</p>
<pre>i=0, &i=0x7fffa40c5fac </pre><p>
Знак амперсанда (&amp;) перед переменной позволяет получить ее адрес в памяти. Для вывода адреса переменной на экран используется специальный формат <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>p</code></span>. Адреса обычных переменных (не указателей) в процессе выполнения программы никогда не меняются. В этом можно убедиться:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a <span style="color: #339933;">=</span> <span style="color: #0000dd;">6</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> b <span style="color: #339933;">=</span> <span style="color:#800080;">10.11</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">char</span> c <span style="color: #339933;">=</span> <span style="color: #ff0000;">'k'</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d - %p, %.2f - %p, %c - %p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,&amp;</span>a<span style="color: #339933;">,</span> b<span style="color: #339933;">,&amp;</span>b<span style="color: #339933;">,</span> c<span style="color: #339933;">,&amp;</span>c<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  a <span style="color: #339933;">=</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> b <span style="color: #339933;">=</span> <span style="color:#800080;">50.99</span><span style="color: #339933;">;</span> c <span style="color: #339933;">=</span> <span style="color: #ff0000;">'z'</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d - %p, %.2f - %p, %c - %p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,&amp;</span>a<span style="color: #339933;">,</span> b<span style="color: #339933;">,&amp;</span>b<span style="color: #339933;">,</span> c<span style="color: #339933;">,&amp;</span>c<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Результат:</p>
<pre>
6 - 0x7fff8e1d38e4, 10.11 - 0x7fff8e1d38e8, k - 0x7fff8e1d38ef 
2 - 0x7fff8e1d38e4, 50.99 - 0x7fff8e1d38e8, z - 0x7fff8e1d38ef
</pre><p>
Как мы видим, несмотря на то, что значения переменных поменялись, ячейки памяти остались прежними.</p>
<p>Зная адрес, можно получить значение, которое находится по этому адресу, поставив знак * перед адресом:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a <span style="color: #339933;">=</span> <span style="color: #0000dd;">8</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d <span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">*&amp;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>На экране будет выведено число 8. </p>
<p>Однако запись типа <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">&amp;</span>a</code></span> не всегда возможна или удобна. Поэтому существует специальный тип данных — указатели, которым и присваивается адрес на область памяти. </p>
<p>Указатели в языке <span class="blue">C</span>, как и другие переменные, являются типизированными, т.е. при объявлении указателя надо указывать его тип. Как мы узнаем позже, с указателями можно выполнять некоторые арифметические операции, и именно точное определение их типа позволяет протекать им корректно. Чтобы объявить указатель, надо перед его именем поставить знак *. Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> <span style="color: #339933;">*</span>pi<span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> <span style="color: #339933;">*</span>pf<span style="color: #339933;">;</span></pre></div></p>
<p>Обратите внимание на то, что в данном случае * говорит о том, что объявляется переменная-указатель. Когда * используется перед указателем не при его объявлении, а в выражениях, то обозначает совсем иное — "получить значение (данные) по адресу, который присвоен указателю". Посмотрите на код ниже:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> x <span style="color: #339933;">=</span> 1<span style="color: #339933;">,</span> y<span style="color: #339933;">,</span> z <span style="color: #339933;">=</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> <span style="color: #339933;">*</span>p<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>q<span style="color: #339933;">;</span>
&nbsp;
  p <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>x<span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">*</span>p<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// 1</span>
&nbsp;
  y <span style="color: #339933;">=</span> <span style="color: #339933;">*</span>p<span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> y<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// 1</span>
&nbsp;
  <span style="color: #339933;">*</span>p <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> x<span style="color: #339933;">,</span> y<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// 0 1</span>
&nbsp;
  q <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>z<span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">*</span>q<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// 3</span>
&nbsp;
  p <span style="color: #339933;">=</span> q<span style="color: #339933;">;</span>
  <span style="color: #339933;">*</span>p <span style="color: #339933;">=</span> <span style="color: #0000dd;">4</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> z<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// 4</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%p %p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> p<span style="color: #339933;">,</span> q<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// p == q</span></pre></div></p>
<p>С помощью комментариев указаны текущие значения ячеек памяти. Подробно опишем, что происходит:</p>
<ol>
<li>Выделяется память под пять переменных: три типа <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span> и два указателя на <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span></code></span>. В ячейки <span class="monoi">x</span> и <span class="monoi">z</span> записываются числа 1 и 3 соответственно.</li>
<li>Указателю <span class="monoi">p</span> присваивается адрес ячейки <span class="monoi">x</span>. Извлекая оттуда значение (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span>p</code></span>), получаем 1.</li>
<li>В область памяти, которая названа именем <span class="monoi">у</span>, помещают значение равное содержимому ячейки, на которую ссылается указатель <span class="monoi">p</span>. В результате имеем две области памяти (<span class="monoi">x</span> и <span class="monoi">y</span>), в которые записаны единицы.</li>
<li>В качестве значения по адресу <span class="monoi">p</span> записываем 0. Поскольку <span class="monoi">p</span> указывает на <span class="monoi">x</span>, то значение <span class="monoi">x</span> меняется. Переменная <span class="monoi">p</span> не указывает на <span class="monoi">y</span>, поэтому там остается прежнее значение. </li>
<li>Указателю <span class="monoi">q</span> присваивается адрес переменной <span class="monoi">z</span>. Извлекая оттуда значение (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span>q</code></span>), получаем 3.</li>
<li>Переменной <span class="monoi">p</span> присваивается значение, хранимое в <span class="monoi">q</span>. Это значит, что <span class="monoi">p</span> начинает ссылаться на тот же участок памяти, что и <span class="monoi">q</span>. Поскольку <span class="monoi">q</span> ссылается на <span class="monoi">z</span>, то и <span class="monoi">p</span> начинает ссылаться туда же.</li>
<li>В качестве значения по адресу <span class="monoi">p</span> записываем 4. Т.к. <span class="monoi">p</span> является указателем на <span class="monoi">z</span>, следовательно, меняется значение <span class="monoi">z</span>.</li>
<li>Проверяем, <span class="monoi">p</span> и <span class="monoi">q</span> являются указателями на одну и туже ячейку памяти. </li>
</ol>
<p>Если для вас вышеописанное не очевидно, то повторите урок сначала, почитайте другие источники и добейтесь полного понимания, т.к. без этого дальше двигаться бесполезно.</p>
<p>Под сам указатель (там, где хранится адрес) также должна быть выделена память. Объем этой памяти можно узнать с помощью функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> <span style="color: #339933;">*</span>pi<span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> <span style="color: #339933;">*</span>pf<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%lu<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span>pi<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%lu<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span>pf<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Под указатели всех типов выделяется одинаковый объем памяти, т.к. размер адреса не зависит от типа, а зависит от вычислительной системы. В таком случае, зачем при объявлении указателя следует указывать тип данных, на который он может ссылаться? Дело в том, что по типу данных определяется, сколько ячеек памяти занимает значение, на которое ссылается указатель, и через сколько ячеек начнется следующее значение. </p>
<p>Если указатель объявлен, но не определен, то он ссылается на произвольный участок памяти с неизвестно каким значением:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> <span style="color: #339933;">*</span>pa<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>pb<span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> <span style="color: #339933;">*</span>pc<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; %p %p %p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> pa<span style="color: #339933;">,</span> pc<span style="color: #339933;">,</span> pb<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; %d %f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">*</span>pa<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>pc<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// может возникнуть ошибка</span></pre></div></p>
<p>Результат (в Ubuntu):</p>
<pre>
 0x400410 0x7fff5b729580 (nil) 
 -1991643855 0.000000
</pre><p>
Использование неопределенных указателей в программе при вычислениях чревато возникновением серьезных ошибок. Чтобы избежать этого, указателю можно присвоить значение, говорящее, что указатель никуда не ссылается (NULL). Использовать такой указатель в выражениях не получится, пока ему не будет присвоено конкретное значение:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a <span style="color: #339933;">=</span> 5<span style="color: #339933;">,</span> b <span style="color: #339933;">=</span> <span style="color: #0000dd;">7</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> c <span style="color: #339933;">=</span> <span style="color:#800080;">6.98</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> <span style="color: #339933;">*</span>pa<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>pb<span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> <span style="color: #339933;">*</span>pc<span style="color: #339933;">;</span>
&nbsp;
  pa <span style="color: #339933;">=</span> pb <span style="color: #339933;">=</span> NULL<span style="color: #339933;">;</span>
  pc <span style="color: #339933;">=</span> NULL<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; %15p %15p %15p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> pa<span style="color: #339933;">,</span> pc<span style="color: #339933;">,</span> pb<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #666666; font-style: italic;">// printf(&quot; %15d %15f %15d\n&quot;, *pa, *pc, *pb); // Error</span>
&nbsp;
  pa <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>a<span style="color: #339933;">;</span>
  pb <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>b<span style="color: #339933;">;</span>
  pc <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>c<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; %15p %15p %15p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> pa<span style="color: #339933;">,</span> pc<span style="color: #339933;">,</span> pb<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; %15d %15f %15d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">*</span>pa<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>pc<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>pb<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Результат (в Ubuntu):</p>
<pre>
           (nil)           (nil)           (nil) 
  0x7fffeabf4e44  0x7fffeabf4e4c  0x7fffeabf4e48 
               5        6.980000               7 
</pre><p>
В данном случае, если попытаться извлечь значение из памяти с помощью указателя, который никуда не ссылается, то возникает "ошибка сегментирования".</p>
<p>На этом уроке вы должны понять, что такое адрес переменной и как его получить (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">&amp;</span>var</code></span>), что такое переменная-указатель (<span class="geshifilter"><code class="c geshifilter-c">type <span style="color: #339933;">*</span>p_var<span style="color: #339933;">;</span> p_var <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>var</code></span>) и как получить значение, хранимое в памяти, зная адрес ячейки (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span>p_var</code></span>). Однако у вас может остаться неприятный осадок из-за непонимания, зачем все это надо? Это нормально. Понимание практической значимости указателей придет позже по мере знакомства с новым материалом.</p>
<p><span class="blue"><strong>Задание</strong><br />
Практически проверьте результат работы всех примеров данного урока, придумайте свои примеры работы с указателями.</span></p>
  </div>
<div id="node-368" class="section-2">
  <h1 class="book-heading">Урок 8. Функции. Передача аргументов по значению и по ссылке</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Общее представление</h3>
<p>Язык <span class="blue">C</span> как и большинство других языков программирования позволяет создавать программы, состоящие из множества функций, а также из одного или нескольких файлов исходного кода. До сих пор мы видели только функцию <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которая является главной в программе на <span class="blue">C</span>, поскольку выполнение кода всегда начинается с нее. Однако ничего не мешает создавать другие функции, которые могут быть вызваны из <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> или любой другой функции. На этом уроке мы рассмотрим создание только однофайловых программ, содержащих более чем одну функцию.</p>
<p>При изучении работы функций важно понимать, что такое локальная и что такое глобальная переменные. В языке программирования <span class="blue">C</span> глобальные (внешние) переменные объявляются вне какой-либо функции. С их помощью удобно организовывать обмен данными между функциями, однако это считается дурным тоном, т.к. легко запутывает программу. Локальные переменные в языке программирования <span class="blue">C</span> называют автоматическими. Область действия автоматических переменных распространяется только на ту функцию, в которой они были объявлены. Параметры функции также являются локальными переменными.</p>
<p>Структурная организация файла программы на языке <span class="blue">C</span>, содержащего несколько функций, может выглядеть немного по-разному. Т.к. выполнение начинается с <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, то ей должны быть известны спецификации (имена, количество и тип параметров, тип возвращаемого значения) всех функций, которые из нее вызываются. Отсюда следует, что объявляться функции должны до того, как будут вызваны. А вот определение функции уже может следовать и до и после <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Рассмотрим такую программу:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #993333;">float</span> median <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> a<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// объявление функции</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> num1 <span style="color: #339933;">=</span> 18<span style="color: #339933;">,</span> num2 <span style="color: #339933;">=</span> <span style="color: #0000dd;">35</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> result<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%10.1f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> median<span style="color: #009900;">&#40;</span>num1<span style="color: #339933;">,</span> num2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  result <span style="color: #339933;">=</span> median<span style="color: #009900;">&#40;</span>121<span style="color: #339933;">,</span> 346<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%10.1f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> result<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%10.1f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> median<span style="color: #009900;">&#40;</span>1032<span style="color: #339933;">,</span> 1896<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">float</span> median <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> n1<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> n2<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">// определение функции</span>
  <span style="color: #993333;">float</span> m<span style="color: #339933;">;</span>
&nbsp;
  m <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #993333;">float</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span>n1 <span style="color: #339933;">+</span> n2<span style="color: #009900;">&#41;</span> <span style="color: #339933;">/</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">return</span> m<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В данном случае в начале программы объявляется функция <span class="geshifilter"><code class="c geshifilter-c">median<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Объявляются тип возвращаемого ею значения (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">float</span></code></span>), количество и типы параметров (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span> a<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> b</code></span>). Обратите внимание, когда объявляются переменные, то их можно группировать: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">;</span></code></span>. Однако с параметрами функций так делать нельзя, для каждого параметра тип указывается отдельно: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> a<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> b<span style="color: #009900;">&#41;</span></code></span>. </p>
<p>Далее идет функция <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, а после нее — определение <span class="geshifilter"><code class="c geshifilter-c">median<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Имена переменных-параметров в объявлении функции никакой роли не играют (их вообще можно опустить, например, <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">float</span> median <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span><span style="color: #339933;">,</span> <span style="color: #993333;">int</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span>). Поэтому когда функция определяется, то имена параметров могут быть другими, однако тип и количество должны строго совпадать с объявлением.</p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">median<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращает число типа <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">float</span></code></span>. Оператор <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">return</span></code></span> возвращает результат выполнения переданного ему выражения; после <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">return</span></code></span> функция завершает свое выполнение, даже если далее тело функции имеет продолжение. Функция <span class="geshifilter"><code class="c geshifilter-c">median<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> вычисляет среднее значение от двух целых чисел. В выражении <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span><span style="color: #993333;">float</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span>n1 <span style="color: #339933;">+</span> n2<span style="color: #009900;">&#41;</span> <span style="color: #339933;">/</span> <span style="color: #0000dd;">2</span></code></span> сначала вычисляется сумма двух целых чисел, результат преобразуется в вещественное число и только после этого делится на 2. Иначе мы бы делили целое на целое и получили целое (в таком случае дробная часть просто усекается).</p>
<p>В теле <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> функция <span class="geshifilter"><code class="c geshifilter-c">median<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> вызывается три раза. Результат выполнения функции не обязательно должен быть присвоен переменной.</p>
<p>Вышеописанную программу можно было бы записать так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #993333;">float</span> median <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> n1<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> n2<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">float</span> m<span style="color: #339933;">;</span>
&nbsp;
  m <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #993333;">float</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#40;</span>n1 <span style="color: #339933;">+</span> n2<span style="color: #009900;">&#41;</span> <span style="color: #339933;">/</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">return</span> m<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> num1 <span style="color: #339933;">=</span> 18<span style="color: #339933;">,</span> num2 <span style="color: #339933;">=</span> <span style="color: #0000dd;">35</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> result<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%10.1f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> median<span style="color: #009900;">&#40;</span>num1<span style="color: #339933;">,</span> num2<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  result <span style="color: #339933;">=</span> median<span style="color: #009900;">&#40;</span>121<span style="color: #339933;">,</span> 346<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%10.1f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> result<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%10.1f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> median<span style="color: #009900;">&#40;</span>1032<span style="color: #339933;">,</span> 1896<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Хотя такой способ и экономит одну строчку кода, однако главная функция, в которой отражена основная логика программы, опускается вниз, что может быть неудобно. Поэтому первый вариант предпочтительней.</p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите функцию, возводящую куб числа, переданного ей в качестве аргумента. Вызовите эту функцию с разными аргументами.</span></p>
<h3>Статические переменные</h3>
<p>В языке программирования <span class="blue">C</span> существуют так называемые статические переменные. Они могут быть как глобальными, так и локальными. Перед именем статической переменной пишется ключевое слово <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">static</span></code></span>.</p>
<p>Внешние статические переменные, в отличие от обычных глобальных переменных, нельзя использовать из других файлов в случае программы, состоящей не из одного файла. Они глобальны только для функций того файла, в котором объявлены. Это своего рода сокрытие данных, по принципу "не выставлять наружу ничего лишнего, чтобы 'что-нибудь' нечаянно не могло 'испортить' данные".</p>
<p>Статические переменные, объявленные внутри функций имеют такую же область действия, как автоматические. Однако в отличие от автоматических, значения локальных статических переменных не теряются, а сохраняются между вызовами функции:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #993333;">int</span> hello<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; - %d-й вызов<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> hello<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; - %d-й вызов<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> hello<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot; - %d-й вызов<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> hello<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">int</span> hello <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">static</span> count <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Hello world!&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">return</span> count<span style="color: #339933;">++;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Результат:</p>
<pre>
Hello world! - 1-й вызов 
Hello world! - 2-й вызов 
Hello world! - 3-й вызов
</pre><p>
В этом примере в функции <span class="geshifilter"><code class="c geshifilter-c">hello<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> производится подсчет ее вызовов.</p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте свой пример с использованием статической переменной.</span></p>
<h3>Передача аргументов по ссылке</h3>
<p>В первом примере этого урока мы передавали в функцию аргументы по значению. Это значит, что когда функция вызывается, ей передаются в качестве фактических параметров (аргументов) не указанные переменные, а копии значений этих переменных. Сами переменные к этим копиям уже никакого отношения не имеют. В вызываемой функции эти значения присваиваются переменным-параметрам, которые, как известно, локальны. Отсюда следует, что изменение переданных значений никакого влияния на переменные, переданные в функцию при вызове, не оказывают. В примере выше даже если бы в функции <span class="geshifilter"><code class="c geshifilter-c">median<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> менялись значения переменных <span class="monoi">n1</span> и <span class="monoi">n2</span>, то никакого влияния сей факт на переменные <span class="monoi">num1</span> и <span class="monoi">num2</span> не оказал.</p>
<p>Однако можно организовать изменение локальной переменной одной функции, с помощью другой функции. Сделать это можно, передав в функцию адрес переменной или указатель на нее. На самом деле в этом случае также передается копия значения. Но какого значения?! Это адрес на область памяти. На один и тот же участок памяти может существовать множество ссылок, и с помощью каждой из них можно поменять находящееся там значение. Рассмотрим пример: </p>
<p><div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #993333;">void</span> multi <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>px<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> y<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> x <span style="color: #339933;">=</span> 34<span style="color: #339933;">,</span> y <span style="color: #339933;">=</span> <span style="color: #0000dd;">6</span><span style="color: #339933;">;</span>
&nbsp;
  multi<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span>x<span style="color: #339933;">,</span> 367<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  multi<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span>y<span style="color: #339933;">,</span> 91<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> x<span style="color: #339933;">,</span> y<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> multi <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>base<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> pow<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>pow <span style="color: #339933;">&gt;=</span> 10<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
    <span style="color: #339933;">*</span>base <span style="color: #339933;">=</span> <span style="color: #339933;">*</span>base <span style="color: #339933;">*</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">;</span>
    pow <span style="color: #339933;">=</span> pow <span style="color: #339933;">/</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">multi<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> ничего не возвращает, что подчеркнуто с помощью ключевого слова <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">void</span></code></span>. Принимает эта функция адрес, который присваивается локальной переменной-указателю, и целое число. В теле функции происходит изменение значения по адресу, содержащемуся в указателе. Но по сути это адрес переменной x из фукнции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, а значит меняется и ее значение. </p>
<p>Когда <span class="geshifilter"><code class="c geshifilter-c">multi<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> вызывается в <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, то в качестве первого параметра мы должны передать адрес, а не значение. Поэтому, например, вызов <span class="geshifilter"><code class="c geshifilter-c">multi<span style="color: #009900;">&#40;</span>x<span style="color: #339933;">,</span> <span style="color: #0000dd;">786</span><span style="color: #009900;">&#41;</span></code></span> привел бы к ошибке, а вызов <span class="geshifilter"><code class="c geshifilter-c">multi<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span>x<span style="color: #339933;">,</span> <span style="color: #0000dd;">786</span><span style="color: #009900;">&#41;</span></code></span> — правильный, т.к. мы берем адрес переменной <span class="monoi">x</span> и передаем его в функцию. При этом ничего не мешает объявить в <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> указатель и передавать именно его (в данном случае сама переменная p содержит адрес):<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> x <span style="color: #339933;">=</span> 34<span style="color: #339933;">,</span> y <span style="color: #339933;">=</span> <span style="color: #0000dd;">6</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> <span style="color: #339933;">*</span>p<span style="color: #339933;">;</span>
&nbsp;
  p <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>x<span style="color: #339933;">;</span>
  multi<span style="color: #009900;">&#40;</span>p<span style="color: #339933;">,</span> 367<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  p <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>y<span style="color: #339933;">;</span>
  multi<span style="color: #009900;">&#40;</span>p<span style="color: #339933;">,</span> 367<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> x<span style="color: #339933;">,</span> y<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div><br />
Кроме того, следует знать, что функция может возвращать адрес.</p>
<p>Важно понять механизм так называемой передачи аргументов по ссылке, т.к. это понимание пригодится при изучении массивов и строк. Использовать указатели при работе с простыми типами данных не стоит. Лучше возвращать из функции значение, чем менять локальные переменные одной функции с помощью кода другой функции. Функции должны быть достаточно автономными.</p>
<h3>Решение задач</h3>
<p><span class="blue"><strong>Задания</strong></span></p>
<ol>
<li><span class="blue">Перепишите код первого примера этого урока так, чтобы в нем использовался указатель; а код примера с функцией <span class="geshifilter"><code class="c geshifilter-c">multi<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, наоборот, избавьте от указателей.</span></li>
<li><span class="blue">Напишите программу, в которой помимо функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> были бы еще две функции: в одной вычислялся факториал переданного числа, в другой — находился n-ый элемент ряда Фибоначчи (<span class="monoi">n</span> — параметр функции). Вызовите эти функции с разными аргументами.</span></li>
<li><span class="blue">Придумайте и напишите программу, в которой из функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> вызывается другая функция, а из последней вызывается еще одна функция.</span></li>
</ol>
  </div>
<div id="node-369" class="section-2">
  <h1 class="book-heading">Урок 9. Форматированный ввод данных</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>В то время как функция <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> осуществляет форматированный вывод данных, функция <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> осуществляет их форматированный ввод. Это значит, что поступающие на ввод данные преобразуются соответственно указанному формату(ам) и записываются по адресу(ам) указанной(ых) переменной(ых):</p>
<pre>scanf(строка_формата, адреса_переменных);</pre><p>
Причина, по которой в <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> передаются адреса, а не значения переменных, очевидна. Функция <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> должна изменять значения переменных тех функций, из которых вызывается. Единственный способ — это получить адреса областей памяти.</p>
<p>Спецификации формата данных, допустимые в строке формата, для <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> почти идентичны тем, что были описаны для функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. На этом уроке мы подробно не рассмотрим все возможности форматированного ввода с помощью <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, зато разберем ряд конкретных примеров.</p>
<h3>Ввод чисел, символов и строк</h3>
<p>Пример ввода-вывода целого и вещественного чисел, символа и строки:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">;</span>
  <span style="color: #993333;">float</span> b<span style="color: #339933;">;</span>
  <span style="color: #993333;">char</span> ch<span style="color: #339933;">,</span> str<span style="color: #009900;">&#91;</span>30<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d%f%c%s&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>a<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>b<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>ch<span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %.3f %c %s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> ch<span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Результат:</p>
<pre>
45 34.3456y hello 
45 34.346 y hello 
</pre><p>Здесь при выполнении программы все данные были введены в одну строку. Разделителем между числами и строками является пробел, а также любой другой символ пустого пространства (например, '\n'). Однако при считывании символа, пробел учитывается как символ; чтобы этого не произошло, в примере букву записали сразу после числа. Данные можно было бы ввести, разделяя их переходом на новую строку (опять же при этом надо иметь ввиду, как считывается символ).</p>
<p>В строке формата функции <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> между спецификациями вполне допустимо поставить пробелы: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">%</span>d &nbsp;<span style="color: #339933;">%</span>f <span style="color: #339933;">%</span>c <span style="color: #339933;">%</span>s</code></span>. Они никакой роли не сыграют. Понятно, что данные можно было получить и так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%f&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>ch<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Обратите внимание, перед переменной <span class="monoi">str</span> отсутствует знак амперсанда. Это не опечатка. В последующих уроках вы узнаете, что имя массива уже само по себе является ссылкой на массив (другими словами, <span class="monoi">str</span> содержит адрес начала массива).</p>
<p>В функции <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> в спецификации формата вещественных чисел не указывается точность представления числа. Запись типа %.3f или %.10lf приведет к невозможности получить вещественное число. Чтобы получить число типа double используют формат %lf, для long double - %Lf.</p>
<p>Для целых чисел: длинное целое - %ld, короткое целое - %hd. Кроме того, существуют спецификации для ввода восьмеричных и шестнадцатеричных чисел.</p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращает количество удачно считанных данных; т.е. значение, возвращаемое функцией, можно проанализировать и таким образом узнать, корректно ли были введены данные. Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">;</span>
  <span style="color: #993333;">double</span> b<span style="color: #339933;">;</span>
  <span style="color: #993333;">char</span> ch<span style="color: #339933;">,</span> str<span style="color: #009900;">&#91;</span>30<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span> 
&nbsp;
  ch <span style="color: #339933;">=</span> scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %lf %s&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>a<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>b<span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
&nbsp;
  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>ch <span style="color: #339933;">==</span> 3<span style="color: #009900;">&#41;</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %.3lf %s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #b1b100;">else</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Error input<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<h3>Использование обычных символов</h3>
<p>В строке формата <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> допустимо использование обычных символов. В этом случае при вводе данных также должны вводится и эти символы:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">int</span> a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> c<span style="color: #339933;">;</span>
&nbsp;
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d + %d = %d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>a<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>b<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>c<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Your answer is %d<span style="color: #000099; font-weight: bold;">\n</span>The correct answer is %d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> c<span style="color: #339933;">,</span> a<span style="color: #339933;">+</span>b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В данном случае, когда программа выполняется, ввод должен выглядеть примерно так: 342+1024 = 1366. Знаки "+" и "=" обязательно должны присутствовать между числами, наличие пробелов или их отсутствие абсолютно никакой роли не играет:</p>
<pre>
45 + 839=875 
Your answer is 875 
The correct answer is 884 
</pre><h3>Запрет присваивания</h3>
<p>Если какие-либо данные, вводимые пользователем, следует проигнорировать, то используют запрет присваивания, ставя после знака %, но перед буквой формата звездочку *. В таком случае данные считываются, но никакой переменной не присваиваются. Это можно использовать, например, когда нет определенной уверенности в том, что поступит на ввод, с одной стороны, и нужды сохранять эти данные, с другой:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">float</span> arr<span style="color: #009900;">&#91;</span>3<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
    scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%*s %f&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Sum: %.2f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> arr<span style="color: #009900;">&#91;</span>0<span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span>arr<span style="color: #009900;">&#91;</span>1<span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span>arr<span style="color: #009900;">&#91;</span>2<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Здесь предполагается, что перед каждым числом будет вводится строка, которую следует проигнорировать, например:</p>
<pre>
First: 23.356 
Second: 17.285 
Third: 32.457 
Sum: 73.098 
</pre><h3>Использование "шаблонов"</h3>
<p>Для функции <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> есть пара спецификаций формата, отдаленно напоминающих шаблоны командной оболочки и др. Формат […] позволяет получить строку, содержащую любые символы, указанные в квадратных скобках. Как только на ввод поступает символ, не входящий в указанный набор, считывание данных прекращается. Формат [^…], наоборот, помещает в строку символы, не входящие в указанный набор, до тех пор пока не встретит любой из указанных.</p>
<p>В примере ниже как только поступает не цифра, считывание ввода завершается. При этом если первый символ — не цифра, то в <span class="monoi">str</span> вообще ничего не записывается:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">30</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span><span style="color: #ff0000;">&quot;&quot;</span><span style="color: #339933;">;</span>
&nbsp;
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%[0-9]&quot;</span><span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>А в этом случае строке будет присвоена последовательность символов до любого из указанных знаков препинания:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%[^;:,!?]&quot;</span><span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Результат:</p>
<pre>
Hello, World! 
Hello
</pre><h3>Некоторые особенности и ограничения функции scanf()</h3>
<p>Как только поступают некорректные данные, функция <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> завершает свою работу. В примере:<br />
<span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d%f&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>a<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p>если переменной <span class="monoi">a</span> попытаться присвоить символ или строку, что невозможно, то переменная <span class="monoi">b</span> уже обрабатываться не будет. Можно предположить, что так будет надежнее:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%f&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Вроде бы неудачное считывание <span class="monoi">a</span> не должно оказывать никакого влияния на <span class="monoi">b</span>, т.к. это уже иной вызов <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Но не все так просто: при некорректном вводе данные остаются в буфере и пытаются "навязать" себя последующим вызовам <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Поэтому при использовании <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> надо думать о том, как в случае некорректного ввода очистить буфер. Например, это можно сделать так, как показано ниже, или путем использования специальных функций (здесь не рассматриваются):<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">  <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>a<span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> <span style="color: #0000dd;">1</span><span style="color: #009900;">&#41;</span> <span style="color: #666666; font-style: italic;">// если данные не удалось присвоить переменной,</span>
    scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%*s&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// то выбросить их в виде строки.</span>
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%f&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Разделителем данных для <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> являются символы пустого пространства. Это означает отсутствие возможности записать строку, содержащую неизвестное количество пробелов, в одну переменную, используя только <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Придется использовать либо другую функцию (например, <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>), либо создать циклическую конструкцию, считывающую по одному слову и добавляющую его к общей строке.</p>
<p>Таким образом, не смотря на достаточно большие возможности <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, эта функция хранит в себе ряд неудобств и опасностей. </p>
<h3>Решение задач</h3>
<ol>
<li><span class="blue">На прошлом занятии вы написали программу, содержащую функции, вычисляющие факториал числа и заданный элемент ряда Фибоначчи. Измените эту программу таким образом, чтобы она запрашивала у пользователя, что он хочет вычислить: факториал или число Фибоначчи. Затем программа запрашивала бы у пользователя либо число для вычисления факториала, либо номер элемента ряда Фибоначчи.</span></li>
<li><span class="blue">Напишите программу, которая запрашивает у пользователя две даты в формате дд.мм.гггг. Дни, месяцы и года следует присвоить целочисленным переменным. Программа должна выводить на экран информацию о том, какая дата более ранняя, а какая более поздняя.</span></li>
<li><span class="blue">Используя цикл, напишите код, в котором пользователю предлагается вводить данные до тех пор, пока он не сделает это корректно, т.е. пока все указанные в <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> переменные не получат свои значения. Протестируйте программу. Что вы наблюдаете и почему? Как можно решить проблему?</span></li>
</ol>
  </div>
<div id="node-370" class="section-2">
  <h1 class="book-heading">Урок 10. Псевдослучайные числа</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Функции rand() и srand()</h3>
<p>В языках программирования обычно предусмотрены функции, позволяющие генерировать случайные числа в определенном по умолчанию диапазоне. На самом деле генерируются не случайные, а так называемые псевдослучайные числа; они выглядят случайно, но вычисляются по вполне конкретной формуле. Но для простоты далее мы все равно будем называть их случайными.</p>
<p>В языке программирования <span class="blue">C</span> получить случайное число можно с помощью функции <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которая входит в стандартную библиотеку языка. Эта функция не принимает никакие параметры.</p>
<p><span class="blue">Задание<br />
Напишите программу, в которой целочисленной переменной присваивается результат выполнения функции <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Выведите значение переменной на экран.</span> </p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращает целое число от 0 до значения присвоенного константе <span class="monoi">RAND_MAX</span>. Значение <span class="monoi">RAND_MAX</span> зависит от системы и определено в заголовочном файле stdlib.h. Так, например, оно может быть равно 32767 (двухбайтовое целое) или 2147483647 (четырехбайтовое целое). </p>
<p><span class="blue">Задание<br />
Определите значение <span class="monoi">RAND_MAX</span> в вашей системе. Для этого не забудьте подключить к файлу исходного кода заголовочный файл stdlib.h.</span></p>
<p>Код ниже выводит на экран 50 случайных чисел:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;stdlib.h&gt;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
     <span style="color: #993333;">char</span> i<span style="color: #339933;">;</span>
&nbsp;
     <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i <span style="color: #339933;">=</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;=</span> <span style="color: #0000dd;">50</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
          <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%15d&quot;</span><span style="color: #339933;">,</span> rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
          <span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>i <span style="color: #339933;">%</span> 5 <span style="color: #339933;">==</span> 0<span style="color: #009900;">&#41;</span> <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
     <span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В теле цикла осуществляется переход на новую строку после каждых выведенных на экран пяти чисел. Для этого используется выражение, в котором находится остаток от деления <span class="monoi">i</span> на 5, результат сравнивается с 0. Чтобы после первого числа не происходил переход на новую строку, <span class="monoi">i</span> сначала присваивается единица, а не ноль (т.к. 0 делится на 5 без остатка).</p>
<p><span class="blue">Задание<br />
Спишите код, приведенный выше. Выполните программу несколько раз, при этом обратите внимание, разные ли результаты вы получаете от выполнения к выполнению.</span></p>
<p>Вы должны были заметить, что при каждом запуске программы числа остаются одинаковыми. Даже если вы перекомпилируете программу, результат не изменится. Данный эффект связан с тем, что начальное (инициализирующее) число, которое подставляется в формулу вычисления первого и последующих псевдослучайных чисел, для каждой системы всегда одно и то же. Однако это начальное число можно изменить с помощью функции <span class="geshifilter"><code class="c geshifilter-c">srand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которой в качестве параметра передается любое целое число. Понятно, что если вы зададите конкретный аргумент для функции, например, <span class="geshifilter"><code class="c geshifilter-c">srand<span style="color: #009900;">&#40;</span><span style="color: #0000dd;">1000</span><span style="color: #009900;">&#41;</span></code></span>, то от вызова к вызову программы числа будут также одни и те же. Хотя и не те, что были бы без <span class="geshifilter"><code class="c geshifilter-c">srand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Поэтому появляется проблема, как сделать так, чтобы аргумент для <span class="geshifilter"><code class="c geshifilter-c">srand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> был тоже случайным? Получается замкнутый круг.</p>
<p><span class="blue">Задание<br />
Переделайте программу, выводящую на экран 50 случайных чисел так, чтобы сначала у пользователя запрашивалось любое целое число с помощью <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которое передавалось бы в функцию <span class="geshifilter"><code class="c geshifilter-c">srand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>.</span></p>
<p>Пользователь программы сам может задавать инициализирующее значение. Но чаще всего это не является полноценным выходом из ситуации. Поэтому инициализирующее значение привязывают к какому-либо процессу, протекающему в операционной системе, например, к часам. Время (учитывая не только время суток, но и дату) никогда не бывает одинаковым. Значит значение для <span class="geshifilter"><code class="c geshifilter-c">srand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, преобразованное в целое из системного времени, будет различным.</p>
<p>Текущее время можно узнать с помощью функции <span class="geshifilter"><code class="c geshifilter-c">time<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, прототип которой описан в файле time.h. Передав <span class="geshifilter"><code class="c geshifilter-c">time<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> в качестве параметра NULL, мы получим целое число, которое можно передать в <span class="geshifilter"><code class="c geshifilter-c">srand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>:<br />
<span class="geshifilter"><code class="c geshifilter-c">srand<span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#40;</span>NULL<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p><span class="blue">Задание<br />
Переделайте вашу программу так, чтобы инициализирующее значение зависело от системного времени.</span></p>
<h3>Получение целых случайных чисел в заданных диапазонах</h3>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выдает случайное число от 0 до значения RAND_MAX. Что делать, если требуется получать случайные числа в иных диапазонах, например, от 100 до 999?</p>
<p>Сначала рассмотрим более простую ситуацию: получить случайные числа от 0 до 5. Если любое целое число попытаться разделить на 5 нацело, то можно получить как 0 (когда число делится на 5 без остатка), так и 1, 2, 3, 4. Например, <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> вернула число 283. Применяя к этому числу операцию нахождения остатка от деления на 5, получим 3. Т.е. выражение <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%</span> <span style="color: #0000dd;">5</span></code></span> дает любое число в диапазоне [0, 5).</p>
<p>Однако, что если надо, чтобы число 5 так же входило в диапазон, т.е. диапазон имеет вид [0, 5]? Логично предположить, что следует найти остаток от деления на 6. При этом более грамотным будет следующее рассуждение: надо находить остаток от деления на размер диапазона. В данном случае он равен шести значениям: 0, 1, 2, 3, 4, 5. Чтобы найти размер диапазона надо из допустимого максимума вычесть допустимый минимум и прибавить единицу: max - min + 1. Будьте внимательны: если, например, требуется, чтобы указанный в задаче максимум не входил в диапазон, то единицу прибавлять не надо или надо вычитать единицу из максимума.</p>
<p><span class="blue">Задание<br />
Напишите программу, выдающую 50 случайных чисел от 0 до 99 включительно.</span></p>
<p>Итак, мы знаем формулу получения длины диапазона: max - min + 1. Если требуется получить число от 6 до 10 включительно, то длина диапазона будет равна 10 - 6 + 1 = 5. Выражение <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%</span> <span style="color: #0000dd;">5</span></code></span> даст любое число от 0 до 4 включительно. Но нам надо от 6 до 10. В таком случае достаточно к полученному случайному остатку прибавить 6, т.е. минимум. Другими словами, надо выполнить сдвиг. Действительно для приведенного примера:</p>
<ul>
<li>если остаток был равен 0, то добавляя 6, получаем 6;</li>
<li>остаток 1, добавляем 6, получаем 7;</li>
<li>…</li>
<li>остаток 4, прибавляем 6, получаем 10;</li>
<li>остатка больше 4 не может быть.</li>
</ul>
<p>В таком случае формула для получения случайного числа в диапазоне [a, b] выглядит так:</p>
<pre>rand() % длина_диапазона + сдвиг</pre><p>,<br />
где <span class="monoi">длина_диапазона</span> вычисляется как b - a + 1, сдвиг является значением <span class="monoi">a</span>. </p>
<p>В эту формулу также вписываются случаи, когда необходимо получить случайное число от 0 до N, т.е. они являются ее частными случаями.</p>
<p><span class="blue">Задание<br />
Выведите на экран ряд случайных чисел, принадлежащих диапазону от 100 до 299 включительно.</span></p>
<p>С таким же успехом можно получать случайные отрицательные числа. Действительно, если диапазон задан как [-35, -1], то его длина будет равна -1 - (-35) + 1 = 35, что соответствует действительности; выражение получения случайного числа будет выглядеть так:<br />
<span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%</span> <span style="color: #0000dd;">35</span> <span style="color: #339933;">-</span> <span style="color: #0000dd;">35</span> </code></span></p>
<p>Так, если остаток от деления составил 0, то мы получим -35, а если 34, то -1. Остальные остатки дадут значения в промежутке от -35 до -1.</p>
<p><span class="blue">Задание<br />
Выведите на экран ряд случайных чисел, принадлежащих диапазону от -128 до 127 включительно.</span></p>
<h3>Получение вещественных случайных чисел</h3>
<p>Ситуация с вещественными числами выглядит несколько по-иному. Во-первых, мы не можем получить остаток от деления, если делимое или делитель дробное число. Во вторых при вычислении длины диапазона нельзя прибавлять единицу.</p>
<p>Поясним вторую причину. Допустим диапазон задан как [2.50, 5.30]. Он состоит не из определенного количества чисел (как в случае целых), а из неопределенного (можно сказать, бесконечного) числа значений, т.к. вещественные числа можно представлять с различной степенью точности. Позже выполняя округление все равно будет шанс получить максимальную границу диапазона, поэтому для вычисления длины диапазона достаточно из максимума вычесть минимум.</p>
<p>Если разделить случайное число, преобразованное к вещественному типу, которое выдала функция <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, на значение константы <span class="monoi">RAND_MAX</span>, то получится вещественное случайное число от 0 до 1. Теперь, если это число умножить на длину диапазона, то получится число, лежащее в диапазоне от 0 до значения длины диапазона. Далее если прибавить к нему смещение к минимальной границе, то число благополучно впишется в требуемый диапазон. Таким образом формула для получения случайного вещественного числа выглядит так:<br />
<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span><span style="color: #993333;">float</span><span style="color: #009900;">&#41;</span> rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">/</span> RAND_MAX <span style="color: #339933;">*</span> <span style="color: #009900;">&#40;</span>max <span style="color: #339933;">-</span> min<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> min</code></span></p>
<p><span class="blue">Задание<br />
Заполните массив случайными числами в диапазоне от 0.51 до 1.00. Выведите значение элементов массива на экран.</span></p>
<h3>Равновероятные случайные числа</h3>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> генерирует любое случайное число от 0 до <span class="monoi">RAND_MAX</span> с равной долей вероятности. Другими словами, у числа 100 есть такой же шанс выпасть, как и у числа 25876.</p>
<p>Чтобы доказать это, достаточно написать программу, подсчитывающую количество выпадений каждого из значений. Если выборка (количество "испытуемых") будет достаточно большой, а диапазон (разброс значений) маленьким, то мы должны увидеть, что процент выпадений того или иного значения приблизительно такой же как у других.<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;time.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 500</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
  <span style="color: #993333;">int</span> arr<span style="color: #009900;">&#91;</span>5<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>0<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
  srand<span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#40;</span>NULL<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>   
    <span style="color: #b1b100;">switch</span> <span style="color: #009900;">&#40;</span>rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%</span> 5<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
      <span style="color: #b1b100;">case</span> 0<span style="color: #339933;">:</span> arr<span style="color: #009900;">&#91;</span>0<span style="color: #009900;">&#93;</span><span style="color: #339933;">++;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
      <span style="color: #b1b100;">case</span> 1<span style="color: #339933;">:</span> arr<span style="color: #009900;">&#91;</span>1<span style="color: #009900;">&#93;</span><span style="color: #339933;">++;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
      <span style="color: #b1b100;">case</span> 2<span style="color: #339933;">:</span> arr<span style="color: #009900;">&#91;</span>2<span style="color: #009900;">&#93;</span><span style="color: #339933;">++;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
      <span style="color: #b1b100;">case</span> 3<span style="color: #339933;">:</span> arr<span style="color: #009900;">&#91;</span>3<span style="color: #009900;">&#93;</span><span style="color: #339933;">++;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
      <span style="color: #b1b100;">case</span> 4<span style="color: #339933;">:</span> arr<span style="color: #009900;">&#91;</span>4<span style="color: #009900;">&#93;</span><span style="color: #339933;">++;</span> <span style="color: #000000; font-weight: bold;">break</span><span style="color: #339933;">;</span>
    <span style="color: #009900;">&#125;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> <span style="color: #0000dd;">5</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> 
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d - %.2f%%<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">,</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #993333;">float</span><span style="color: #009900;">&#41;</span> arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">/</span> N<span style="color: #009900;">&#41;</span> <span style="color: #339933;">*</span> 100<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В приведенной программе массив из пяти элементов сначала заполняется нулями. Случайные числа генерируются от 0 до 4 включительно. Если выпадает число 0, то увеличивается значение первого элемента массива, если число 1, то второго, и т.д. В конце на экран выводится процент выпадения каждого из чисел.</p>
<p><span class="blue">Задание<br />
Спишите данную программу. Посмотрите на результат ее выполнения при различных значениях N: 10, 50, 500, 5000, 50000. Объясните увиденное.</span></p>
  </div>
<div id="node-371" class="section-2">
  <h1 class="book-heading">Урок 11. Особенности массивов при работе с указателями</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>К указателям можно прибавлять целые числа</h3>
<p>Рассмотрим программу:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 5</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> arrI<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>arrI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Создается массив <span class="monoi">arrI</span>, далее в цикле <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span> выводятся значения адресов ячеек памяти каждого элемента массива. Результат выполнения программы будет выглядеть примерно так:</p>
<pre>
0x7ffffbff4050 
0x7ffffbff4054 
0x7ffffbff4058 
0x7ffffbff405c 
0x7ffffbff4060 
</pre><p>Обратите внимание на то, что значение адреса каждого последующего элемента массива больше значения адреса предыдущего элемента на 4 единицы. В вашей системе эта разница может составлять 2 единицы. Такой результат вполне очевиден, если вспомнить, сколько байтов отводится на одно данное типа int, и что элементы массива сохраняются в памяти друг за другом.</p>
<p>Теперь объявим указатель на целый тип и присвоим ему адрес первого элемента массива:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">int</span> <span style="color: #339933;">*</span>pI<span style="color: #339933;">;</span>
&nbsp;
	pI <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>arrI<span style="color: #009900;">&#91;</span>0<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Цикл <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span> изменим таким образом:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> pI <span style="color: #339933;">+</span> i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Здесь к значению <span class="monoi">pI</span>, которое является адресом ячейки памяти, прибавляется сначала 0, затем 1, 2, 3 и 4. Можно было бы предположить, что прибавление к <span class="monoi">pI</span> единицы в результате дает адрес следующего байта за тем, на который указывает <span class="monoi">pI</span>. А прибавление двойки вернет адрес байта, через один от исходного. Однако подобное предположение не верно. </p>
<p>Вспомним, что тип указателя сообщает, на сколько байт простирается значение по адресу, на который он указывает. Таким образом, хотя <span class="monoi">pI</span> указывает только на один байт (первый), но "знает", что его "собственность" простирается на все четыре (или два). Когда мы прибавляем к указателю единицу, то получаем указатель на следующее значение, но никак не на следующий байт. А следующее значение начинается только через 4 байта (в данном случае). Поэтому результат выполнения приведенного цикла с указателем правильно отобразит адреса элементов массива.</p>
<p><span class="blue"><strong>Задание</strong><br />
Убедитесь в этом сами.</span></p>
<p>Прибавляя к указателям (или вычитая из них) целые значения, мы имеем дело с так называемой адресной арифметикой.</p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите программу, в которой объявлен массив вещественных чисел из десяти элементов. Присвойте указателю адрес четвертого элемента, затем, используя цикл, выведите на экран адреса 4, 5 и 6-ого элементов массива.</span></p>
<h3>Имя массива содержит адрес его первого элемента</h3>
<p>Да, это именно так, данный факт следует принять как аксиому. Вы можете убедиться в этом выполнив такое выражение:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%p = %p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> arrI<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>arrI<span style="color: #009900;">&#91;</span>0<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Отсюда следует, что имя массива – это ничто иное, как указатель. (Хотя это немного особенный указатель, о чем будет упомянуто ниже.) Поэтому выражения <span class="geshifilter"><code class="c geshifilter-c">pI <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>arrI<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">pI <span style="color: #339933;">=</span> arrI</code></span> дают одинаковый результат: присваивают указателю <span class="monoi">pI</span> адрес первого элемента массива.</p>
<p>Раз имя массива — это указатель, ничего не мешает получать адреса элементов вот так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> arrI <span style="color: #339933;">+</span> i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Соответственно значения элементов массива можно получить так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#40;</span>arrI <span style="color: #339933;">+</span> i<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Примечание. Если массив был объявлен как автоматическая переменная (т.е. не глобальная и не статическая) и при этом не был инициализирован (не присваивались значения), то в нем будет содержаться "мусор" (случайные числа).</p>
<p>Получается, что запись вида <span class="monoi">arrI[3]</span> является сокращенным (более удобным) вариантом выражения <span class="monoi">*(arr+3)</span>.</p>
<h3>Взаимозаменяемость имени массива и указателя</h3>
<p>Если имя массива является указателем, то почему бы не использовать обычный указатель в нотации обращения к элементам массива также, как при обращении через имя массива:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">int</span> arrI<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> <span style="color: #339933;">*</span>pI<span style="color: #339933;">;</span>
&nbsp;
	pI <span style="color: #339933;">=</span> arrI<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> pI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Отсюда следуют выводы. Если <span class="monoi">arrI</span> — массив, а <span class="monoi">pI</span> — указатель на его первый элемент, то пары следующих выражений дают один и тот же результат:</p>
<ul>
<li><span class="geshifilter"><code class="c geshifilter-c">arrI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">pI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span>;</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">&amp;</span>arrI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">&amp;</span>pI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span>;</li>
<li><span class="geshifilter"><code class="c geshifilter-c">arrI<span style="color: #339933;">+</span>i</code></span> и <span class="geshifilter"><code class="c geshifilter-c">pI<span style="color: #339933;">+</span>i</code></span>;</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span><span style="color: #009900;">&#40;</span>arrI<span style="color: #339933;">+</span>i<span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span><span style="color: #009900;">&#40;</span>pI<span style="color: #339933;">+</span>i<span style="color: #009900;">&#41;</span></code></span>.</li>
</ul>
<p><span class="blue"><strong>Задание</strong><br />
Что получается в результате выполнения данных пар выражений: адреса или значения элементов массива? Если вы испытываете трудности при ответе на этот вопрос, перечитайте урок 7, этот урок, изучите другие источники.</span></p>
<p>Указателю <span class="monoi">pI</span> можно присвоить адрес любого из элементов массива. Например, так <span class="geshifilter"><code class="c geshifilter-c">pI <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>arrI<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">2</span><span style="color: #009900;">&#93;</span></code></span> или так <span class="geshifilter"><code class="c geshifilter-c">pI <span style="color: #339933;">=</span> arr<span style="color: #339933;">+</span><span style="color: #0000dd;">2</span></code></span>. В таком случае результат приведенных выше пар выражений совпадать не будет. Например, когда будет выполняться выражение <span class="geshifilter"><code class="c geshifilter-c">arrI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span>, то будет возвращаться i-ый элемент массива. А вот выражение <span class="geshifilter"><code class="c geshifilter-c">pI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span> уже вернет не i-ый элемент от начала массива, а i-ый элемент от того, адрес которого был присвоен <span class="monoi">pI</span>. Например, если <span class="monoi">pI</span> был присвоен адрес третьего элемента массива (<span class="geshifilter"><code class="c geshifilter-c">pI <span style="color: #339933;">=</span> arr<span style="color: #339933;">+</span><span style="color: #0000dd;">2</span></code></span>), то выражение <span class="geshifilter"><code class="c geshifilter-c">arrI<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #009900;">&#93;</span></code></span> вернет значение второго элемента массива, а <span class="geshifilter"><code class="c geshifilter-c">pI<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #009900;">&#93;</span></code></span> — четвертого.</p>
<p><span class="blue"><strong>Задание</strong><br />
Присвойте указателю (<span class="monoi">pI</span>) ссылку не на первый элемент массива (<span class="monoi">arrI</span>). В одном и том же цикле выводите результат выражений <span class="geshifilter"><code class="c geshifilter-c">arrI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">pI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span>, где на каждой итерации цикла <span class="monoi">i</span> для обоих выражений имеет одинаковое значение. Объясните результат выполнения такой программы.</span></p>
<h3>Имя массива — это указатель-константа</h3>
<p>Несмотря на вышеописанную взаимозаменяемость имени массива определенного типа на указатель того же типа, между ними есть разница. Указатель может указывать на любой элемент массива, его значение можно изменять. Имя массива всегда указывает только на первый элемент массива, изменять его значение нельзя.</p>
<p>Это значит, что выражение <span class="geshifilter"><code class="c geshifilter-c">pI <span style="color: #339933;">=</span> arrI</code></span> допустимо, а <span class="geshifilter"><code class="c geshifilter-c">arrI <span style="color: #339933;">=</span> pI</code></span> нет. Имя массива является константой. При этом не надо путать имя массива (адрес) и значения элементов массива. Последние константами не являются. Действительно, ведь для всех переменных мы не можем менять их адрес в процессе выполнения программы, можем менять лишь их значения. В этом смысле имя массива — это обычная переменная, хотя и содержащая адрес.</p>
<p>Как следствие в программном коде выражения присваивания, инкрементирования и декрементирования допустимы для указателей, а для имени массива — запрещены.</p>
<p><span class="blue"><strong>Задание</strong><br />
Посмотрите на программу ниже. Что она делает? Почему? Проверьте ваши рассуждения опытным путем.</span><br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span>20<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #339933;">*</span>ps <span style="color: #339933;">=</span> str<span style="color: #339933;">,</span> n<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Enter word: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">while</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">*</span>ps<span style="color: #339933;">++</span> <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #009900;">&#41;</span> n<span style="color: #339933;">++;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> n<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
  </div>
<div id="node-372" class="section-2">
  <h1 class="book-heading">Урок 12. Массивы и функции</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Массивы, также как остальные переменные, можно передавать в функции в качестве аргументов. Рассмотрим такую программу:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;time.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 10</span>
&nbsp;
<span style="color: #993333;">void</span> arr_make<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> arr<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #993333;">int</span> min<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> max<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> arrI<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">;</span>
&nbsp;
  arr_make<span style="color: #009900;">&#40;</span>arrI<span style="color: #339933;">,</span> 30<span style="color: #339933;">,</span> 90<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
    <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d &quot;</span><span style="color: #339933;">,</span> arrI<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> arr_make<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> arr<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #993333;">int</span> min<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> max<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
  srand<span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#40;</span>NULL<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
    arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%</span> <span style="color: #009900;">&#40;</span>max <span style="color: #339933;">-</span> min <span style="color: #339933;">+</span> 1<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> min<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В теле функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> объявляется массив, состоящий из 10 элементов. Далее вызывается функция <span class="geshifilter"><code class="c geshifilter-c">arr_make<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которой передаются в качестве аргументов имя массива и два целых числа. </p>
<p>Если посмотреть на функцию <span class="geshifilter"><code class="c geshifilter-c">arr_make<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, то можно заметить, что ее первый параметр выглядит немного странно. Функция принимает массив неизвестно какого размера. Если предположить, что массивы передаются по значению, т.е. передаются их копии, то как при компиляции будет вычислен необходимый объем памяти для функции <span class="geshifilter"><code class="c geshifilter-c">arr_make<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, если неизвестно какого размера будет один из ее параметров?</p>
<p>На прошлом уроке мы выяснили, что имя массива — это константный указатель на первый элемент массива; т.е. имя массива содержит адрес. Выходит, что мы передаем в функцию копию адреса, а не копию значения. Как мы уже знаем, передача адреса приводит к возможности изменения локальных переменных в вызывающей функции из вызываемой. Ведь на одну и ту же ячейку памяти могут ссылаться множество переменных, и изменение значения в этой ячейке с помощью одной переменной неминуемо отражается на значениях других переменных.</p>
<p>Описание вида <span class="geshifilter"><code class="c geshifilter-c">arr<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span></code></span> в параметрах функций говорит о том, что в качестве значения мы получаем указатель на массив, а не обычную (скалярную) переменную типа int, char, float и т.п.</p>
<p><span class="blue"><strong>Задание</strong><br />
Проверьте как работает программа. Что происходит внутри тела функции <span class="geshifilter"><code class="c geshifilter-c">arr_make<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>?</span></p>
<p>Продолжим рассуждения. Если в функцию передается только адрес массива, то в теле функции никакого массива не существует, и когда там выполняется выражение типа <span class="geshifilter"><code class="c geshifilter-c">arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span>, то на самом деле <span class="monoi">arr</span> — это не имя массива, а переменная-указатель, к которой прибавляется смещение. Поэтому цикл в функции <span class="geshifilter"><code class="c geshifilter-c">arr_make<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> можно переписать на такой:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
	<span style="color: #339933;">*</span>arr<span style="color: #339933;">++</span> <span style="color: #339933;">=</span> rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%</span> <span style="color: #009900;">&#40;</span>max <span style="color: #339933;">-</span> min <span style="color: #339933;">+</span> 1<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> min<span style="color: #339933;">;</span></pre></div></p>
<p>В теле цикла результат выражения справа от знака присваивания записывается по адресу, на который указывает <span class="monoi">arr</span>. За это отвечает выражение <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span>arr</code></span>. Затем указатель <span class="monoi">arr</span> начинает указывать на следующую ячейку памяти, т.к. к нему прибавляется единица (<span class="geshifilter"><code class="c geshifilter-c">arr<span style="color: #339933;">++</span></code></span>). Еще раз: сначала выполняется выражение записи значения по адресу, который содержится в <span class="monoi">arr</span>; после чего изменяется адрес, содержащийся в указателе (сдвигается на одну ячейку памяти определенного размера).</p>
<p>Поскольку мы можем изменять <span class="monoi">arr</span>, это доказывает, что <span class="monoi">arr</span> — обычный указатель, а не имя массива. Тогда зачем в заголовке функции такой гламур, как <span class="geshifilter"><code class="c geshifilter-c">arr<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span></code></span>? Действительно, чаще  используют просто переменную-указатель:<br />
<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">void</span> arr_make<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> min<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> max<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p>Хотя в таком случае становится не очевидно, что принимает функция - указатель на обычную переменную или все-таки на массив. В любом случае она будет работать.</p>
<p><span class="blue"><strong>Задание</strong><br />
Перепишите программу с использованием нотации указателей.</span></p>
<p>Часто при передаче в функцию массивов туда же передают и количество его элементов в виде отдельного параметра. В примере выше <span class="monoi">N</span> является глобальной константой, поэтому ее значение доступно как из функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, так и <span class="geshifilter"><code class="c geshifilter-c">arr_make<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Иначе, более грамотно было бы написать функцию <span class="geshifilter"><code class="c geshifilter-c">arr_make<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">void</span> arr_make<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> n<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> min<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> max<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
  srand<span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#40;</span>NULL<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>n<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
    arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%</span> <span style="color: #009900;">&#40;</span>max <span style="color: #339933;">-</span> min <span style="color: #339933;">+</span> 1<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> min<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В данном случае параметр <span class="monoi">n</span> — это количество обрабатываемых элементов массива.</p>
<p>Следует еще раз обратить внимание на то, что при передачи имени массива в функцию, последняя может его изменять. Однако такой эффект не всегда является желательным. Конечно, можно просто не менять значения элементов массива внутри функции, как в данном примере, где вычисляется сумма элементов массива; при этом сами элементы никак не изменяются:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">int</span> arr_sum<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> s<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	s <span style="color: #339933;">=</span> s <span style="color: #339933;">+</span> arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
  <span style="color: #009900;">&#125;</span>
&nbsp;
  <span style="color: #b1b100;">return</span> s<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Но если вы хотите написать более надежную программу, в которой большинство функций не должны менять значения элементов массивов, то лучше в заголовках этих функций объявлять параметр-указатель как константу, например:<br />
<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span> arr_sum<span style="color: #009900;">&#40;</span><span style="color: #993333;">const</span> <span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p>В этом случае, любая попытка изменить значение по адресу, содержащемуся в таком константном указателе, будет приводить к ошибке и программист будет знать, что в функция пытается изменить массив.</p>
<p>Усовершенствуем программу, которая была приведена в начале этого урока:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;time.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 10</span>
&nbsp;
<span style="color: #993333;">void</span> arr_make<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> min<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> max<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> arr_inc_dec<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> arr<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #993333;">char</span> sign<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> arr_print<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
  <span style="color: #993333;">int</span> arrI<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">,</span> minimum<span style="color: #339933;">,</span> maximum<span style="color: #339933;">;</span>
  <span style="color: #993333;">char</span> ch<span style="color: #339933;">;</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Enter minimum &amp; maximum: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d %d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>minimum<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>maximum<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  arr_make<span style="color: #009900;">&#40;</span>arrI<span style="color: #339933;">,</span> minimum<span style="color: #339933;">,</span> maximum<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  arr_print<span style="color: #009900;">&#40;</span>arrI<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%*c&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// избавляемся от \n</span>
&nbsp;
  <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Enter sign (+,-): &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>ch<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  arr_inc_dec<span style="color: #009900;">&#40;</span>arrI<span style="color: #339933;">,</span> ch<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
  arr_print<span style="color: #009900;">&#40;</span>arrI<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>  
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> arr_make<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> min<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> max<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>  
      <span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
      srand<span style="color: #009900;">&#40;</span>time<span style="color: #009900;">&#40;</span>NULL<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
      <span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
	    <span style="color: #339933;">*</span>arr<span style="color: #339933;">++</span> <span style="color: #339933;">=</span> rand<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">%</span> <span style="color: #009900;">&#40;</span>max <span style="color: #339933;">-</span> min <span style="color: #339933;">+</span> 1<span style="color: #009900;">&#41;</span> <span style="color: #339933;">+</span> min<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> arr_inc_dec<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #339933;">,</span> <span style="color: #993333;">char</span> sign<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>	
	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>sign <span style="color: #339933;">==</span> <span style="color: #ff0000;">'+'</span><span style="color: #009900;">&#41;</span> arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">++;</span>
		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>sign <span style="color: #339933;">==</span> <span style="color: #ff0000;">'-'</span><span style="color: #009900;">&#41;</span> arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #339933;">--;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> arr_print<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> <span style="color: #339933;">*</span>arr<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;The array is: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d &quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">*</span>arr<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
      <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Теперь у пользователя запрашивается минимум и максимум, затем создается массив из элементов, значения которых лежат в указанном диапазоне. Массив выводится на экран с помощью функции <span class="geshifilter"><code class="c geshifilter-c">arr_print<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Далее у пользователя запрашивается знак + или -. Вызывается функция <span class="geshifilter"><code class="c geshifilter-c">arr_inc_dec<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которая в зависимости от введенного знака увеличивает или уменьшает на единицу значения элементов массива.</p>
<p>В функциях <span class="geshifilter"><code class="c geshifilter-c">arr_make<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">arr_print<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> используется нотация указателей. Причем в теле функций значения указателей меняются: они указывают сначала на первый элемент массива, затем на второй и т.д. В функции <span class="geshifilter"><code class="c geshifilter-c">arr_inc_dec<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> используется вид обращения к элементам массива. При этом значение указателя не меняется: к <span class="monoi">arr</span> прибавляется смещение, которое увеличивается на каждой итерации цикла. Ведь на самом деле запись <span class="geshifilter"><code class="c geshifilter-c">arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span> означает <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span><span style="color: #009900;">&#40;</span>arr<span style="color: #339933;">+</span>i<span style="color: #009900;">&#41;</span></code></span>.</p>
<p>При использовании нотации обращения к элементам массива программы получаются более ясные, а при использовании записи с помощью указателей они компилируются чуть быстрее. Это связано с тем, что когда компилятор встречает выражение типа <span class="geshifilter"><code class="c geshifilter-c">arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span></code></span>, то он тратит время на  преобразование его к виду <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span><span style="color: #009900;">&#40;</span>arr<span style="color: #339933;">+</span>i<span style="color: #009900;">&#41;</span></code></span>. Однако лучше потратить лишнюю секунду при компиляции, но получить более читаемый код. </p>
<p><span class="blue"><strong>Задания</strong></span></p>
<ol>
<li><span class="blue">Переделайте программу, которая приведена выше таким образом, чтобы она работала с вещественными числами. Вместо функции <span class="geshifilter"><code class="c geshifilter-c">arr_inc_dec<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> напишите другую, которая изменяет значения элементов массива на любое значение, которое указывает пользователь.</span></li>
<li><span class="blue">Напишите программу, в которой из одной функции в другую передается указатель не на начало массива, а на его середину.</span></li>
<li><span class="blue">Напишите программу, в которой из функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> в другую функцию передаются два массива: "заполненный" и "пустой". В теле этой функции элементам "пустого" массива должны присваиваться значения, так или иначе преобразованные из значений элементов "заполненного" массива, который не должен изменяться.</span></li>
</ol>
  </div>
<div id="node-373" class="section-2">
  <h1 class="book-heading">Урок 13. Особенности работы со строками</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Неформатированные ввод из стандартного потока и вывод в стандартный поток</h3>
<p>С помощью функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> можно легко вывести на экран строку, содержащую пробелы:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;Hello world&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p>С другой стороны, ввести строку произвольной длины, содержащую пробелы в неизвестных местах, исключительно с помощью функции <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> невозможно. Для <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> любой символ пустого пространства является сигналом завершения ввода очередных данных, если только не производится считывание символа.</p>
<p>На помощь может прийти функция <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, осуществляющая посимвольный ввод данных:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span>20<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#40;</span>str<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	str<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В заголовке цикла <span class="geshifilter"><code class="c geshifilter-c">getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращает символ, далее записываемый в очередную ячейку массива. После этого элемент массива сравнивается с символом '\n'. Если они равны, то цикл завершается. После цикла символ '\n' в массиве "затирается" символом '\0'. В условии цикла должна быть также предусмотрена проверка на выход за пределы массива; чтобы не усложнять пример, опущена.</p>
<p>Однако в языке программирования <span class="blue">C</span> работать со строками можно проще. С помощью функций стандартной библиотеки <span class="geshifilter"><code class="c geshifilter-c">gets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">puts<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> получают строку из стандартного потока и выводят в стандартный поток. Буква s в конце слов gets и puts является сокращением от слова string (строка).</p>
<p>В качестве параметров обе функции принимают указатель на массив символов (либо имя массива, либо указатель).</p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">gets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> помещает полученные с ввода символы в указанный в качестве аргумента массив. При этом символ перехода на новую строку, который завершает ее работу, игнорируется.<br />
Функция <span class="geshifilter"><code class="c geshifilter-c">puts<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выводит строку на экран и при этом сама добавляет символ перехода на новую строку. Простейший пример использования этих функций выглядит так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span>20<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
	gets<span style="color: #009900;">&#40;</span>str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>str<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Итак, если вы работаете со строками, а не другими типами данных, при этом нет необходимости выполнять их посимвольную обработку, то удобнее пользоваться функциями <span class="geshifilter"><code class="c geshifilter-c">puts<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">gets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. В таком случае даже не надо подключать заголовочный файл stdio.h.</p>
<h3>Массив символов и указатель на строку</h3>
<p>Как мы знаем, строка представляет собой массив символов, последний элемент которого является нулевым символом по таблице ASCII, обозначаемым '\0'. При работе со строками также как с численными массивами можно использовать указатели. Мы можем объявить в программе массив символов, записать туда строку, потом присвоить указателю адрес на первый или любой другой элемент этого массива и работать со строкой через указатель:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> name<span style="color: #009900;">&#91;</span>30<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>nP<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Введите имя и фамилию: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	gets<span style="color: #009900;">&#40;</span>name<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Имя: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>nP <span style="color: #339933;">=</span> name<span style="color: #339933;">;</span> <span style="color: #339933;">*</span>nP <span style="color: #339933;">!=</span> <span style="color: #ff0000;">' '</span><span style="color: #339933;">;</span> nP<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		putchar<span style="color: #009900;">&#40;</span><span style="color: #339933;">*</span>nP<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>Фамилия: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>nP<span style="color: #339933;">+</span>1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В заголовке цикла указателю сначала присваивается адрес первого элемента массива, его значение увеличивается до тех пор, пока не встретится пробел. В итоге указатель указывает на пробел и мы можем получить с его помощью вторую часть строки.</p>
<p>Иногда в программах можно видеть такое объявление и определение переменной-указателя:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strP <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Hello World!&quot;</span><span style="color: #339933;">;</span></code></span></p>
<p>Строку, которая была присвоена не массиву, а указателю, также можно получить, обратившись по указателю:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; &nbsp; &nbsp; &nbsp; puts<span style="color: #009900;">&#40;</span>strP<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p>Но давайте посмотрим, что же все-таки происходит, и чем такая строка, присвоенная указателю, отличается от строки, присвоенной массиву.</p>
<p>Когда в программе определяются данные и объявляются переменные, то под них отводится память. При этом данные, которые не были присвоены переменным, поменять в процессе выполнения программы уже нельзя. </p>
<p>Что происходит в примере? В программе вводится строковый объект, который по сути является строковой константой (литералом). Ссылка на первый элемент этой строки присваивается указателю. Мы можем менять значение указателя сколько угодно, переходить к любому из элементов константного массива символов или даже начать ссылаться на совершенно другую строку. Но вот поменять значение элементов строки не можем. Это можно доказать таким кодом:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strP<span style="color: #339933;">;</span>
	strP <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;This is a literal&quot;</span><span style="color: #339933;">;</span>  <span style="color: #666666; font-style: italic;">// работает, но строку нельзя изменить</span>
&nbsp;
	puts<span style="color: #009900;">&#40;</span>strP<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%c<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>strP<span style="color: #009900;">&#91;</span>3<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	strP<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">3</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'z'</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// не получится</span></pre></div></p>
<p>В последней строке кода возникнет ошибка, т.к. совершается попытка изменить строку-константу.<br />
Тем более нельзя делать так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strP<span style="color: #339933;">;</span>
	scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span>strP<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// ошибка сегментирования</span></pre></div></p>
<p>В данном случае память не была выделена под массив символов, который мы пытаемся считать функцией <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>; память была выделена только под указатель. Поэтому записать строку просто некуда. Другое дело, если память была выделена с помощью объявления массива, после чего указателю был присвоен адрес на этот массив:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span>12<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strP<span style="color: #339933;">;</span> 
	strP <span style="color: #339933;">=</span> str<span style="color: #339933;">;</span> 	
	gets<span style="color: #009900;">&#40;</span>strP<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// память резервируется под массив ранее</span>
	puts<span style="color: #009900;">&#40;</span>strP<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Поэтому если вам требуется в программе неизменяемый массив символов, то можете определить его через указатель.</p>
<h3>Передача строки в функцию</h3>
<p>Передача строки в функцию ничем не отличается от передачи туда массива чисел:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">void</span> change <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>s<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">;*</span>s <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span> s<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #009900;">&#40;</span><span style="color: #339933;">*</span>s<span style="color: #009900;">&#41;</span><span style="color: #339933;">++;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В этом примере функция <span class="geshifilter"><code class="c geshifilter-c">change<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> принимает в качестве параметра указатель на символ. В теле функции значение указателя инкрементируется, указывая на следующий символ массива. В теле цикла инкрементируется значение, которое находится по адресу, который содержит указатель.</p>
<p><span class="blue"><strong>Задание</strong><br />
Объявите в программе три массива символов. Данные для двух из них получите с помощью вызовов функции <span class="geshifilter"><code class="c geshifilter-c">gets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Третий массив должен содержать результат конкатенации (соединения) двух введенных строк. Напишите функцию, которая выполняет конкатенацию строк. </span></p>
<h3>Массив строк и массив указателей</h3>
<p>Рассмотрим более сложный пример. Допустим, у нас есть набор строк. Требуется выполнить  сортировку строк по возрастанию по признаку длины: сначала вывести самые короткие строки, затем более длинные.</p>
<p>Набор строк можно представить как двумерный массив, т.е. массив, состоящий из одномерных массивов, где каждый одномерный массив — это строка символов:<br />
<span class="geshifilter"><code class="c geshifilter-c">&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span><span style="color: #0000dd;">10</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #ff0000;">&quot;Hello&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;World&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;!!!&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;&amp;&amp;&amp;&quot;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span></code></span></p>
<p>Представьте себе, что значит выполнить сортировку строк. Это значит, надо поменять местами содержимое множества ячеек памяти. Это достаточно трудоемкая для компьютера работа, особенно если строк очень много. Однако можно поступить по-иному. Достаточно создать массив указателей, каждый элемент которого будет указывать на соответствующую ему строку первого массива. Далее выполнить сортировку указателей, что несомненно быстрее. Конечно, сам массив строк отсортирован не будет, однако благодаря указателям у нас будет хранится отсортированный "срез" массива:<br />
<img src="../../../img/c/sort_strings.png" width="657" height="583" alt="Сортировка массива строк с помощью указателей" /><br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;string.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 6</span>
&nbsp;
<span style="color: #993333;">void</span> sortlen<span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>s<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">char</span> strings<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>30<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strP<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		gets<span style="color: #009900;">&#40;</span>strings<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		strP<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>strings<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>0<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
	sortlen<span style="color: #009900;">&#40;</span>strP<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>strP<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> sortlen<span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">**</span>s<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">// **s == *s[] - как бы массив указателей</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> j<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>str<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>j<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> j <span style="color: #339933;">&lt;</span> N<span style="color: #339933;">-</span>i<span style="color: #339933;">-</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> j<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>strlen<span style="color: #009900;">&#40;</span>s<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> strlen<span style="color: #009900;">&#40;</span>s<span style="color: #009900;">&#91;</span>j<span style="color: #339933;">+</span>1<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
				str <span style="color: #339933;">=</span> s<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
				s<span style="color: #009900;">&#91;</span>j<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> s<span style="color: #009900;">&#91;</span>j<span style="color: #339933;">+</span>1<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
				s<span style="color: #009900;">&#91;</span>j<span style="color: #339933;">+</span>1<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> str<span style="color: #339933;">;</span>
			<span style="color: #009900;">&#125;</span>	
		<span style="color: #009900;">&#125;</span>			
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Примечания к программе:</p>
<ul>
<li>На самом деле параметром функции <span class="geshifilter"><code class="c geshifilter-c">sortlen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> является указатель на указатель. Хотя для понимания проще сказать, что параметром является массив указателей на символы. Мы передаем в функцию указатель на первый элемент массива <span class="monoi">strP</span>, который сам является указателем. Если бы в функции мы инкрементировали переменную <span class="monoi">s</span>, то переходили бы к следующему элементу-указателю массива <span class="monoi">strP</span>.</li>
<li>Сортировка выполняется методом пузырька: если длина строки, на которую ссылается следующий указатель массива strP, меньше длины строки под текущим указателем, то значения указателей меняются.</li>
<li>Выражение strP[i] = &amp;strings[i][0] означает, что элементу массива указателей присваивается ссылка на первый символ каждой строки.</li>
</ul>
<p><span class="blue"><strong>Задание</strong><br />
Напишите программу, которая сортирует строки по алфавиту. Для упрощения задачи пусть сортировка выполняется только по первым буквам строк (если первые буквы слов одинаковы, то вторые и последующие символы проверять не надо).</span></p>
  </div>
<div id="node-374" class="section-2">
  <h1 class="book-heading">Урок 14. Функции для обработки строк</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Особенности функций для работы со строками</h3>
<p>Языки программирования могут включать специальные функции для работы со строками, избавляя тем самым программиста от необходимости писать собственные функции обработки строк. Например, часто требуется определить длину строки, и поэтому в языках предусмотрена функция, измеряющая ее длину. </p>
<p>В языке программирования <span class="blue">C</span> функции для работы со строками объявляются в заголовочном файле string.h, который надо не забывать подключать к своему исходному коду. Существует около двадцати функций для работы со строками. Среди них есть те, которые осуществляют поиск символов в строке, функции сравнения, копирования строк, а также более специфические. Перечень и описание большинства существующих на данный момент в языке <span class="blue">C</span> функций можно найти в приложении книги Б. Кернигана, Д. Ритчи "Язык программирования <span class="blue">C</span>. Второе издание".</p>
<p>Все функции, объявленные в string.h, в процессе своей работы могут изменять или не изменять одну из переданных по указателю строк. Это зависит от назначения функции. Однако большинство из них что-то возвращают: либо указатель на символ, либо целое. При этом если функция меняет один из своих параметров и ради этого была вызвана, тогда то, что она возвращает, можно проигнорировать (т.е. ничему не присваивать в вызывающей функции).</p>
<p>Например, функция <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> имеет такое объявление: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strcpy <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span></code></span>. Она копирует строку, на которую указывает второй параметр, в строку, на которую указывает первый параметр. Таким образом первый параметр изменяется. Кроме того, функция возвращает указатель на первый символ строки:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> s1<span style="color: #009900;">&#91;</span>10<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> s2<span style="color: #009900;">&#91;</span>10<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>s3<span style="color: #339933;">;</span>
	s3 <span style="color: #339933;">=</span> s2<span style="color: #339933;">;</span>
&nbsp;
	gets<span style="color: #009900;">&#40;</span>s1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	s3 <span style="color: #339933;">=</span> strcpy<span style="color: #009900;">&#40;</span>s2<span style="color: #339933;">,</span>s1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>s2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>s3<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%p, %p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> s2<span style="color: #339933;">,</span> s3<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Здесь <span class="monoi">s2</span> и <span class="monoi">s3</span> указывают на один и тот же символ (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выводит одинаковые адреса). Однако то, что возвращает <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, нельзя присвоить массиву. Результат работы этой функции обычно ничему не присваивают; бывает достаточно того, что она просто изменяет одну из переданных по указателю строк.</p>
<p>Другое дело, такие функции как <span class="geshifilter"><code class="c geshifilter-c">strlen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которые не изменяют параметры, а вызываются ради результата. Функция <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> сравнивает две строки-аргумента по буквам (лексикографически) и возвращает 0, -1 или 1. Например, вызов <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;boy&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;body&quot;</span><span style="color: #009900;">&#41;</span></code></span> вернет 1, т.к. код буквы 'y' больше буквы 'd'. Вызов <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;body&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;boy&quot;</span><span style="color: #009900;">&#41;</span></code></span> вернет -1, т.к. первый аргумент лексикографически меньше второго.</p>
<h3>Функция strtok()</h3>
<p>С помощью функции <span class="geshifilter"><code class="c geshifilter-c">strtok<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> можно разбить строку на отдельные части (лексемы). Объявление этой функции выглядит так <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strtok <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span></code></span>. При первом вызове функции в качестве первого параметра указывается строка, которую требуется разбить. Вторым параметром указывается строка-разделитель. При последующих вызовах функции для этой же строки первым параметром должен быть NULL, т.к. функция уже "запомнила" с чем работает. Рассмотрим пример:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;one, two, three, four, five&quot;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>sp<span style="color: #339933;">;</span>
&nbsp;
	sp <span style="color: #339933;">=</span> strtok<span style="color: #009900;">&#40;</span>str<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;, &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>sp<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		puts<span style="color: #009900;">&#40;</span>sp<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		sp <span style="color: #339933;">=</span> strtok<span style="color: #009900;">&#40;</span>NULL<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;, &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В результате выполнения данного кода на экран в столбик выводятся слова:</p>
<pre>
one
two
three
four
five
</pre><p>
При первом вызове <span class="geshifilter"><code class="c geshifilter-c">strtok<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> в функцию передается указатель на первый символ массива и строка-разделитель. После этого вызова массив <span class="monoi">str</span> изменяется, в нем остается только слово "one", также функция возвращает указатель на это слово, который присваивается <span class="monoi">sp</span>. </p>
<p>Хотя мы потеряли остаток массива в вызывающей функции, однако внутри <span class="geshifilter"><code class="c geshifilter-c">strtok<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> сохраняется указатель на остаток массива. Когда передается NULL, функция "знает", что надо работать с этим "хвостом".</p>
<h3>Копирование частей строк</h3>
<p>Когда требуется просто соединить две строки, то проблема легко решается с помощью вызова функции <span class="geshifilter"><code class="c geshifilter-c">strcat<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которая к концу первого аргумента присоединяет второй. Похожая функция <span class="geshifilter"><code class="c geshifilter-c">strncat<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> присоединяет <span class="monoi">n</span> символов второй строки к первой. <span class="monoi">n</span> указывается в качестве третьего параметра.</p>
<p>Что если ситуация более сложная? Например, есть две непустые строки и надо соединить начало первой и конец второй. Сделать это можно с помощью функции <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, если передавать ссылки не на первые символы строк:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> s1<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">20</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Peter Smith&quot;</span><span style="color: #339933;">,</span> s2<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Julia Roberts&quot;</span><span style="color: #339933;">;</span>
	strcpy<span style="color: #009900;">&#40;</span>s1<span style="color: #339933;">+</span>5<span style="color: #339933;">,</span> s2<span style="color: #339933;">+</span>5<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>s1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В данном случае на экране будет выведено "Peter Roberts". Почему так произошло? В функцию <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> был передан указатель на шестой символ первой строки. Это привело к тому, что при копировании символы этой строки затираются только начиная с 6-го, т.к. <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> о предыдущих символах ничего не "знает". В качестве второго аргумента также передается только часть строки, которая и копируется в первую.</p>
<p>Как вставить одну строку в середину другой? Можно решить эту задачу, используя третью "буферную" строку, куда можно сначала скопировать первую строку, потом вторую, затерев конец первой, потом присоединить конец первой. Но можно поступить и так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> s1<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">20</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;one three&quot;</span><span style="color: #339933;">,</span> s2<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">20</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;two&quot;</span><span style="color: #339933;">;</span>
	strcpy<span style="color: #009900;">&#40;</span>s2<span style="color: #339933;">+</span>3<span style="color: #339933;">,</span> s1<span style="color: #339933;">+</span>3<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	strcpy<span style="color: #009900;">&#40;</span>s1<span style="color: #339933;">+</span>4<span style="color: #339933;">,</span> s2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>s1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Здесь сначала во вторую строку копируется конец первой, получается "two three". Затем в первую строку, минуя ее начало, копируется вторая.</p>
<h3>Описание некоторых функций для работы со строками</h3>
<p><span class="blue"><strong>Задание</strong><br />
Ниже представлены описания некоторых функций, выполняющих операции над строками. Придумайте и напишите маленькие программы, иллюстрирующие работу этих функций.</span></p>
<ul>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strchr <span style="color: #009900;">&#40;</span><span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">int</span> c<span style="color: #009900;">&#41;</span></code></span>. Возвращает указатель на первое вхождение символа <span class="monoi">с</span> в строку. Возвращает NULL, если такого символа в строке нет.</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strstr <span style="color: #009900;">&#40;</span><span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>s2<span style="color: #339933;">,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>s1<span style="color: #009900;">&#41;</span></code></span>. Возвращает указатель на первое вхождение строки <span class="monoi">s1</span> в строку <span class="monoi">s2</span>. Если совпадений нет, возвращает NULL.</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strncpy <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> size_t n<span style="color: #009900;">&#41;</span></code></span>. Копирует <span class="monoi">n</span> символов второй строки в первую.</li>
<li><span class="geshifilter"><code class="c geshifilter-c">size_t strspn <span style="color: #009900;">&#40;</span><span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span></code></span>. Возвращает длину начала первой строки, в которую входят символы, из которых состоит вторая строка.</li>
</ul>
  </div>
<div id="node-375" class="section-2">
  <h1 class="book-heading">Урок 15. Структурный тип данных</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Объявление и определение структур</h3>
<p>Примером структуры может послужить любой объект, для которого описывается ряд его характеристик, имеющих значение в данной программе. Например, для книг это может быть название, автор, количество страниц; для окружности — координаты центра, диаметр, цвет. На языке программирования <span class="blue">C</span> объявление вышеупомянутых структурных типов данных может выглядеть так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">struct</span> book <span style="color: #009900;">&#123;</span>
    <span style="color: #993333;">char</span> title<span style="color: #009900;">&#91;</span>50<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    <span style="color: #993333;">char</span> author<span style="color: #009900;">&#91;</span>30<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
    <span style="color: #993333;">int</span> pages<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">struct</span> circle <span style="color: #009900;">&#123;</span>
    <span style="color: #993333;">int</span> x<span style="color: #339933;">,</span> y<span style="color: #339933;">;</span>
    <span style="color: #993333;">float</span> dia<span style="color: #339933;">;</span>
    <span style="color: #993333;">char</span> color<span style="color: #009900;">&#91;</span>10<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В данном случае мы как бы создаем новый тип данных, но еще не объявляем переменных этих типов. Обратите внимание на точку с запятой в конце объявлений.</p>
<p>Чаще переменные структур объявляются так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">struct</span> circle a<span style="color: #339933;">,</span> b<span style="color: #339933;">,</span> c<span style="color: #339933;">;</span>
<span style="color: #993333;">struct</span> book mybook<span style="color: #339933;">;</span></pre></div></p>
<p>Здесь объявляются три структуры типа <span class="monoi">circle</span> и одна структура типа <span class="monoi">book</span>. Можно объявлять типы структур и их переменные по-иному, но мы для избежания путаницы рассматривать другие способы не будем. </p>
<p>Каждая переменная типа <span class="monoi">circle</span> содержит четыре элемента (или поля) — <span class="monoi">x, y, dia, color</span>. Можно сказать, что они представляют собой вложенные переменные. Причем эти переменные разных типов. Таким образом переменная-структура позволяет объединить под одним именем ряд разнородных данных. Обычно это нужно для удобства обработки данных. Если нельзя было бы создавать структуры, то пришлось бы создавать множество независимых переменных или ряд массивов, явной взаимосвязи между которыми не было бы. Структуру же позволяют объединять взаимосвязанные данные. Это конечно еще не объектно-ориентированное программирование, но уже взгляд в его сторону.</p>
<p>Объявив переменную структурного типа, мы можем получить доступ к каждому ее элементу для присваивания, изменения или получения значения:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	a.<span style="color: #202020;">x</span> <span style="color: #339933;">=</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">;</span> a.<span style="color: #202020;">dia</span> <span style="color: #339933;">=</span> <span style="color:#800080;">2.35</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%.2f &quot;</span><span style="color: #339933;">,</span> a.<span style="color: #202020;">dia</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Значение элементов структуры можно сразу определять при объявлении переменной, что похоже на инициализацию массивов:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">struct</span> book lang_c <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #ff0000;">&quot;Language C&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;Ritchi&quot;</span><span style="color: #339933;">,</span> 99<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Значение переменной-структуры можно присвоить переменной того же типа:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">struct</span> book <span style="color: #009900;">&#123;</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>title<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>author<span style="color: #339933;">;</span> <span style="color: #993333;">int</span> pages<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> book old<span style="color: #339933;">,</span> new<span style="color: #339933;">;</span>
	old.<span style="color: #202020;">title</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;GNU/Linux&quot;</span><span style="color: #339933;">;</span> old.<span style="color: #202020;">author</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;people&quot;</span><span style="color: #339933;">;</span> old.<span style="color: #202020;">pages</span> <span style="color: #339933;">=</span> <span style="color: #0000dd;">20213</span><span style="color: #339933;">;</span>
	new <span style="color: #339933;">=</span> old<span style="color: #339933;">;</span>
	new.<span style="color: #202020;">pages</span> <span style="color: #339933;">+=</span> <span style="color: #0000dd;">2000</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d, %d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> old.<span style="color: #202020;">pages</span><span style="color: #339933;">,</span> new.<span style="color: #202020;">pages</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В четвертой строке кода данные переменной <span class="monoi">old</span> присваиваются <span class="monoi">new</span>. В итоге вторая структура содержит копию данных первой. То, что можно выполнять присваивание по отдельным полям должно быть понятно.</p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте и опишите структуру. Объявите переменные этого типа. Присвойте им значения и выведите на экран.</span></p>
<h3>Структуры и функции</h3>
<p>Структуры-переменные можно передавать в функции в качестве параметров и возвращать их оттуда. Структуры передаются по значению, как обычные переменные, а не по ссылке, как массивы.<br />
Рассмотрим программу, в которой одна функция возвращает структуру, а другая — принимает ее в качестве параметра:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;math.h&gt;</span>
&nbsp;
<span style="color: #993333;">struct</span> circle <span style="color: #009900;">&#123;</span> <span style="color: #993333;">int</span> x<span style="color: #339933;">,</span> y<span style="color: #339933;">;</span> <span style="color: #993333;">float</span> dia<span style="color: #339933;">;</span> <span style="color: #993333;">char</span> color<span style="color: #009900;">&#91;</span>10<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">struct</span> circle new_circle<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> cross <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> circle<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">struct</span> circle a<span style="color: #339933;">;</span>
&nbsp;
	a <span style="color: #339933;">=</span> new_circle<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	cross<span style="color: #009900;">&#40;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>	
&nbsp;
<span style="color: #993333;">struct</span> circle new_circle<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">struct</span> circle new<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Координаты: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d%d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>new.<span style="color: #202020;">x</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>new.<span style="color: #202020;">y</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Диаметр: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%f&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>new.<span style="color: #202020;">dia</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Цвет: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span> new.<span style="color: #202020;">color</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span><span style="color: #666666; font-style: italic;">//gets(new.color);</span>
&nbsp;
	<span style="color: #b1b100;">return</span> new<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> cross <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> circle c<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">double</span> hyp<span style="color: #339933;">;</span>
&nbsp;
	hyp <span style="color: #339933;">=</span> sqrt<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span><span style="color: #993333;">double</span><span style="color: #009900;">&#41;</span> c.<span style="color: #202020;">x</span> <span style="color: #339933;">*</span> c.<span style="color: #202020;">x</span> <span style="color: #339933;">+</span> <span style="color: #009900;">&#40;</span><span style="color: #993333;">double</span><span style="color: #009900;">&#41;</span> c.<span style="color: #202020;">y</span> <span style="color: #339933;">*</span> c.<span style="color: #202020;">y</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Расстояние от центра круга до начала координат: %.2lf<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> hyp<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>hyp <span style="color: #339933;">&lt;=</span> c.<span style="color: #202020;">dia</span> <span style="color: #339933;">/</span> <span style="color: #0000dd;">2</span><span style="color: #009900;">&#41;</span> puts<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Круг пересекает начало координат&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">else</span> puts<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Круг не содержит точки начала коорднат&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Примечание. При компиляции программы в GNU/Linux команда выглядит так: <span class="geshifilter"><code class="c geshifilter-c">gcc program.<span style="color: #202020;">c</span> <span style="color: #339933;">-</span>lm</code></span>. Это связано с использованием библиотеки с математическими функциями.</p>
<ul>
<li>Объявляется структура <span class="monoi">circle</span> как глобальный тип данных. Таким образом любая, а не только <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, функция может создавать переменные этого типа. </li>
<li>Функция <span class="geshifilter"><code class="c geshifilter-c">new_circle<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращает структуру, а функция <span class="geshifilter"><code class="c geshifilter-c">cross<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> принимает структуру по значению. Следует отметить, что можно создавать функции, которые как принимают (возможно, несколько структур) так и возвращают структуру.</li>
<li>В функции <span class="geshifilter"><code class="c geshifilter-c">new_circle<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> создается переменная new типа <span class="monoi">struct circle</span>, поля которой заполняются пользователем. Функция возвращает значение переменной <span class="monoi">new</span> в функцию <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, где это значение присваивается переменной <span class="monoi">a</span>, которая также принадлежит типу <span class="monoi">sctruct circle</span>.</li>
<li>Функция <span class="geshifilter"><code class="c geshifilter-c">cross<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> определяет, пересекает ли круг начало координат. В ее теле вычисляется расстояние от центра круга до начала координат. Это расстояние является гипотенузой прямоугольного треугольника, длина катетов которого равна значениям <span class="monoi">x</span> и <span class="monoi">у</span>. Далее, если гипотенуза  меньше радиуса, то круг пересекает начало координат, т.е. точку (0, 0).</li>
<li>В функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> при вызове <span class="geshifilter"><code class="c geshifilter-c">cross<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> данные, содержащиеся в переменной <span class="monoi">a</span>, копируются и присваиваются переменной <span class="monoi">c</span>.</li>
</ul>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте и напишите свою программу, в которой была бы как минимум еще одна функция помимо <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, манипулирующая структурой.</span></p>
<h3>Указатели и структуры</h3>
<p>В отличие от массивов, структуры передаются в функции по значению. Это не всегда рационально, т.к. структуры могут быть достаточно большого размера, и копирование таких участков памяти может замедлять работу программы. Поэтому часто структуры в функцию передают по ссылке, при этом можно использовать как указатель, так и операцию получения адреса.<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">struct</span> book new<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// переменная-структура</span>
	<span style="color: #993333;">struct</span> book <span style="color: #339933;">*</span>pnew<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// указатель на структуру</span>
	reader<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span>new<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// передаем адрес</span>
	pnew <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>new<span style="color: #339933;">;</span>
	reader<span style="color: #009900;">&#40;</span>pnew<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// передаем указатель</span></pre></div></p>
<p>Тогда функция <span class="geshifilter"><code class="c geshifilter-c">reader<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> должна иметь примерно такое объявление:<br />
<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">void</span> reader <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> book <span style="color: #339933;">*</span>pb<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> </code></span></p>
<p>Возникает вопрос, как при использовании указателей обращаться к элементам структур? Во первых надо получить саму структуру, т.е. если <span class="monoi">pnew</span> указатель, то сама структура будет <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span>pnew</code></span>. Далее можно уже обращаться к полям через точку: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">*</span>pnew.<span style="color: #202020;">title</span></code></span>. Однако это выражение не верно, т.к. приоритет операции "точка" (обращение к полю) выше операции "звездочка" (получить значение по адресу). Таким образом приведенная запись сначала пытается получить значение поля <span class="monoi">title</span> у указателя <span class="monoi">pnew</span>, но у <span class="monoi">pnew</span> нет такого поля. Проблема решается с помощью скобок, которые изменяют порядок выполнения операций: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span><span style="color: #339933;">*</span>pnew<span style="color: #009900;">&#41;</span>.<span style="color: #202020;">title</span></code></span>. В таком случае сначала извлекается значение по адресу <span class="monoi">pnew</span>, это значение является структурой. Затем происходит обращение к полю структуры.</p>
<p>В языке программирования <span class="blue">C</span> записи типа <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span><span style="color: #339933;">*</span>pnew<span style="color: #009900;">&#41;</span>.<span style="color: #202020;">title</span></code></span> часто заменяют на такие: <span class="geshifilter"><code class="c geshifilter-c">pnew<span style="color: #339933;">-&gt;</span>title</code></span>, что позволяет синтаксис языка. Когда в программе вы видите стрелку (тире и скобка) всегда помните, то, что написано до стрелки, — это указатель на структуру, а не переменная-структура.</p>
<p>Пример кода с использованием указателей:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #993333;">struct</span> circle <span style="color: #009900;">&#123;</span> <span style="color: #993333;">int</span> x<span style="color: #339933;">,</span> y<span style="color: #339933;">;</span> <span style="color: #993333;">float</span> dia<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> inversion <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> circle <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>	
	<span style="color: #993333;">struct</span> circle cir<span style="color: #339933;">,</span> <span style="color: #339933;">*</span>pc <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>cir<span style="color: #339933;">;</span>
&nbsp;
	pc<span style="color: #339933;">-&gt;</span>x <span style="color: #339933;">=</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">;</span> pc<span style="color: #339933;">-&gt;</span>y <span style="color: #339933;">=</span> <span style="color: #0000dd;">7</span><span style="color: #339933;">;</span> pc<span style="color: #339933;">-&gt;</span>dia <span style="color: #339933;">=</span> <span style="color: #0000dd;">6</span><span style="color: #339933;">;</span> 
	inversion<span style="color: #009900;">&#40;</span>pc<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;x = %d, y = %d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> cir.<span style="color: #202020;">x</span><span style="color: #339933;">,</span> cir.<span style="color: #202020;">y</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>	
&nbsp;
<span style="color: #993333;">void</span> inversion<span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> circle <span style="color: #339933;">*</span>p<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	p<span style="color: #339933;">-&gt;</span>x <span style="color: #339933;">=</span> <span style="color: #339933;">-</span>p<span style="color: #339933;">-&gt;</span>x<span style="color: #339933;">;</span>
	p<span style="color: #339933;">-&gt;</span>y <span style="color: #339933;">=</span> <span style="color: #339933;">-</span>p<span style="color: #339933;">-&gt;</span>y<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте свою программу, в которой бы использовались указатели на структуры.</span></p>
<h3>Массивы структур</h3>
<p>Обычно создание в программе одной переменной структурного типа не имеет особого смысла. Чаще структурами пользуются, когда необходимо описать множество похожих объектов, имеющих разные значения признаков. Значения каждого объекта следует объединить вместе (в структуру) и тем самым отделить от значений других объектов. Например, описание ряда книг или множества людей. Таким образом мы можем организовать массив, где каждый элемент представляет собой отдельную структуру, а все элементы принадлежат одному и тому же структурному типу.</p>
<p>Напишем программу для учета персональных компьютеров в организации. Каждая структура будет описывать определенные модели и содержать поле, в котором будет указано количество таких объектов. Поэтому при объявлении структурного типа данных следует описать такие поля как тип компьютера, модель процессора, количество. </p>
<p>Программа будет предоставлять возможность получать информацию о всех моделях и изменять количество компьютеров указанной пользователем модели. В программе будут определены две функции (помимо <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>): для вывода всей информации и для изменения количества компьютеров.<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 5</span>
&nbsp;
<span style="color: #993333;">struct</span> computer <span style="color: #009900;">&#123;</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>type<span style="color: #339933;">;</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>proc<span style="color: #339933;">;</span> <span style="color: #993333;">int</span> qty<span style="color: #339933;">;</span> <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> viewer <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> computer <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> changer <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> computer <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">struct</span> computer comps<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #ff0000;">&quot;Desktop&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;earlier then P4&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">,</span> 
	<span style="color: #ff0000;">&quot;Desktop&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;P4&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">30</span> <span style="color: #339933;">,</span>
	<span style="color: #ff0000;">&quot;Desktop&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;Core&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">20</span> <span style="color: #339933;">,</span>
	<span style="color: #ff0000;">&quot;Desktop&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;AMD&quot;</span><span style="color: #339933;">,</span> <span style="color: #0000dd;">2</span> <span style="color: #339933;">,</span>
	<span style="color: #ff0000;">&quot;Notebook&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;Core&quot;</span><span style="color: #339933;">,</span> 1 <span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
	viewer<span style="color: #009900;">&#40;</span>comps<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	changer<span style="color: #009900;">&#40;</span>comps<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	viewer<span style="color: #009900;">&#40;</span>comps<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> viewer <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> computer <span style="color: #339933;">*</span>comp<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> N<span style="color: #339933;">;</span> i<span style="color: #339933;">++,</span> comp<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%2d) %-8s - %-15s: %3d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> i<span style="color: #339933;">+</span>1<span style="color: #339933;">,</span> comp<span style="color: #339933;">-&gt;</span>type<span style="color: #339933;">,</span> comp<span style="color: #339933;">-&gt;</span>proc<span style="color: #339933;">,</span> comp<span style="color: #339933;">-&gt;</span>qty<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> changer <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> computer <span style="color: #339933;">*</span>comp<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> differ<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Введите номер модели: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> i<span style="color: #339933;">--;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;На сколько уменьшить или увеличить: &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>differ<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#40;</span>comp<span style="color: #339933;">+</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span>qty <span style="color: #339933;">+=</span> differ<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<ul>
<li>Массив структур инициализируется при его объявлении.</li>
<li>Функции <span class="geshifilter"><code class="c geshifilter-c">viewer<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">changer<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> принимают указатели на структуру <span class="monoi">computer</span>. </li>
<li>В теле <span class="geshifilter"><code class="c geshifilter-c">viewer<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> указатель инкрементируется в заголовке цикла; таким образом указывая на следующий элемент массива, т.е. на следующую структуру.</li>
<li>В выражении <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span>comp<span style="color: #339933;">+</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">-&gt;</span>qty</code></span> скобки необходимы, т.к оператор -> имеет более высокий приоритет. Скобки позволяют сначала получить указатель на i-ый элемент массива, а потом обратиться к его полю.</li>
<li>Декрементирование <span class="monoi">i</span> в функции <span class="geshifilter"><code class="c geshifilter-c">changer<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> связано с тем, что индексация начинается с нуля, а номера элементов массива, которые пользователь видит на экране, с единицы.</li>
<li>Для того, чтобы уменьшить количество компьютеров, при запросе надо ввести отрицательное число.</li>
</ul>
<p>Пример результата работы программы:<br />
<img src="../../../img/c/array_of_struct.png" width="308" height="221" alt="Массив структур" /></p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте свою программу, в которой бы использовался массив структур, или перепишите приведенную выше программу и дополните ее функцией, которая позволяет добавлять в массив новый элемент-структуру.</span></p>
  </div>
<div id="node-376" class="section-2">
  <h1 class="book-heading">Урок 16. Организация динамических структур данных</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Структуры одного типа можно объединять не только в массивы. Их можно связывать между собой, создавая так называемые динамические структуры данных. Связь между отдельными структурами может быть организована по-разному, и именно поэтому среди динамических данных выделяют списки, стеки, очереди, деревья, графы и др. Мы не будем рассматривать каждый тип. Цель этого урока — понять, что такое динамические данные, и как они создаются на языке программирования <span class="blue">C</span>.</p>
<p>Для динамических данных память выделяется и освобождается в процессе выполнения программы, а не в момент ее запуска. Так, например, если в программе объявлен массив из 100 элементов, то при запуске программы резервируется память для всех ста элементов, даже если в процессе работы программы всего будут использованы первые 10 элементов массива. С другой стороны, при использовании в программе динамических типов память под них заранее не выделяется. Лишь когда поступают новые данные, вызывается специальная функция, которая выделяет память, куда эти данные записываются.</p>
<p>Тут появляется проблема. Для динамических типов данных не объявляются переменные, иначе память бы выделялась под переменные. Как тогда обращаться к данным, записанным неизвестно где в памяти? Можно ввести переменные-указатели и при выделении памяти записывать адрес этой памяти в указатели. Но мы же не знаем, сколько памяти потребуется в процессе выполнения. Сколько вводить указателей? </p>
<p>Проблема решается путем использования структур. Допустим, мы пишем программу, позволяющую вводить данные на сотрудников организации. Количество сотрудников неизвестно. Можно было бы создать массив записей с запасом. Однако, если данных о каждом сотруднике много, то каждая запись занимает много памяти; получается, что мы будем расходовать много памяти в пустую, если сотрудников мало. </p>
<p>Идея заключается примерно в следующем:</p>
<ol>
<li>В программе определяем структурный тип данных с "кое-какой изюминкой" и создаем переменную указатель на него. В итоге при запуске программы память выделяется только под указатель. </li>
<li>В процессе выполнения программы, в случае возникновения необходимости в создании структуры, с помощью специальной функции выделяем память под хранение данных (полей структуры).</li>
<li>Присваиваем указателю адрес, по которому расположена только что созданная структура.</li>
<li>Когда поступает команда на создание следующей структуры, снова с помощью функции выделяется память, а указателю присваивается адрес этой новой структуры.</li>
<li>"Изюминка" определенного ранее структурного типа данных заключается в том, что одним из его полей является указатель на структуру этого же типа. </li>
<li>В это поле-указатель записывается адрес на структуру, которая была создана перед данной структурой. </li>
</ol>
<p>Таким образом получается цепочка взаимосвязанных структур. Самая первая созданная структура не имеет ссылки на другую структуру. Ее поле-указатель имеет значение NULL. Вторая созданная структура ссылается на первую, третья на вторую и т.д. Адрес последней созданной структуры хранится в переменной-указателе, которая была объявлена в программе программистом.</p>
<p>Чтобы извлечь данные из такого агломерата данных, надо пройтись по ссылкам начиная с переменной-указателя. Т.е. первой мы извлечем последнюю записанную структуру. Потом предпоследнюю и постепенно будем двигаться к структуре, которая была создана первой во времени. Такой динамический тип данных называется стеком. Объекты извлекаются из стека таким образом, что первым выбирается тот, который был помещен последним.<br />
<img src="../../../img/c/stack3.png" width="654" height="68" alt="Стек - динамический тип данных" /><br />
Стек — это не единственный способ организации динамических данных, но наиболее простой.<br />
Если динамические данные больше не нужны, следует не забыть освободить память.</p>
<p>В языке программирования <span class="blue">C</span> выделение памяти в процессе выполнения программы можно организовать с помощью функций <span class="geshifilter"><code class="c geshifilter-c">malloc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">calloc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, освобождение памяти с помощью <span class="geshifilter"><code class="c geshifilter-c">free<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Объявление этих функций находится в заголовочных файлах stdlib.h и malloc.h. К исходному коду можно подключить любой из них.</p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">malloc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> принимает в качестве параметра число, обозначающее объем памяти, который требуется выделить. Если свободная память есть, и <span class="geshifilter"><code class="c geshifilter-c">malloc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> удается ее "захватить", то функция возвращает указатель на нее. Этот указатель не имеет типа, поэтому программист самостоятельно должен привести его к требуемому в программе типу данных. </p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">free<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> принимает указатель, и освобождает память по адресу, который он содержит.<br />
Рассмотрим программу:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;stdlib.h&gt;</span>
&nbsp;
<span style="color: #993333;">struct</span> stack <span style="color: #009900;">&#123;</span>
       <span style="color: #993333;">int</span> data<span style="color: #339933;">;</span>
       <span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span>next<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
&nbsp;
<span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span>create<span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> stack <span style="color: #339933;">*,</span> <span style="color: #993333;">int</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// присоединение элемента к голове, возврат адреса головы</span>
<span style="color: #993333;">void</span> list<span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// просмотр стека</span>
&nbsp;
main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
       <span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> n<span style="color: #339933;">;</span>
       <span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span>head<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// адрес, указывающий на голову стека</span>
       head <span style="color: #339933;">=</span> NULL<span style="color: #339933;">;</span>
&nbsp;
       scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>n<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
       <span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;=</span> n<span style="color: #339933;">;</span> i<span style="color: #339933;">+=</span>5<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
           head <span style="color: #339933;">=</span> create<span style="color: #009900;">&#40;</span>head<span style="color: #339933;">,</span>i<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
           <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&lt;--&quot;</span><span style="color: #339933;">,</span> head<span style="color: #339933;">-&gt;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
       <span style="color: #009900;">&#125;</span>
       <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
       list<span style="color: #009900;">&#40;</span>head<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
       free<span style="color: #009900;">&#40;</span>head<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span>create<span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span>head<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> x<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
       <span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span>element<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// указатель на новую структуру</span>
       element <span style="color: #339933;">=</span> <span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span>malloc<span style="color: #009900;">&#40;</span><span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> stack<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// выделяем память</span>
       element<span style="color: #339933;">-&gt;</span>next <span style="color: #339933;">=</span> head<span style="color: #339933;">;</span>
       element<span style="color: #339933;">-&gt;</span>data <span style="color: #339933;">=</span> x<span style="color: #339933;">;</span>
       <span style="color: #b1b100;">return</span> element<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> list<span style="color: #009900;">&#40;</span><span style="color: #993333;">struct</span> stack <span style="color: #339933;">*</span>p<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
     <span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>p <span style="color: #339933;">!=</span> NULL<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> <span style="color: #666666; font-style: italic;">// пока не конец стека    </span>
           <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d--&gt;&quot;</span><span style="color: #339933;">,</span> p<span style="color: #339933;">-&gt;</span>data<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
           p <span style="color: #339933;">=</span> p<span style="color: #339933;">-&gt;</span>next<span style="color: #339933;">;</span> <span style="color: #666666; font-style: italic;">// продвижение по списку</span>
     <span style="color: #009900;">&#125;</span>
     <span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В процессе выполнения эта программа запрашивает целое число и сначала выводит числа от 0 до указанного числа, а затем выводит их же в обратном порядке — от указанного число до нуля:</p>
<pre>
60
0&lt;--5&lt;--10&lt;--15&lt;--20&lt;--25&lt;--30&lt;--35&lt;--40&lt;--45&lt;--50&lt;--55&lt;--60&lt;--
60-->55-->50-->45-->40-->35-->30-->25-->20-->15-->10-->5-->0-->
</pre><p>
Осталось выяснить почему она так делает.</p>
<ol>
<li>В программе определяется тип данных <span class="monoi">struct stack</span>, одним из полей которого является указатель на структуру типа <span class="monoi">struct stack</span>.</li>
<li>В функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> создается указатель (<span class="monoi">head</span>) на <span class="monoi">struct stack</span>, которому сначала присваивается NULL, т.к. он никуда не указывает. </li>
<li>В цикле определенное количество раз вызывается функция <span class="geshifilter"><code class="c geshifilter-c">create<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которой передается текущее значение указателя (адрес) и какое-то число.</li>
<li>В теле <span class="geshifilter"><code class="c geshifilter-c">create<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> создается новый указатель (<span class="monoi">element</span>) типа <span class="monoi">struct stack</span>.</li>
<li>С помощью функции <span class="geshifilter"><code class="c geshifilter-c">malloc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выделяется память, необходимая под одну структуру. Объем этой памяти вычисляется с помощью функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Возвращаемый <span class="geshifilter"><code class="c geshifilter-c">malloc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> указатель приводится к типу <span class="monoi">struct stack</span>.</li>
<li>Адрес выделенной памяти под новую структуру присваивается переменной-указателю <span class="monoi">element</span>.</li>
<li>В поле <span class="monoi">next</span> новой структуры записывается адрес, который содержится в аргументе, переданном в функцию. При первом вызове <span class="geshifilter"><code class="c geshifilter-c">create<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> там содержится NULL. При последующих вызовах адрес памяти созданной в предыдущем вызове функции структуры. Таким образом в поле <span class="monoi">next</span> структуры, доступной по указателю <span class="monoi">element</span>, сохраняется адрес, содержащийся в <span class="monoi">head</span>. Следовательно <span class="monoi">head</span> в дальнейшем можно изменить, не потеряв связь с предыдущими данными.</li>
<li>В поле <span class="monoi">data</span> записывается число (какие-то существенные для нас данные).</li>
<li>Из функции <span class="geshifilter"><code class="c geshifilter-c">create<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращается указатель на только что выделенную память с новой структурой, в которой сохранен адрес на предыдущую структуру. Этот указатель присваивается <span class="monoi">head</span>. В результате <span class="monoi">head</span> постоянно указывает на последнюю созданную структуру.</li>
<li>На экран с помощью <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выводится значение поля <span class="monoi">data</span> структуры, на которую указывает в данный момент <span class="monoi">head</span>. </li>
<li>Функция <span class="geshifilter"><code class="c geshifilter-c">list<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> позволяется просмотреть стек, получив указатель на его последний (по времени создания) элемент. При вызове значение <span class="monoi">head</span> присваивается переменной <span class="monoi">p</span>. Обратите внимание, изменение <span class="monoi">p</span> в теле <span class="geshifilter"><code class="c geshifilter-c">list<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> не повлияет на значение <span class="monoi">head</span> в теле <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Переменная <span class="monoi">p</span> получает копию адреса и далее изменяет лишь свое значение. </li>
<li>В выражении <span class="geshifilter"><code class="c geshifilter-c">p <span style="color: #339933;">=</span> p<span style="color: #339933;">-&gt;</span>next</code></span> сначала изымается значение из поля <span class="monoi">next</span> структуры, на которую указывает <span class="monoi">p</span>. Там содержится адрес на предыдущую структуру, и этот адрес присваивается <span class="monoi">p</span>. Таким образом <span class="monoi">p</span> как бы перемещается по стеку, начиная с последней вошедшей в него структуры и заканчивая на той, которая была создана первой. Поле <span class="monoi">next</span> первой структуры содержит NULL, который служит условием выхода из цикла.</li>
<li>В конце с помощью функции <span class="geshifilter"><code class="c geshifilter-c">free<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> освобождает память по адресу, на который указывает <span class="monoi">head</span>. (Освобождается ли при этом вся выделенная память или только та, что была отведена на последнюю структуру?)</li>
</ol>
<p>Преимущество этой программы в том, что память выделяется только под то количество структур, которое необходимо. Количество структур определяется в процессе выполнения программы. Однако приходится тратить память на указатели. Если структура содержит лишь одно значащее поле, как в примере выше, то такие затраты могут быть неоправданны. Проще было бы объявить массив с запасом. Но если структура сложная, содержит много полей, то организация динамических типов данных приносит существенный плюс.</p>
<p><span class="blue"><strong>Задание</strong></span></p>
<ol>
<li><span class="blue">Напишите программу, аналогичную приведенной в уроке. При этом структурный тип данных должен быть более сложным и содержать как минимум три значащих поля (например, данные о сотрудниках: ФИ, сфера деятельности, стаж). Поля должны заполняться пользователем.</span> </li>
<li><span class="blue">Напишите к вашей программе функцию, которая выводит значения полей указанной пользователем структуры. Например, пользователь пишет ФИ и получает остальные сведения о человеке.</span></li>
<li><span class="blue">Напишите еще одну функцию, которая позволяет удалять последнюю записанную структуру.</span></li>
<li><span class="blue">Подумайте над алгоритмом удаления структуры из любого места стека. Попробуйте его реализовать.</span></li>
</ol>
  </div>
<div id="node-377" class="section-2">
  <h1 class="book-heading">Урок 17. Ввод данных из файла и вывод в файл</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Открытие и закрытие файлов</h3>
<p>До этого при вводе-выводе данных мы работали со стандартными потоками — клавиатурой и монитором. Теперь рассмотрим, как в языке <span class="blue">C</span> реализовано получение данных из файлов и запись их туда. Перед тем как выполнять эти операции, надо открыть файл и получить доступ к нему.</p>
<p>В языке программирования <span class="blue">C</span> указатель на файл имеет тип FILE и его объявление выглядит так:<br />
<span class="geshifilter"><code class="c geshifilter-c">FILE <span style="color: #339933;">*</span>myfile<span style="color: #339933;">;</span></code></span></p>
<p>С другой стороны, функция <span class="geshifilter"><code class="c geshifilter-c">fopen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> открывает файл по указанному в качестве первого аргумента адресу в режиме чтения ("r"), записи ("w") или добавления ("a") и возвращает в программу указатель на него. Поэтому процесс открытия файла и подключения его к программе выглядит примерно так:<br />
<span class="geshifilter"><code class="c geshifilter-c">myfile <span style="color: #339933;">=</span> fopen <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;hello.txt&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;r&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p>При чтении или записи данных в файл обращение к нему осуществляется посредством файлового указателя (в данном случае, <span class="monoi">myfile</span>).</p>
<p>Если в силу тех или иных причин (нет файла по указанному адресу, запрещен доступ к нему) функция <span class="geshifilter"><code class="c geshifilter-c">fopen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> не может открыть файл, то она возвращает NULL. В реальных программах почти всегда обрабатывают ошибку открытия файла в ветке <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>, мы же далее опустим это.</p>
<p>Объявление функции <span class="geshifilter"><code class="c geshifilter-c">fopen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> содержится в заголовочном файле stdio.h, поэтому требуется его подключение. Также в stdio.h объявлен тип-структура FILE.</p>
<p>После того, как работа с файлом закончена, принято его закрывать, чтобы освободить буфер от данных и по другим причинам. Это особенно важно, если после работы с файлом программа продолжает выполняться. Разрыв связи между внешним файлом и указателем на него из программы выполняется с помощью функции <span class="geshifilter"><code class="c geshifilter-c">fclose<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. В качестве параметра ей передается указатель на файл:<br />
<span class="geshifilter"><code class="c geshifilter-c">fclose<span style="color: #009900;">&#40;</span>myfile<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p>В программе может быть открыт не один файл. В таком случае каждый файл должен быть связан со своим файловым указателем. Однако если программа сначала работает с одним файлом, потом закрывает его, то указатель можно использовать для открытия второго файла.</p>
<h3>Чтение из текстового файла и запись в него</h3>
<h4>fscanf()</h4>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">fscanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> аналогична по смыслу функции <span class="geshifilter"><code class="c geshifilter-c">scanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, но в отличии от нее осуществляет форматированный ввод из файла, а не стандартного потока ввода. Функция <span class="geshifilter"><code class="c geshifilter-c">fscanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> принимает параметры: файловый указатель, строку формата, адреса областей памяти для записи данных:<br />
<span class="geshifilter"><code class="c geshifilter-c">fscanf <span style="color: #009900;">&#40;</span>myfile<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;%s%d&quot;</span><span style="color: #339933;">,</span> str<span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></code></span></p>
<p>Возвращает количество удачно считанных данных или EOF. Пробелы, символы перехода на новую строку учитываются как разделители данных.</p>
<p>Допустим, у нас есть файл содержащий такое описание объектов:</p>
<pre>
apples 10 23.4 
bananas 5 25.0 
bread 1 10.3
</pre><p>
Тогда, чтобы считать эти данные, мы можем написать такую программу:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
	FILE <span style="color: #339933;">*</span>file<span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> food <span style="color: #009900;">&#123;</span>
		<span style="color: #993333;">char</span> name<span style="color: #009900;">&#91;</span>20<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span> 
		<span style="color: #993333;">unsigned</span> qty<span style="color: #339933;">;</span> 
		<span style="color: #993333;">float</span> price<span style="color: #339933;">;</span> 
	<span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">struct</span> food shop<span style="color: #009900;">&#91;</span>10<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
&nbsp;
	file <span style="color: #339933;">=</span> fopen<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;fscanf.txt&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;r&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>fscanf <span style="color: #009900;">&#40;</span>file<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;%s%u%f&quot;</span><span style="color: #339933;">,</span> shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">name</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span><span style="color: #009900;">&#40;</span>shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">qty</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span><span style="color: #009900;">&#40;</span>shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">price</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> EOF<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s %u %.2f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">name</span><span style="color: #339933;">,</span> shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">qty</span><span style="color: #339933;">,</span> shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">price</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
		i<span style="color: #339933;">++;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В данном случае объявляется структура и массив структур. Каждая строка из файла соответствует одному элементу массива; элемент массива представляет собой структуру, содержащую строковое и два числовых поля. За одну итерацию цикл считывает одну строку. Когда встречается конец файла <span class="geshifilter"><code class="c geshifilter-c">fscanf<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращает значение EOF и цикл завершается.</p>
<h4>fgets()</h4>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">fgets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> аналогична функции <span class="geshifilter"><code class="c geshifilter-c">gets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и осуществляет построчный ввод из файла. Один вызов <span class="geshifilter"><code class="c geshifilter-c">fgets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> позволят прочитать одну строку. При этом можно прочитать не всю строку, а лишь ее часть от начала. Параметры <span class="geshifilter"><code class="c geshifilter-c">fgets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выглядят таким образом:<br />
<span class="geshifilter"><code class="c geshifilter-c">fgets <span style="color: #009900;">&#40;</span></code></span><span class="monoi">массив_символов, количество_считываемых_символов, указатель_на_файл</span><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#41;</span></code></span></p>
<p>Например:<br />
<span class="geshifilter"><code class="c geshifilter-c">fgets <span style="color: #009900;">&#40;</span>str<span style="color: #339933;">,</span> <span style="color: #0000dd;">50</span><span style="color: #339933;">,</span> myfile<span style="color: #009900;">&#41;</span></code></span></p>
<p>Такой вызов функции прочитает из файла, связанного с указателем <span class="monoi">myfile</span>, одну строку текста полностью, если ее длина меньше 50 символов с учетом символа '\n', который функция также сохранит в массиве. Последним (50-ым) элементом массива <span class="monoi">str</span> будет символ '\0', добавленный <span class="geshifilter"><code class="c geshifilter-c">fgets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Если строка окажется длиннее, то функция прочитает 49 символов и в конце запишет '\0'. В таком случае '\n' в считанной строке содержаться не будет.<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 80</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
	FILE <span style="color: #339933;">*</span>file<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> arr<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
	file <span style="color: #339933;">=</span> fopen<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;fscanf.txt&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;r&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>fgets <span style="color: #009900;">&#40;</span>arr<span style="color: #339933;">,</span> N<span style="color: #339933;">,</span> file<span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> NULL<span style="color: #009900;">&#41;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span> arr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	fclose<span style="color: #009900;">&#40;</span>file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В этой программе в отличие от предыдущей данные считываются строка за строкой в массив <span class="monoi">arr</span>. Когда считывается следующая строка, предыдущая теряется. Функция <span class="geshifilter"><code class="c geshifilter-c">fgets<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращает NULL в случае, если не может прочитать следующую строку. </p>
<h4>getc() или fgetc()</h4>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">getc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c">fgetc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> (работает и то и другое) позволяет получить из файла очередной один символ.<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> fgetc <span style="color: #009900;">&#40;</span>file<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> EOF<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> <span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span>
			<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>arr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			i <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
		<span style="color: #b1b100;">else</span> i<span style="color: #339933;">++;</span>
	<span style="color: #009900;">&#125;</span>
	arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span>arr<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Приведенный в качестве примера код выводит данные из файла на экран.</p>
<h3>Запись в текстовый файл</h3>
<p>Также как и ввод, вывод в файл может быть различным. </p>
<ul>
<li>Форматированный вывод. Функция <span class="geshifilter"><code class="c geshifilter-c">fprintf <span style="color: #009900;">&#40;</span></code></span><span class="monoi">файловый_указатель, строка_формата, переменные</span><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#41;</span></code></span>.</li>
<li>Посточный вывод. Функция <span class="geshifilter"><code class="c geshifilter-c">fputs <span style="color: #009900;">&#40;</span></code></span><span class="monoi">строка, файловый_указатель</span><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#41;</span></code></span>.</li>
<li>Посимвольный вывод. Функция <span class="geshifilter"><code class="c geshifilter-c">fputc<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c">putc<span style="color: #009900;">&#40;</span></code></span><span class="monoi">символ, файловый_указатель</span><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#41;</span></code></span>.</li>
</ul>
<p>Ниже приводятся примеры кода, в которых используются три способа вывода данных в файл.</p>
<p>Запись в каждую строку файла полей одной структуры:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	file <span style="color: #339933;">=</span> fopen<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;fprintf.txt&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;w&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>scanf <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s%u%f&quot;</span><span style="color: #339933;">,</span> shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">name</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span><span style="color: #009900;">&#40;</span>shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">qty</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span><span style="color: #009900;">&#40;</span>shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">price</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> EOF<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		fprintf<span style="color: #009900;">&#40;</span>file<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;%s %u %.2f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">name</span><span style="color: #339933;">,</span> shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">qty</span><span style="color: #339933;">,</span> shop<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span>.<span style="color: #202020;">price</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> 
		i<span style="color: #339933;">++;</span>
	<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Построчный вывод в файл (<span class="geshifilter"><code class="c geshifilter-c">fputs<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, в отличие от <span class="geshifilter"><code class="c geshifilter-c">puts<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> сама не помещает в конце строки '\n'):<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>gets <span style="color: #009900;">&#40;</span>arr<span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> NULL<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		fputs<span style="color: #009900;">&#40;</span>arr<span style="color: #339933;">,</span> file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		fputs<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Пример посимвольного вывода:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>i <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> EOF<span style="color: #009900;">&#41;</span>
		putc<span style="color: #009900;">&#40;</span>i<span style="color: #339933;">,</span> file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<h3>Чтение из двоичного файла и запись в него</h3>
<p>С файлом можно работать не как с последовательностью символов, а как с последовательностью байтов. В принципе, с нетекстовыми файлами работать по-другому не возможно. Однако так можно читать и писать и в текстовые файлы. Преимущество такого способа доступа к файлу заключается в скорости чтения-записи: за одно обращение можно считать/записать существенный блок информации.</p>
<p>При открытии файла для двоичного доступа, вторым параметром функции <span class="geshifilter"><code class="c geshifilter-c">fopen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> является строка "rb" или "wb".</p>
<p>Тема о работе с двоичными файлами достаточно сложная, для ее изучения требуется отдельный урок. Здесь будут отмечены только особенности функций чтения-записи в файл, который рассматривается как поток байтов.</p>
<p>Функции <span class="geshifilter"><code class="c geshifilter-c">fread<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">fwrite<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> принимают в качестве параметров:</p>
<ol>
<li>адрес области памяти, куда данные записываются или откуда считываются,</li>
<li>размер одного данного какого-либо типа, </li>
<li>количество считываемых данных указанного размера,</li>
<li>файловый указатель.</li>
</ol>
<p>Эти функции возвращают количество успешно прочитанных или записанных данных. Т.е. можно "заказать" считывание 50 элементов данных, а получить только 10. Ошибки при этом не возникнет.</p>
<p>Пример использования функций <span class="geshifilter"><code class="c geshifilter-c">fread<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">fwrite<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;string.h&gt;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	FILE <span style="color: #339933;">*</span>file<span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> shelf1<span style="color: #009900;">&#91;</span>50<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> shelf2<span style="color: #009900;">&#91;</span>100<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> n<span style="color: #339933;">,</span> m<span style="color: #339933;">;</span>
&nbsp;
	file <span style="color: #339933;">=</span> fopen<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;shelf1.txt&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;rb&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	n<span style="color: #339933;">=</span>fread<span style="color: #009900;">&#40;</span>shelf1<span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 50<span style="color: #339933;">,</span> file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	fclose<span style="color: #009900;">&#40;</span>file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	file <span style="color: #339933;">=</span> fopen<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;shelf2.txt&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;rb&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	m<span style="color: #339933;">=</span>fread<span style="color: #009900;">&#40;</span>shelf2<span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> 50<span style="color: #339933;">,</span> file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	fclose<span style="color: #009900;">&#40;</span>file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
&nbsp;
	shelf1<span style="color: #009900;">&#91;</span>n<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span>
	shelf2<span style="color: #009900;">&#91;</span>m<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #339933;">;</span>
	shelf2<span style="color: #009900;">&#91;</span>m<span style="color: #339933;">+</span><span style="color: #0000dd;">1</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #339933;">;</span>
&nbsp;
	file <span style="color: #339933;">=</span> fopen<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;shop.txt&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;wb&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	fwrite<span style="color: #009900;">&#40;</span>strcat<span style="color: #009900;">&#40;</span>shelf2<span style="color: #339933;">,</span>shelf1<span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> <span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">,</span> n<span style="color: #339933;">+</span>m<span style="color: #339933;">,</span> file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	fclose<span style="color: #009900;">&#40;</span>file<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Здесь осуществляется попытка чтения из первого файла 50-ти символов. В <span class="monoi">n</span> сохраняется количество реально считанных символов. Значение <span class="monoi">n</span> может быть равно 50 или меньше. Данные помещаются в строку. То же самое происходит со вторым файлом. Далее первая строка присоединяется ко второй, и данные сбрасываются в третий файл.</p>
<h3>Решение задач</h3>
<p><span class="blue"><strong>Задание</strong></span></p>
<ol>
<li><span class="blue">Напишите программу, которая запрашивает у пользователя имя (адрес) текстового файла, далее открывает его и считает в нем количество символов и строк.</span></li>
<li><span class="blue">Напишите программу, которая записывает в файл данные, полученные из другого файла и так или иначе измененные перед записью. Каждая строка данных, полученная из файла, должна помещаться в структуру.</span></li>
</ol>
  </div>
<div id="node-378" class="section-2">
  <h1 class="book-heading">Урок 18. Аргументы программы (или функции main())</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Бывает, что данные в программу передаются из командной строки при ее вызове. Такие данные называются аргументами командной строки. Выглядит это так, например:</p>
<pre>
./a.out test.txt
ls -lt /home/peter/
</pre><p>
Здесь вызываются программы a.out (из текущего каталога) и ls (из одного каталога, указанного в переменной окружения PATH). Первая программа из командной строки получает одно слово — test.txt, вторая — два: -lt и /home/peter/.</p>
<p>Если программа написана на языке <span class="blue">C</span>, то при ее запуске управление сразу передается в функцию <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, следовательно, именно она получает аргументы командной строки, которые присваиваются ее переменным-параметрам. </p>
<p>До этого мы определяли функцию <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> так, как-будто она не принимает никакие параметры и ничего не возвращает. На самом деле в языке <span class="blue">C</span> любая функция по-умолчанию (если не определено ничего иного) возвращает целое число. В этом можно убедиться. Если записать код таким образом:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Hi<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>, то никакого предупреждения или ошибки при компиляции не возникнет. То же самое будет, если записать <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span> main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Это доказывает, что функция по-умолчанию возвращает целое число, а не ничто (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">void</span></code></span>). Хотя то, что возвращает функция всегда можно "переопределить", например, <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">void</span> main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">float</span> main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>.</p>
<p>При вызове программы из командной строки в нее всегда передается пара данных:</p>
<ol>
<li><strong>целое число</strong>, обозначающее количество слов (элементов, разделенных пробелами) в командной строке при вызове,</li>
<li><strong>указатель на массив строк</strong>, где каждая строка — это отдельное слово из командной строки.</li>
</ol>
<p>Следует иметь в виду, что само имя программы также считается. Например, если вызов выглядит так:</p>
<pre>./a.out 12 theme 2</pre><p>, то первый аргумент программы имеет значение 4, а массив строк определяется как {"./a.out", "12", "theme", "2"}. </p>
<p>Обратите внимание на терминологию, есть всего два аргумента программы (число и массив), но сколько угодно аргументов командной строки. Аргументы командной строки "преобразуются" в аргументы программы (в аргументы функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>).<br />
Эти данные (число и указатель) передаются в программу даже тогда, когда она просто вызывается по имени без передачи в нее чего-либо: ./a.out. В таком случае первый аргумент имеет значение 1, а второй указывает на массив, состоящий всего из одной строки {"./a.out"}.</p>
<p>То, что в программу передаются данные, вовсе не означает, что функция <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> должна их принимать. Если функция <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> определена без параметров, то получить доступ к аргументам командной строки невозможно. Хотя ничего вам не мешает их передавать. Ошибки не возникнет.</p>
<p>Чтобы получить доступ к переданным в программу данным, их необходимо присвоить переменным. Поскольку аргументы сразу передаются в <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, то ее заголовок должен выглядеть таким образом:<br />
<span class="geshifilter"><code class="c geshifilter-c">main <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> n<span style="color: #339933;">,</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>arr<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span></code></span></p>
<p>В первой переменной (<span class="monoi">n</span>) содержится количество слов, а во второй — указатель на массив строк. Часто второй параметр записывают в виде <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">**</span>arr</code></span>. Однако это то же самое. Вспомним, что сам массив строк, содержит в качестве своих элементов указатели на строки. А в функцию мы передаем указатель на первый элемент массива. Получается, что передаем указатель на указатель, т.е. <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">**</span>arr</code></span>.</p>
<p><span class="blue"><strong>Задание</strong><br />
Напишите такую программу:</span><br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
main<span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> argc<span style="color: #339933;">,</span> <span style="color: #993333;">char</span> <span style="color: #339933;">**</span>argv<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> argc<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> argc<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		puts<span style="color: #009900;">&#40;</span>argv<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p><span class="blue">Она выводит количество слов в командной строке при ее вызове и каждое слово с новой строки. Вызовите ее без аргументов командной строки и с аргументами. </span></p>
<p>В программе мы использовали переменные-параметры <span class="monoi">argc</span> и <span class="monoi">argv</span>. Принято использовать именно такие имена, но на самом деле они могут быть любыми. Лучше придерживаться этого стандарта, чтобы ваши программы были более понятны не только вам, но и другим программистам.</p>
<h3>Практическое значение передачи данных в программу</h3>
<p>Если у вас есть опыт работы в командной строке GNU/Linux, вы знаете, что у большинства команд есть ключи и аргументы. Например, при просмотре содержимого каталогов, копировании,  перемещении в качестве аргументов указываются объекты файловой системы,  над которыми выполняется команда. Особенности ее выполнения определяются с помощью ключей. Например, в команде </p>
<pre>cp -r ../les_1 ../les_101 </pre><p>cp — это имя команды, -r — ключ, а ../les_1 и ../les_101 — аргументы команды.</p>
<p>Вообще чаще всего в программы при их запуске передаются адреса файлов и "модификаторы" (это ключи) процесса выполнения программы. </p>
<p>Напишем программу, которая открывает указанные пользователем в командной строке файлы на запись или добавление и записывает (добавляет) туда одну и туже информацию, которую пользователь вводит с клавиатуры в процессе выполнения программы:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &lt;string.h&gt;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #993333;">int</span> argc<span style="color: #339933;">,</span> <span style="color: #993333;">char</span> <span style="color: #339933;">**</span>argv<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span> 
	<span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> ch<span style="color: #339933;">;</span>
	FILE <span style="color: #339933;">*</span>f<span style="color: #009900;">&#91;</span>5<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>argc <span style="color: #339933;">&lt;</span> 3 <span style="color: #339933;">||</span> argc <span style="color: #339933;">&gt;</span> <span style="color: #0000dd;">7</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		puts<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Неверное количество параметров&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">1</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>strcmp<span style="color: #009900;">&#40;</span>argv<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;-w&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> <span style="color: #0000dd;">0</span> <span style="color: #339933;">&amp;&amp;</span> strcmp<span style="color: #009900;">&#40;</span>argv<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;-a&quot;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> <span style="color: #0000dd;">0</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		puts<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Первый параметр может быть либо -w, либо -a&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> argc<span style="color: #339933;">-</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#123;</span>
		f<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> fopen<span style="color: #009900;">&#40;</span>argv<span style="color: #009900;">&#91;</span>i<span style="color: #339933;">+</span>2<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> argv<span style="color: #009900;">&#91;</span>1<span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span>1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>f<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">==</span> NULL<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;Файл %s нельзя открыть<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> argv<span style="color: #009900;">&#91;</span>i<span style="color: #339933;">+</span>2<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">3</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#40;</span>ch <span style="color: #339933;">=</span> getchar<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">!=</span> EOF<span style="color: #009900;">&#41;</span>
		<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> argc<span style="color: #339933;">-</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
			putc<span style="color: #009900;">&#40;</span>ch<span style="color: #339933;">,</span>f<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> argc<span style="color: #339933;">-</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
		fclose<span style="color: #009900;">&#40;</span>f<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">return</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Пояснения к коду:</p>
<ol>
<li>Создается массив из пяти файловых указателей. Следовательно можно одновременно открыть не более пяти файлов. Файловый указатель первого файла будет хранится в элементе массива f[0], второго — в f[1] и т.д.</li>
<li>Проверяется количество аргументов командной строки. Их должно быть не меньше трех, т.к. первый - это имя программы, второй — режим открытия файла, третий — первый или единственный файл, в который будет производится запись. Поскольку программа позволяет открыть только пять файлов, то общее число аргументов командной строки не может быть больше семи. Поэтому если количество аргументов меньше 3 или больше 7, то программа завершается, т.к. оператор <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">return</span></code></span> приводит к выходу из функции, даже если после него есть еще код. Возвращаемое из функции значение неравное 0, может быть интерпретировано родительским процессом, как сообщение о том, что программа завершилась с ошибкой.</li>
<li>Проверяется корректность второго аргумента командной строки. Если он не равен ни "-w", ни "-a", то условное выражение во втором <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span> возвращает 1 (true). Функция <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> позволяет сравнивать строки и возвращает 0 в случае их равенства.</li>
<li>В цикле <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span> открываются файлы по указанным адресам, которые начинаются с третьего элемента массива <span class="monoi">argv</span>. Именно поэтому к <span class="monoi">i</span> прибавляется 2, чтобы получать элементы массива <span class="monoi">argv</span>, начиная с третьего. Выражение <span class="geshifilter"><code class="c geshifilter-c">argc<span style="color: #339933;">-</span><span style="color: #0000dd;">2</span></code></span> указывает на количество переданных имен файлов; т.к. в <span class="monoi">argc</span> хранится общее число аргументов командной строки, первые два из которых не являются именами файлов.</li>
<li>Выражение <span class="geshifilter"><code class="c geshifilter-c">argv<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #009900;">&#93;</span><span style="color: #339933;">+</span><span style="color: #0000dd;">1</span></code></span> позволяет "вырезать" из строки "-w" (или "-a") подстроку "w" (или "a"), т.к. <span class="geshifilter"><code class="c geshifilter-c">argv<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">1</span><span style="color: #009900;">&#93;</span></code></span> по сути указатель на первый элемент строки. Прибавляя к указателю единицу, мы смещаем его к следующему элементу массива.</li>
<li>Если файл отрыть не удается, то функция <span class="geshifilter"><code class="c geshifilter-c">fopen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> возвращает NULL. В таком случае программа завершается.</li>
<li>Каждый символ, введенный пользователем с клавиатуры, записывается во все открытые файлы. </li>
<li>В конце файлы закрываются.</li>
</ol>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте свой пример использования аргументов командной строки в программе. Реализуйте его.</span></p>
  </div>
<div id="node-379" class="section-2">
  <h1 class="book-heading">Урок 19. Препроцессор языка С</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>В компилятор языка программирования <span class="blue">C</span> входит так называем препроцессор, который осуществляет подготовку программы к компиляции. Среди прочего он, например, включает содержимое одних файлов в другие, заменяет в тексте исходного кода имена констант на их значения, удаляет символы конца строки (которые нужны только программисту, чтобы код можно было легко читать, но не нужны компилятору). Что-то препроцессор делает по-умолчанию, а какие-то его действия программируются с помощью специальных директив в исходном коде. Директивы препроцессора начинаются со знака # и заканчиваются переходом на новую строку. В отличие от законченного выражения на языке <span class="blue">C</span>, в конце директив не надо ставить точку с запятой. Ниже рассматриваются наиболее распространенные директивы препроцессора и некоторые его свойства, но это далеко не все, что может делать препроцессор.</p>
<h3>Директива #include</h3>
<p>С этой директивой мы уже не раз встречались, подключая заголовочные файлы стандартной библиотеки языка, содержащие объявления (прототипы) функций. Когда препроцессор встречает такую директиву, то понимает, что после нее идет имя файла, и включает все содержимое указанного файла в исходный код программы. Поэтому объем кода вашей программы после обработки ее препроцессором может сильно увеличиться. </p>
<p>Если имя файла после директивы <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#include</span></code></span> заключено в угловые скобки (например, <stdio.h>), то поиск заголовочного файла производится в стандартном (специально оговоренном системой) каталоге. Однако в тексте программы может встречаться и такая запись:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &quot;ext.h&quot;</span></pre></div></stdio.h></p>
<p>В таком случае заголовочный файл в первую очередь будет искаться в текущем каталоге. Таким образом, программист сам может определять заголовочные файлы для своих проектов. Кроме того, можно указывать адрес заголовочного файла:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &quot;/home/iam/project10/const.h&quot;</span></pre></div></p>
<h3>Директива #define</h3>
<h4>Символические константы</h4>
<p>С директивой препроцессора <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#define</span></code></span> мы также уже знакомы. С ее помощью объявляются и определяются так называемые символические константы. Например:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#define N 100</span>
<span style="color: #339933;">#define HELLO &quot;Hello. Answer the next questions, please.&quot;</span></pre></div></p>
<p>Когда перед компиляцией исходный код будет обработан препроцессором, то все символьные константы (в примере это <span class="monoi">N</span> и <span class="monoi">HELLO</span>) в тексте исходного кода на языке <span class="blue">C</span> будут заменены на соответствующие им числовые или строковые константы.</p>
<p>Символические константы можно определять в любом месте исходного кода. Однако чтобы переопределить их (изменить значение), необходимо отменить предыдущее определение. Иначе возникнет если не ошибка, то предупреждение. Для удаления символической константы используют директиву <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#undef</span></code></span>:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define HELLO &quot;Hello. Answer the next questions, please.\n&quot;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span>HELLO<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #339933;">#undef HELLO</span>
	<span style="color: #339933;">#define HELLO &quot;Good day. Tell us about you.\n&quot;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span>HELLO<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Если в этом примере убрать строку <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#undef HELLO</span></code></span>, то при компиляции в GNU/Linux появляется предупреждение: "HELLO" переопределён.</p>
<p>Символические константы принято писать заглавными буквами. Это только соглашение для удобства чтения кода.</p>
<h4>Макросы как усложненные символьные константы</h4>
<p>С помощью директивы <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#define</span></code></span> можно заменять символьными константами не только числовые и строковые константы, но почти любую часть кода:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 100</span>
<span style="color: #339933;">#define PN printf(&quot;\n&quot;)</span>
<span style="color: #339933;">#define SUM for(i=0; i&lt;N; i++) sum += i</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> sum <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
&nbsp;
	SUM<span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span> sum<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	PN<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Здесь в теле функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> <span class="monoi">PN</span> заменяется препроцессором на <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span></code></span>, а <span class="monoi">SUM</span> на цикл <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span>. Такие макроопределения (макросы) в первую очередь удобны, когда в программе часто встречается один и тот же код, но выносить его в отдельную функцию нет смысла. </p>
<p>В примере выше <span class="monoi">PN</span> и <span class="monoi">SUM</span> являются макросами без аргументов. Однако препроцессор языка программирования <span class="blue">C</span> позволяет определять макросы с аргументами:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define DIF(a,b) (a) &gt; (b) ? (a)-(b) : (b)-(a)</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>	
	<span style="color: #993333;">int</span> x <span style="color: #339933;">=</span> 10<span style="color: #339933;">,</span> y <span style="color: #339933;">=</span> <span style="color: #0000dd;">30</span><span style="color: #339933;">;</span>	
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> DIF<span style="color: #009900;">&#40;</span>67<span style="color: #339933;">,</span>90<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> DIF<span style="color: #009900;">&#40;</span>876<span style="color: #339933;">-</span>x<span style="color: #339933;">,</span>90<span style="color: #339933;">+</span>y<span style="color: #009900;">&#41;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Вызов макроса <span class="geshifilter"><code class="c geshifilter-c">DIV<span style="color: #009900;">&#40;</span><span style="color: #0000dd;">67</span><span style="color: #339933;">,</span><span style="color: #0000dd;">90</span><span style="color: #009900;">&#41;</span></code></span> в тексте программы приводит к тому, что при обработке программы препроцессором туда подставляется такое выражение <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span><span style="color: #0000dd;">67</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #009900;">&#40;</span><span style="color: #0000dd;">90</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> <span style="color: #009900;">&#40;</span><span style="color: #0000dd;">67</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #009900;">&#40;</span><span style="color: #0000dd;">90</span><span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> <span style="color: #009900;">&#40;</span><span style="color: #0000dd;">90</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #009900;">&#40;</span><span style="color: #0000dd;">67</span><span style="color: #009900;">&#41;</span></code></span>. В этом выражении вычисляется разница между двумя числами с помощью условного выражения (см. урок 3). В данном случае скобки не нужны. Однако при таком разворачивании <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #009900;">&#40;</span><span style="color: #0000dd;">876</span><span style="color: #339933;">-</span>x<span style="color: #009900;">&#41;</span> <span style="color: #339933;">&gt;</span> <span style="color: #009900;">&#40;</span><span style="color: #0000dd;">90</span><span style="color: #339933;">+</span>y<span style="color: #009900;">&#41;</span> <span style="color: #339933;">?</span> <span style="color: #009900;">&#40;</span><span style="color: #0000dd;">876</span><span style="color: #339933;">-</span>x<span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #009900;">&#40;</span><span style="color: #0000dd;">90</span><span style="color: #339933;">+</span>y<span style="color: #009900;">&#41;</span> <span style="color: #339933;">:</span> <span style="color: #009900;">&#40;</span><span style="color: #0000dd;">90</span><span style="color: #339933;">+</span>y<span style="color: #009900;">&#41;</span><span style="color: #339933;">-</span><span style="color: #009900;">&#40;</span><span style="color: #0000dd;">876</span><span style="color: #339933;">-</span>x<span style="color: #009900;">&#41;</span></code></span> скобки подчеркивают порядок операций. Если бы вместо сложения и вычитания фигурировали операции умножения или деления, то наличие скобок было бы принципиальным.<br />
Обратите внимание, что в имени макроса не должно быть пробелов: <span class="geshifilter"><code class="c geshifilter-c">DIF<span style="color: #009900;">&#40;</span>a<span style="color: #339933;">,</span>b<span style="color: #009900;">&#41;</span></code></span>. Первый пробел после идентификатора означает конец символической константы и начало выражения для подстановки.</p>
<p><span class="blue"><strong>Задание</strong></span></p>
<ol>
<li><span class="blue">Напишите программу, содержащую пару макросов: один вычисляет сумму элементов массива, другой выводит элементы массива на экран.</span></li>
<li><span class="blue">Напишите программу, содержащую макросы с аргументами, вычисляющие площади различных геометрических фигур (например, квадрата, прямоугольника, окружности).</span></li>
</ol>
<h3>Директивы условной компиляции</h3>
<p>Так называемая условная компиляция позволяет компилировать или не компилировать части кода в зависимости от наличия символьных констант или их значения.</p>
<p>Условное выражение для препроцессора выглядит в сокращенном варианте так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#if …</span>
	…
<span style="color: #339933;">#endif</span></pre></div></p>
<p>То, что находится между <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#if</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#endif</span></code></span> выполняется, если выражение при <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#if</span></code></span> возвращает истину. Находится там могут как директивы препроцессора так и исходный код на языке <span class="blue">C</span>. </p>
<p>Следует знать, что условное включение может быть расширено за счет веток <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#else</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#elif</span></code></span>.</p>
<p>Рассмотрим несколько примеров.</p>
<p>Если в программе константа <span class="monoi">N</span> не равна 0, то цикл <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span> выполнится, и массив <span class="monoi">arr</span> заполнится нулями. Если <span class="monoi">N</span> определена и равна 0, или не определена вообще, то цикл выполняться не будет:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 10</span>
&nbsp;
main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> arr<span style="color: #009900;">&#91;</span>100<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #339933;">#if N</span>
		<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">;</span>
			<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d &quot;</span><span style="color: #339933;">,</span> arr<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #009900;">&#125;</span>		
	<span style="color: #339933;">#endif</span>
&nbsp;
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Если нужно выполнить какой-то код в зависимости от наличия символьной константы, а не ее значения, то директива <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#if</span></code></span> будет выглядеть так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#if defined(N)</span></pre></div></p>
<p>Или сокращенно (что тоже самое):<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#ifdef N</span></pre></div></p>
<p>Когда нет уверенности, была ли определена ранее символьная константа, то можно использовать такой код:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#if !defined(N)</span>
	<span style="color: #339933;">#define N 100	</span>
<span style="color: #339933;">#endif</span></pre></div></p>
<p>Таким образом мы определим константу <span class="monoi">N</span>, если она не была определена ранее. Такие проверки могут встречаться в многофайловых проектах. Выражение препроцессора <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #339933;">#if !defined(N)</span></code></span> может быть сокращено так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#ifndef N</span></pre></div></p>
<p>Следует знать, что условную компиляцию иногда используют при отладке программного кода, а также с ее помощью компилируют программы под конкретные операционные системы.</p>
<p>Помните, что препроцессор обрабатывает программу до компиляции. В двоичном коде уже отсутствуют какие-либо условные выражения для препроцессора. Поэтому в логическом выражении "препроцессорного if" не должно содержаться переменных, значение которых определяется в момент выполнения программы.</p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте и напишите программу, которая может быть скомпилирована по-разному в зависимости от того, определена или нет в ней какая-либо символьная константа.</span></p>
<h3>Константы, определенные препроцессором</h3>
<p>Препроцессор самостоятельно определяет пять констант. От обычных (определенных программистом) они отличаются наличием пары символов подчеркивания в начале и конце их имени. </p>
<ul>
<li>__DATE__ - дата компиляции;</li>
<li>__FILE__ - имя компилируемого файла;</li>
<li>__LINE__ - номер текущей строки исходного текста программы;</li>
<li>__STDC__ - равна 1, если компилятор работает по стандарту ANSI для языка <span class="blue">C</span>;</li>
<li>__TIME__ - время компиляции.</li>
</ul>
<p>Если эти константы встречаются в тексте программы, то заменяются на соответствующие строки или числа. Т.к. это происходит до компиляции, то, например, мы видим дату компиляции, а не дату запуска программы на выполнение. Программа ниже выводит значение предопределенных препроцессором имен на экран:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define NL printf(&quot;\n&quot;)</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span>__DATE__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> NL<span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span>__LINE__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> NL<span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span>__FILE__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> NL<span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span>__TIME__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> NL<span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%d&quot;</span><span style="color: #339933;">,</span>__STDC__<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span> NL<span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
Результат<span style="color: #339933;">:</span>
Mar <span style="color: #0000dd;">22</span> <span style="color: #0000dd;">2012</span> 
<span style="color: #0000dd;">7</span> 
macronames.<span style="color: #202020;">c</span> 
<span style="color: #0000dd;">10</span><span style="color: #339933;">:</span>07<span style="color: #339933;">:</span>04 
<span style="color: #0000dd;">1</span> </pre></div></p>
  </div>
<div id="node-380" class="section-2">
  <h1 class="book-heading">Урок 20. Многофайловые программы</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Объектный код</h3>
<p>Запуск gcc позволяет обработать файл с исходным кодом препроцессором и далее скомпилировать его. Однако при этом сам инструмент gcc не компилирует файл исходного кода в конечный исполняемый файл. Он компилирует его в объектный файл, после чего вызывает так называемый линковщик, или компоновщик. Но зачем надо сначала получать объектный файл, а потом из него уже исполняемый? Для программ, состоящих из одного файла, такой необходимости нет. Хотя при желании здесь также можно отказаться от компоновки, если выполнить команду gcc с ключом -c:</p>
<pre>gcc -c hello.c</pre><p>
В результате получится файл с расширением *.o. Чтобы получить из объектного файла исполняемый, надо использовать ключ -o:</p>
<pre>gcc -o hello hello.o</pre><p>
<span class="blue"><strong>Задание</strong><br />
Получите из любого ранее написанного файла с исходным кодом на языке C объектный файл, а затем из него исполняемый. </span></p>
<p>Для программ, состоящих из нескольких файлов исходного кода, получение объектных файлов является необходимым. Именно из них потом компонуется единственный исполняемый файл.</p>
<h3>Компиляция программы, состоящей из нескольких файлов исходного кода</h3>
<p>Рассмотрим пример. Пусть в одном файле определена пара функций, а в другом, содержащем функцию <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, осуществляется их вызов. </p>
<p>Файл superprint.c:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #993333;">void</span> l2r <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">**</span>c<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> n<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> j<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>n<span style="color: #339933;">;</span> i<span style="color: #339933;">++,</span> c<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>j<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> j<span style="color: #339933;">&lt;</span>i<span style="color: #339933;">;</span> j<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
			<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066;">printf</span> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,*</span>c<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> r2l <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">**</span>c<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> n<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> j<span style="color: #339933;">;</span>
	<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span><span style="color: #339933;">;</span> n<span style="color: #339933;">&gt;</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> n<span style="color: #339933;">--,</span> c<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>j<span style="color: #339933;">=</span><span style="color: #0000dd;">1</span><span style="color: #339933;">;</span> j<span style="color: #339933;">&lt;</span>n<span style="color: #339933;">;</span> j<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span>
			<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;<span style="color: #000099; font-weight: bold;">\t</span>&quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		<span style="color: #000066;">printf</span> <span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,*</span>c<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Файл main.c:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #339933;">#define N 5</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">char</span> strs<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>10<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>p<span style="color: #009900;">&#91;</span>N<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span><span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span>N<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span> strs<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		p<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #339933;">&amp;</span>strs<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>0<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	l2r<span style="color: #009900;">&#40;</span>p<span style="color: #339933;">,</span> N<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>	
	r2l<span style="color: #009900;">&#40;</span>p<span style="color: #339933;">,</span> N<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В теле функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> заполняется массив, состоящий из строк, а также массив указателей на эти строки. Далее в функции <span class="geshifilter"><code class="c geshifilter-c">l2r<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">r2l<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> передаются ссылки на первый элемент массива указателей и значение символической константы N. Эти функции осуществляют вывод элементов массива строк с отступами.</p>
<p>Чтобы получить исполняемый файл этой программы, надо сначала получить объектные файлы из исходных:</p>
<pre>
gcc -c superprint.c
gcc -c main.c
</pre><p>
Тоже самое можно сделать за один вызов gcc:</p>
<pre>gcc -c superprint.c main.c</pre><p>
Или даже вот так, если в каталоге находятся только файлы текущего проекта:</p>
<pre>gcc -c *.c</pre><p>
В любом случае в каталоге появятся два объектных файла: superprint.o и main.o. Далее их можно скомпилировать в один исполняемый файл так:</p>
<pre>gcc -o myprint main.o superprint.o</pre><p>
или так:</p>
<pre>gcc -o myprint *.o</pre><p>
Обратите внимание на то, что в данном случае обязательно требуется указывать имя исполняемого файла. Такой вариант недопустим:</p>
<pre>gcc -o main.o superprint.o</pre><p>
Если теперь запустить файл myprint, то программа будет ожидать ввода пяти слов, после чего выведет их на экран два раза по-разному (с помощью функций <span class="geshifilter"><code class="c geshifilter-c">l2r<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">r2l<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>):<br />
<img src="../../../img/c/myprint.png" width="376" height="213" alt="Скомпилированная программа" /></p>
<p>Задумаемся, каким образом в представленной выше программе функция <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> "узнает" о существовании функций <span class="geshifilter"><code class="c geshifilter-c">l2r<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">r2l<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Ведь в исходном коде файла main.c нигде не указано, что мы подключаем файл superprint.c, содержащий эти функции. Действительно, если попытаться получить из <span class="geshifilter"><code class="c geshifilter-c">main.<span style="color: #202020;">c</span></code></span> отдельный исполняемый файл, т.е. скомпилировать программу без superprint.c:</p>
<pre>gcc main.c</pre><p>, то ничего не получиться. Компилятор сообщит об ошибке вызова неопределенных идентификаторов. Получить из файла superprint.c отдельный исполняемый файл вообще невозможно, т.к. там отсутствует функция <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. А вот получить из этих файлов отдельные объектные файлы можно. Представим, что одни объектные файлы как бы "выставляют наружу" имена определенных в них функций и глобальных переменных, а другие - вызовы этих имен из тел других функций. Дальше объектные файлы "ожидают", что имена будут связаны с их вызовами. Связывание происходит при компиляции исполняемого файла из объектных.</p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте и напишите свой пример программы, состоящей из двух-трех файлов исходного кода.</span></p>
<h3>Создание заголовочных файлов</h3>
<p>Продолжим разбирать приведенную выше программу. Что будет, если в функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> осуществить неправильный вызов функций <span class="geshifilter"><code class="c geshifilter-c">l2r<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">r2l<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>? Например, указать неверное количество параметров. В таком случае создание объектных файлов пройдет без ошибок, и скорее всего удастся получить исполняемый файл; но вот работать программа будет неправильно. Такое возможно потому, что ничего не контролирует соответствие вызовов прототипам (объявлениям) функций.</p>
<p><span class="blue"><strong>Задание</strong><br />
В вашей программе в функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> вызовите функцию из другого файла с неверным количеством параметров. Попробуйте скомпилировать программу и запустить исполняемый файл.</span> </p>
<p>Куда правильней сообщать о неверном вызове функций уже при получении объектного файла. Поэтому хотя можно обойтись и без этого, но очень желательно сообщать функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> прототипы функций, которые из нее вызываются. Это можно сделать, прописав объявления функций в файле main.c:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">…
<span style="color: #993333;">void</span> l2r <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">**</span>c<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> n<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> r2l <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">**</span>c<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> n<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
…</pre></div></p>
<p>Теперь, если мы передадим неправильные параметры, ошибка возникнет уже на этапе получения объектных файлов.</p>
<p>А теперь представим, что программа у нас несколько больше и содержит десяток файлов исходного кода. Файл aa.c требует функций из файла bb.c, dd.c, ee.c. В свою очередь dd.c вызывает функции из ee.c и ff.c, а эти два последних файла активно пользуются неким файлом stars.c и одной из функций в bb.c. Программист замучится сверять, что чего вызывает откуда и куда, где и какие объявления надо прописывать. Поэтому все прототипы (объявления) функций проекта, а также совместно используемые символические константы и макросы выносят в отдельный файл, который подключают к каждому файлу исходного кода. Такие файлы называются заголовочными; с ними мы уже не раз встречались. В отличие от заголовочных файлов стандартной библиотеки, заголовочные файлы, которые относятся только к вашему проекту, при подключении к файлу исходного кода заключаются в кавычки, а не скобки. Об этом упоминалось в предыдущем уроке. </p>
<p>Итак, более грамотно будет не добавлять объявления функций в файл main.c, а создать заголовочный файл, например, myprint.h и поместить туда прототипы функций <span class="geshifilter"><code class="c geshifilter-c">l2r<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">r2l<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. А в файле <span class="geshifilter"><code class="c geshifilter-c">main.<span style="color: #202020;">c</span></code></span> следует прописать директиву препроцессора:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &quot;myprint.h&quot;</span></pre></div></p>
<p>В принципе смысла подключать myprint.h к файлу superprint.c в данном случае нет, т.к. последний не использует никаких сторонних функций, кроме стандартной библиотеки. Но если планируется расширять программу и есть вероятность, что в файле superprint.c будут вызываться сторонние для него функции, то будет надежней сразу подключить заголовочный файл.</p>
<p><span class="blue"><strong>Задание</strong><br />
Создайте заголовочный файл для вашей программы и подключите его к файлам исходного кода.</span></p>
<p>Обратим внимание еще на один момент. Стоит ли в описанном в этом уроке примере выносить константу N в заголовочный файл? Здесь нельзя дать однозначный ответ. Если ее туда вынести, то она станет доступна в обоих файлах, и поэтому можно изменить прототипы функций так, чтобы они принимали только один параметр (указатель), а значение N будет известно функциям их заголовочного файла. Однако стоит ли так делать? В функции <span class="geshifilter"><code class="c geshifilter-c">r2l<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> второй параметр изменяется в процессе ее выполнения, что делать с константой будет невозможно. Придется переписывать тело функции. Кроме того, вдруг в последствии нам захочется использовать файл superprint.c в другом проекте, где будут свои порядки, и константы N в заголовочном файле не найдется. </p>
<p>В таком случае лучше N не выносить в заголовочный файл. Хотя имейте в виду, в каких-то проектах символическая константа может использоваться так часто и во множестве функций, что ее будет лучше поместить в заголовочный файл.</p>
<h3>Особенности использования глобальных переменных</h3>
<p>Помните, если можно отказаться от использования глобальных переменных, то лучше это сделать. Желательно стремиться к тому, чтобы любой файл проекта, скажем так, "не лез к соседу за данными, а сосед не разбрасывал эти данные в виде глобальных переменных". Обмен данными между функциями должен осуществлять за счет передачи данных в качестве параметров и возврата значений с помощью оператора <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">return</span></code></span>. (Массивов это не касается.)</p>
<p>Однако в языке программирования <span class="blue">C</span> есть проблема на этот счет. С помощью <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">return</span></code></span> можно вернуть только одно значение. Но могут быть случаи, когда функция должна изменить несколько переменных (здесь не имеются ввиду элементы массива). В таком случае, возможно, без глобальных переменных не обойтись. Так как же их использовать, если вдруг?</p>
<ul>
<li>Если в файле aa.c объявлена переменная за пределами любой функции (например, так: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">int</span> count</code></span>), то она является глобальной для всех файлов проекта. Чтобы получить значение этой переменной в файле aa.c достаточно просто указать ее имя (если в функции нет локальной переменной с тем же именем). Чтобы получить значение из других файлов, надо указать, что имеется в виду глобальная переменная, а не локальная. Делается это с помощью ключевого слова <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000000; font-weight: bold;">extern</span></code></span> (например, <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000000; font-weight: bold;">extern</span> count</code></span>).</li>
<li>Бывают ситуации, когда в одном файле для нескольких содержащихся в нем функций нужна глобальная переменная. Но эта переменная не должна быть доступна функциям, содержащимся в других файлах. В таком случае глобальная переменная объявляется с ключевым словом <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">static</span></code></span> (например, <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">static</span> <span style="color: #993333;">int</span> count</code></span>). Тем самым мы как бы скрываем глобальную переменную.</li>
</ul>
<p><span class="blue"><strong>Задание</strong><br />
Напишите простые наглядные примеры, использования глобальных функций: </span></p>
<ol>
<li><span class="blue">Объявите глобальную переменную в одном файле, а получите ее значение в другом файле (выведите на экран).</span></li>
<li><span class="blue">Объявите в одном файле статическую глобальную переменную. Выведите ее значение на экран из функции данного файла. Попытайтесь сделать это из функции другого файла.</span></li>
<li><span class="blue">Создайте две глобальные переменные в одном файле. В другом файле напишите функцию, которая меняет их значение.</span></li>
</ol>
  </div>
<div id="node-381" class="section-2">
  <h1 class="book-heading">Урок 21. Библиотеки</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Библиотеки позволяют использовать разработанный ранее программный код в различных программах. Таким образом, программист может не разрабатывать часть кода для своей программы, а воспользоваться тем, что входит в состав библиотек. Обычно код библиотек отличается качеством, позволяет писать более ясный код, понятный большинству программистов.</p>
<p>В языке программирования <span class="blue">C</span> код библиотек представляет собой функции, размещенные в файлах, которые скомпилированы в объектные файлы, а те, в свою очередь, объединены в библиотеки. В одной библиотеке объединяются функции, решающие определенный тип задач. Например, существует библиотека математических функций.</p>
<p>У каждой библиотеки должен быть свой заголовочный файл, в котором должны быть описаны прототипы (объявления) всех функций, содержащихся в этой библиотеке. С помощью заголовочных файлов вы "сообщаете" вашему программному коду, какие библиотечные функции есть и как их использовать. </p>
<p>При компиляции программы библиотеки подключаются линковщиком, который вызывается gcc. Если программе требуются только стандартные библиотеки, то дополнительных параметров линковщику передавать не надо (есть исключения). Он "знает", где стандартные библиотеки находятся, и подключит их автоматически. Во всех остальных случаях при компиляции программы требуется указать имя библиотеки и ее местоположение.</p>
<p>Библиотеки бывают двух видов — статические и динамические. Код первых при компиляции полностью входит в состав исполняемого файла, что делает программу легко переносимой. Код динамических библиотек не входит в исполняемый файл, последний содержит лишь ссылку на библиотеку. Если динамическая библиотека будет удалена или перемещена в другое место, то программа работать не будет. С другой стороны, использование динамических библиотек позволяет сократить размер исполняемого файла. Также если в памяти находится две программы, использующие одну и туже динамическую библиотеку, то последняя будет загружена в память лишь единожды.</p>
<p>Далее будет описан пример, в котором создается библиотека, после чего используется при создании программы.</p>
<h3>Пример создания библиотеки</h3>
<p>Допустим, мы хотим создать код, который в дальнейшем планируем использовать в нескольких проектах. Следовательно, нам требуется создать библиотеку. Исходный код для библиотеки было решено разместить в двух файлах исходного кода.<br />
Также на данный момент у нас есть план первого проекта, использующего эту библиотеку. Сам проект также будет включать два файла.</p>
<p>В итоге, когда все будет сделано, схема каталогов и файлов будет выглядеть так:</p>
<p><img src="../../../img/c/sheme.png" width="691" height="403" alt="Файловая структура библиотеки  и программы" /></p>
<p>Пусть каталоги library и project находятся в одном общем каталоге, например, домашнем каталоге пользователя. Каталог library содержит каталог source с файлами исходных кодов библиотеки. Также в library будут находиться заголовочный файл (содержащий описания функций библиотеки), статическая (libmy1.a) и динамическая (libmy2.so) библиотеки. Каталог project будет содержать файлы исходных кодов проекта и заголовочный файл с описанием функций проекта. Также после компиляции с подключением библиотеки здесь будет располагаться исполняемый файл проекта.<br />
В операционных системах GNU/Linux имена файлов библиотек должны иметь префикс "lib", статические библиотеки - расширение *.a, динамические - *.so.</p>
<p>Для компиляции проекта достаточно иметь только одну библиотеку: статическую или динамическую. В образовательных целях мы получим обе и сначала скомпилируем проект со статической библиотекой, потом — с динамической. Статическая и динамическая "разновидности" одной библиотеки по-идее должны называться одинаково (различаются только расширения). Поскольку у нас обе библиотеки будут находиться в одном каталоге, то чтобы быть уверенными, что при компиляции проекта мы используем ту, которую хотим, их названия различны (libmy1 и libmy2).</p>
<h4>Исходный код библиотеки</h4>
<p>Файл figure.c:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">void</span> rect <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> sign<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> width<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> height<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> j<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> width<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> putchar<span style="color: #009900;">&#40;</span>sign<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> height<span style="color: #339933;">-</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>j<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> j <span style="color: #339933;">&lt;</span> width<span style="color: #339933;">;</span> j<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>j<span style="color: #339933;">==</span>0 <span style="color: #339933;">||</span> j<span style="color: #339933;">==</span>width<span style="color: #339933;">-</span>1<span style="color: #009900;">&#41;</span> putchar<span style="color: #009900;">&#40;</span>sign<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #b1b100;">else</span> putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">' '</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		
		<span style="color: #009900;">&#125;</span>
		putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> width<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> putchar<span style="color: #009900;">&#40;</span>sign<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> diagonals <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> sign<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> width<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">,</span> j<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i <span style="color: #339933;">&lt;</span> width<span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>j<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> j <span style="color: #339933;">&lt;</span> width<span style="color: #339933;">;</span> j<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
			<span style="color: #b1b100;">if</span> <span style="color: #009900;">&#40;</span>i <span style="color: #339933;">==</span> j <span style="color: #339933;">||</span> i<span style="color: #339933;">+</span>j <span style="color: #339933;">==</span> width<span style="color: #339933;">-</span>1<span style="color: #009900;">&#41;</span> putchar<span style="color: #009900;">&#40;</span>sign<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
			<span style="color: #b1b100;">else</span> putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">' '</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>		
		<span style="color: #009900;">&#125;</span>
		putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В файле figure.c содержатся две функции — <span class="geshifilter"><code class="c geshifilter-c">rect<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">diagonals<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. Первая принимает в качестве аргументов символ и два числа и "рисует" на экране с помощью указанного символа прямоугольник заданной ширины и высоты. Вторая функция выводит на экране две диагонали квадрата ("рисует" крестик).</p>
<p>Файл text.c:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">void</span> text <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ch<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span><span style="color: #339933;">*</span>ch<span style="color: #339933;">++</span> <span style="color: #339933;">!=</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #009900;">&#41;</span> putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'*'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	putchar<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'<span style="color: #000099; font-weight: bold;">\n</span>'</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В файле text.c определена единственная функция, принимающая указатель на символ строки. Функция выводит на экране звездочки в количестве, соответствующем длине указанной строки.</p>
<p>Файл mylib.h:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">void</span> rect <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> sign<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> width<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> height<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> diagonals <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> sign<span style="color: #339933;">,</span> <span style="color: #993333;">int</span> width<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #993333;">void</span> text <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>ch<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Заголовочный файл можно создать в каталоге source, но мы лучше сохраним его там, где будут библиотеки. В данном случае это на уровень выше (каталог library). Тем самым как бы подчеркивается, что файлы исходных кодов после создания из них библиотеки вообще не нужны пользователям библиотек, они нужны лишь разработчику библиотеки. А вот заголовочный файл библиотеки требуется для ее правильного использования.</p>
<h4>Создание статической библиотеки</h4>
<p>Статическую библиотеку создать проще, поэтому начнем с нее. Она создается из обычных объектных файлов путем их архивации с помощью утилиты ar.</p>
<p>Все действия, которые описаны ниже выполняются в каталоге library (т.е. туда надо перейти командой cd). Просмотр содержимого каталога выполняется с помощью команды ls или ls -l.</p>
<p>Получаем объектные файлы:</p>
<pre>gcc -c ./source/*.c</pre><p>
В итоге в каталоге library должно наблюдаться следующее:</p>
<pre>figures.o  mylib.h  source  text.o</pre><p>
Далее используем утилиту ar для создания статической библиотеки:</p>
<pre>ar r libmy1.a *.o</pre><p>Параметр r позволяет вставить файлы в архив, если архива нет, то он создается. Далее указывается имя архива, после чего перечисляются файлы, из которых архив создается.</p>
<p>Объектные файлы нам не нужны, поэтому их можно удалить:</p>
<pre>rm *.o</pre><p>
В итоге содержимое каталога library должно выглядеть так:</p>
<pre>libmy1.a  mylib.h  source</pre><p>, где libmy1.a — это статическая библиотека.</p>
<h4>Создание динамической библиотеки</h4>
<p>Объектные файлы для динамической библиотеки компилируются особым образом. Они должны содержать так называемый позиционно-независимый код (position independent code). Наличие такого кода позволяет библиотеке подключаться к программе, когда последняя загружается в память. Это связано с тем, что библиотека и программа не являются единой программой, а значит как угодно могут располагаться в памяти относительно друг друга. Компиляция объектных файлов для динамической библиотеки должна выполняться с опцией -fPIC компилятора gcc:</p>
<pre>gcc -c -fPIC source/*.c</pre><p>
В отличие от статической библиотеки динамическую создают при помощи gcc указав опцию -shared:</p>
<pre>gcc -shared -o libmy2.so *.o</pre><p>
Использованные объектные файлы можно удалить:</p>
<pre>rm *.o</pre><p>
В итоге содержимое каталога library:</p>
<pre>libmy1.a  libmy2.so  mylib.h  source</pre><h3>Использование библиотеки в программе</h3>
<h4>Исходный код программы</h4>
<p>Теперь в каталоге project (который у нас находится на одном уровне файловой иерархии с library) создадим файлы проекта, который будет использовать созданную библиотеку. Поскольку сама программа будет состоять не из одного файла, то придется здесь также создать заголовочный файл.</p>
<p>Файл data.c:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &quot;../library/mylib.h&quot;</span>
&nbsp;
<span style="color: #993333;">void</span> data <span style="color: #009900;">&#40;</span><span style="color: #993333;">void</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">char</span> strs<span style="color: #009900;">&#91;</span>3<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#91;</span>30<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>prompts<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">3</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #ff0000;">&quot;Ваше имя: &quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;Местонахождение: &quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;Пунк прибытия: &quot;</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">int</span> i<span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span><span style="color: #0000dd;">3</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span> prompts<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		gets<span style="color: #009900;">&#40;</span>strs<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
&nbsp;
	diagonals<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'~'</span><span style="color: #339933;">,</span> 7<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
	<span style="color: #b1b100;">for</span> <span style="color: #009900;">&#40;</span>i<span style="color: #339933;">=</span><span style="color: #0000dd;">0</span><span style="color: #339933;">;</span> i<span style="color: #339933;">&lt;</span><span style="color: #0000dd;">3</span><span style="color: #339933;">;</span> i<span style="color: #339933;">++</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%s&quot;</span><span style="color: #339933;">,</span> prompts<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		text<span style="color: #009900;">&#40;</span>strs<span style="color: #009900;">&#91;</span>i<span style="color: #009900;">&#93;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Функция <span class="geshifilter"><code class="c geshifilter-c">data<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> запрашивает у пользователя данные, помещая их в массив <span class="monoi">strs</span>. Далее вызывает библиотечную функцию <span class="geshifilter"><code class="c geshifilter-c">diagonals<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которая выводит на экране "крестик". После этого на каждой итерации цикла вызывается библиотечная функция <span class="geshifilter"><code class="c geshifilter-c">text<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которой передается очередной элемент массива; функция <span class="geshifilter"><code class="c geshifilter-c">text<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выводит на экране звездочки в количестве равному длине переданной через указатель строки.</p>
<p>Обратите внимание на то, как подключается заголовочный файл библиотеки: через относительный адрес. Две точки обозначают переход в каталог на уровень выше, т.е. родительский по отношению к project, после чего путь продолжается во вложенный в родительский каталог library. Можно было бы указать абсолютный путь, например, "/home/sv/c/les_21/library/mylib.h". Однако при перемещении каталогов библиотеки и программы на другой компьютер или в другой каталог адрес был бы уже не верным. В случае с относительным адресом требуется лишь сохранять расположение каталогов project и library относительно друг друга.</p>
<p>Файл main.c:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
<span style="color: #339933;">#include &quot;../library/mylib.h&quot;</span>
<span style="color: #339933;">#include &quot;project.h&quot;</span>
&nbsp;
main <span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	rect<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'-'</span><span style="color: #339933;">,</span>75<span style="color: #339933;">,</span>4<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	data<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	rect<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">'+'</span><span style="color: #339933;">,</span>75<span style="color: #339933;">,</span>3<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div></p>
<p>Здесь два раза вызывается библиотечная функция <span class="geshifilter"><code class="c geshifilter-c">rect<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и один раз функция <span class="geshifilter"><code class="c geshifilter-c">data<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> из другого файла проекта. Чтобы сообщить функции <span class="geshifilter"><code class="c geshifilter-c">main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> прототип <span class="geshifilter"><code class="c geshifilter-c">data<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> также подключается заголовочный файл проекта.</p>
<p>Файл project.h содержит всего одну строчку:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #993333;">void</span> data <span style="color: #009900;">&#40;</span><span style="color: #993333;">void</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Из обоих файлов проекта с исходным кодом надо получить объектные файлы для объединения их потом с файлом библиотеки. Сначала мы получим исполняемый файл, содержащий статическую библиотеку, потом — связанный с динамической библиотекой. Однако с какой бы библиотекой мы не компоновали объектные файлы проекта, компилируются они как для статической, так и динамической библиотеки одинаково:</p>
<pre>gcc -c *.c</pre><p>
При этом не забудьте сделать каталог project текущим!</p>
<h4>Компиляция проекта со статической библиотекой</h4>
<p>Теперь в каталоге project есть два объектных файла: main.o и data.o. Их надо скомпилировать в исполняемый файл project, объединив со статической библиотекой libmy1.a. Делается это с помощью такой команды:</p>
<pre>gcc -o project *.o -L../library -lmy1</pre><p>
Начало команды должно быть понятно: опция -o указывает на то, что компилируется исполняемый файл project из объектных файлов.</p>
<p>Помимо объектных файлов проекта в компиляции участвует и библиотека. Об этом свидетельствует вторая часть команды: -L../library -lmy1. Здесь опция -L указывает на адрес каталога, где находится библиотека, он и следует сразу за ней. После опции -l записывается имя библиотеки, при этом префикс lib и суффикс (неважно .a или .so) усекаются. Обратите внимание, что после данных опций пробел не ставится.</p>
<p>Опцию -L можно не указывать, если библиотека располагается в стандартных для данной системы каталогах для библиотек. Например, в GNU/Linux это /lib/, /urs/lib/ и др.</p>
<p>Запустив исполняемый файл project и выполнив программу, мы увидим на экране примерно следующее:</p>
<p><img src="../../../img/c/project.png" width="610" height="336" alt="Результат выполнения программы" /></p>
<p>Посмотрим размер файла project:</p>
<pre>
sv@seven:~/c/les_21/project$ ls -l project 
-rwxrwxr-x 1 sv sv 8698 2012-04-03 10:21 project 
</pre><p>
Его размер равен 8698 байт.</p>
<h4>Компиляция проекта с динамической библиотекой</h4>
<p>Теперь удалим исполняемый файл и получим его уже связанным с динамической библиотекой. Команда компиляции с динамической библиотекой выглядит так:</p>
<pre>gcc -o project *.o -L../library -lmy2 -Wl,-rpath,../library/</pre><p>
Здесь в отличии от команды компиляции со статической библиотеки добавлены опции для линковщика: -Wl,-rpath,../library/. -Wl - это обращение к линковщику, -rpath - опция линковщика, ../library/ - значение опции. Получается, что в команде мы два раза указываем местоположение библиотеки: один раз с опцией -L, а второй раз с опцией -rpath. Видимо для того, чтобы понять, почему так следует делать, потребуется более основательно изучить процесс компиляции и компоновки программ на языке <span class="blue">C</span>.</p>
<p>Следует заметить, что если вы скомпилируете программу, используя приведенную команду, то исполняемый файл будет запускаться из командной строки только в том случае, если текущий каталог project. Стоит сменить каталог, будет возникать ошибка из-за того, что динамическая библиотека не будет найдена. Но если скомпилировать программу так:</p>
<pre>gcc -o project *.o -L../library -lmy2 -Wl,-rpath,/home/sv/c/les_21/library</pre><p>
, т.е. указать для линковщика абсолютный адрес, то программа в данной системе будет запускаться из любого каталога. </p>
<p>Размер исполняемого файла проекта, связанного с динамической библиотекой, получился равным 8604 байта. Это немного меньше, чем при компиляции проекта со статической библиотекой. Если посмотреть на размеры библиотек:</p>
<pre>
sv@seven:~/c/les_21/library$ ls -l libmy* 
-rw-rw-r-- 1 sv sv 3624 2012-04-02 10:54 libmy1.a 
-rwxrwxr-x 1 sv sv 7871 2012-04-02 11:16 libmy2.so
</pre><p>
, то видно, что динамическая больше статической, хотя исполняемый файл проекта со статической библиотекой больше. Это доказывает, что в исполняемом файле, связанном с динамической библиотекой, присутствует лишь ссылка на нее.</p>
<p><span class="blue"><strong>Задание</strong><br />
Придумайте и реализуйте проект на языке программирования C, в котором бы использовалась вами же написанная библиотека.</span></p>
  </div>
<div id="node-382" class="section-2">
  <h1 class="book-heading">Урок 22. Проверочная работа</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<p>Выполнение всех задания данного урока предполагает период времени выполнения более чем 1,5 часа. Поэтому если есть ограничения по времени, то оценка работы может выполняться по количеству набранных баллов. Приблизительные баллы указаны в скобках после каждого задания.</p>
<ol>
<li>Напишите программу, предназначенную для наглядной демонстрации различий между такими типами данных как <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span><span style="color: #339933;">,</span> <span style="color: #993333;">short</span><span style="color: #339933;">,</span> <span style="color: #993333;">int</span><span style="color: #339933;">,</span> <span style="color: #993333;">unsigned</span></code></span>. (7)</li>
<li>Значение какого из ниже представленных массивов совпадает со строкой "Zeitgeist"? Почему? (1)<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">arrA<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">9</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #ff0000;">'Z'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'e'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'i'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'t'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'g'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'e'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'i'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'s'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'t'</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span>
arrB<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #009900;">&#123;</span><span style="color: #ff0000;">'Z'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'e'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'i'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'t'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'g'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'e'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'i'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'s'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'t'</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">'<span style="color: #006699; font-weight: bold;">\0</span>'</span><span style="color: #009900;">&#125;</span><span style="color: #339933;">;</span></pre></div>
</li>
<li>Если массив arr содержит строку, то будут ли различаться значения, которые вернут функции <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">sizeof</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> и <span class="geshifilter"><code class="c geshifilter-c">strlen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>? (2)</li>
<li>Напишите код, в котором одной переменной присваивается введенное пользователем число, а второй переменной модуль этого числа. После этого значение второй переменной выводится на экран. Используйте условное выражение, а не инструкцию <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">if</span></code></span>. (4)</li>
<li>Переделайте условное выражение из 4-го задания в макрос. (2)</li>
<li>Объявлены и определены целочисленные переменные: <span class="geshifilter"><code class="c geshifilter-c">a <span style="color: #339933;">=</span> <span style="color: #0000dd;">10</span><span style="color: #339933;">,</span> b <span style="color: #339933;">=</span> <span style="color: #0000dd;">0</span><span style="color: #339933;">,</span> c <span style="color: #339933;">=</span> <span style="color: #339933;">-</span><span style="color: #0000dd;">3</span></code></span>. Определите их значения после выполнения следующих двух выражений, а также значения самих выражений: (2)<br />
<span class="geshifilter"><code class="c geshifilter-c">a<span style="color: #339933;">--</span> <span style="color: #339933;">+</span> <span style="color: #339933;">++</span>b<span style="color: #339933;">;</span> <span style="color: #339933;">--</span>c <span style="color: #339933;">+</span> b<span style="color: #339933;">--;</span></code></span> </li>
<li>Запрограммируйте вывод на экран символов так, как показано на рисунке. Используйте циклы <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #b1b100;">for</span></code></span>, а также если необходимо функцию <span class="geshifilter"><code class="c geshifilter-c">strcat<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>. (12)<br />
<img src="../../../img/c/cycle.png" width="654" height="97" alt="Таблица умножения из символов" />
</li>
<li>Напишите программу, которая определяет в процентном соотношении количество гласных и согласных букв в текстовом файле. Имя файла передается в программу через командную строку. (10)</li>
<li>Может ли одна ячейка памяти иметь несколько имен переменных? Может ли адрес определенной ячейки памяти содержаться во множестве переменных? Ответ поясните. (4)</li>
<li>Как изменить приведенную ниже программу так, чтобы среди параметров функции <span class="geshifilter"><code class="c geshifilter-c">sum<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> не было указателя, а функция возвращала значение, оставляя тем самым возможность изменить значение любой внешней переменной? (3)<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;"><span style="color: #339933;">#include &lt;stdio.h&gt;</span>
&nbsp;
<span style="color: #993333;">void</span> sum <span style="color: #009900;">&#40;</span><span style="color: #993333;">float</span> <span style="color: #339933;">*</span>base<span style="color: #339933;">,</span> <span style="color: #993333;">float</span> add<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
&nbsp;
main<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #993333;">float</span> a<span style="color: #339933;">=</span>100<span style="color: #339933;">,</span> b<span style="color: #339933;">;</span>
&nbsp;
	scanf<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%f&quot;</span><span style="color: #339933;">,</span> <span style="color: #339933;">&amp;</span>b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	sum<span style="color: #009900;">&#40;</span><span style="color: #339933;">&amp;</span>a<span style="color: #339933;">,</span> b<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%.4f<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> a<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span>
&nbsp;
<span style="color: #993333;">void</span> sum <span style="color: #009900;">&#40;</span><span style="color: #993333;">float</span> <span style="color: #339933;">*</span>base<span style="color: #339933;">,</span> <span style="color: #993333;">float</span> add<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
	<span style="color: #339933;">*</span>base <span style="color: #339933;">=</span> <span style="color: #339933;">*</span>base <span style="color: #339933;">+</span> add<span style="color: #339933;">/</span><span style="color: #0000dd;">2</span><span style="color: #339933;">;</span>
<span style="color: #009900;">&#125;</span></pre></div>
</li>
<li>Напишите программу, в которой массив заполняется случайными буквами английского алфавита; значения элементов массива в символьном представлении выводятся на экран. (4)</li>
<li>Напишите функцию, которая принимает указатели на два массива. Функция должна заполнять один массив 25-ю случайными четными числами, а другой — 25 нечетными. Продемонстрируйте ее работу. (6)</li>
<li>Пользователь вводит две строки, каждая строка состоит из двух слов, разделенных пробелом. Требуется сравнить строки лексикографически, начиная со второго слова (т.е. после пробела). Напишите программу, выполняющую описанную задачу. (6)</li>
<li>Пользователь вводит адреса сайтов и их ТИЦ. Данные о каждом сайте сохраняются в элементе динамической структуры. По команде пользователя данные записываются в файл, при этом память, выделенная под динамическую структуру, высвобождается. Далее пользователь может снова начать вводить информацию о сайтах, либо завершить выполнение программы. (25)</li>
</ol>
  </div>
</div>
    
  </body>
</html>
