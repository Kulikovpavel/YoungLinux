<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="ru" xml:lang="ru">
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Урок 14. Функции для обработки строк</title>
    <base href="" />
    <link type="text/css" rel="stylesheet" href="http://younglinux.info/misc/print.css" />
      </head>
  <body>
              <div class="section-1">
          
    <div id="node-374" class="section-2">
  <h1 class="book-heading">Урок 14. Функции для обработки строк</h1>
  <p class="right">Особенности языка С. Учебное пособие</p>
<h3>Особенности функций для работы со строками</h3>
<p>Языки программирования могут включать специальные функции для работы со строками, избавляя тем самым программиста от необходимости писать собственные функции обработки строк. Например, часто требуется определить длину строки, и поэтому в языках предусмотрена функция, измеряющая ее длину. </p>
<p>В языке программирования <span class="blue">C</span> функции для работы со строками объявляются в заголовочном файле string.h, который надо не забывать подключать к своему исходному коду. Существует около двадцати функций для работы со строками. Среди них есть те, которые осуществляют поиск символов в строке, функции сравнения, копирования строк, а также более специфические. Перечень и описание большинства существующих на данный момент в языке <span class="blue">C</span> функций можно найти в приложении книги Б. Кернигана, Д. Ритчи "Язык программирования <span class="blue">C</span>. Второе издание".</p>
<p>Все функции, объявленные в string.h, в процессе своей работы могут изменять или не изменять одну из переданных по указателю строк. Это зависит от назначения функции. Однако большинство из них что-то возвращают: либо указатель на символ, либо целое. При этом если функция меняет один из своих параметров и ради этого была вызвана, тогда то, что она возвращает, можно проигнорировать (т.е. ничему не присваивать в вызывающей функции).</p>
<p>Например, функция <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> имеет такое объявление: <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strcpy <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span></code></span>. Она копирует строку, на которую указывает второй параметр, в строку, на которую указывает первый параметр. Таким образом первый параметр изменяется. Кроме того, функция возвращает указатель на первый символ строки:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> s1<span style="color: #009900;">&#91;</span>10<span style="color: #009900;">&#93;</span><span style="color: #339933;">,</span> s2<span style="color: #009900;">&#91;</span>10<span style="color: #009900;">&#93;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>s3<span style="color: #339933;">;</span>
	s3 <span style="color: #339933;">=</span> s2<span style="color: #339933;">;</span>
&nbsp;
	gets<span style="color: #009900;">&#40;</span>s1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	s3 <span style="color: #339933;">=</span> strcpy<span style="color: #009900;">&#40;</span>s2<span style="color: #339933;">,</span>s1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>s2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>s3<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;%p, %p<span style="color: #000099; font-weight: bold;">\n</span>&quot;</span><span style="color: #339933;">,</span> s2<span style="color: #339933;">,</span> s3<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Здесь <span class="monoi">s2</span> и <span class="monoi">s3</span> указывают на один и тот же символ (<span class="geshifilter"><code class="c geshifilter-c"><span style="color: #000066;">printf</span><span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> выводит одинаковые адреса). Однако то, что возвращает <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, нельзя присвоить массиву. Результат работы этой функции обычно ничему не присваивают; бывает достаточно того, что она просто изменяет одну из переданных по указателю строк.</p>
<p>Другое дело, такие функции как <span class="geshifilter"><code class="c geshifilter-c">strlen<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> или <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которые не изменяют параметры, а вызываются ради результата. Функция <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> сравнивает две строки-аргумента по буквам (лексикографически) и возвращает 0, -1 или 1. Например, вызов <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;boy&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;body&quot;</span><span style="color: #009900;">&#41;</span></code></span> вернет 1, т.к. код буквы 'y' больше буквы 'd'. Вызов <span class="geshifilter"><code class="c geshifilter-c">strcmp<span style="color: #009900;">&#40;</span><span style="color: #ff0000;">&quot;body&quot;</span><span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;boy&quot;</span><span style="color: #009900;">&#41;</span></code></span> вернет -1, т.к. первый аргумент лексикографически меньше второго.</p>
<h3>Функция strtok()</h3>
<p>С помощью функции <span class="geshifilter"><code class="c geshifilter-c">strtok<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> можно разбить строку на отдельные части (лексемы). Объявление этой функции выглядит так <span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strtok <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span></code></span>. При первом вызове функции в качестве первого параметра указывается строка, которую требуется разбить. Вторым параметром указывается строка-разделитель. При последующих вызовах функции для этой же строки первым параметром должен быть NULL, т.к. функция уже "запомнила" с чем работает. Рассмотрим пример:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> str<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;one, two, three, four, five&quot;</span><span style="color: #339933;">;</span>
	<span style="color: #993333;">char</span> <span style="color: #339933;">*</span>sp<span style="color: #339933;">;</span>
&nbsp;
	sp <span style="color: #339933;">=</span> strtok<span style="color: #009900;">&#40;</span>str<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;, &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #b1b100;">while</span> <span style="color: #009900;">&#40;</span>sp<span style="color: #009900;">&#41;</span> <span style="color: #009900;">&#123;</span>
		puts<span style="color: #009900;">&#40;</span>sp<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
		sp <span style="color: #339933;">=</span> strtok<span style="color: #009900;">&#40;</span>NULL<span style="color: #339933;">,</span> <span style="color: #ff0000;">&quot;, &quot;</span><span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	<span style="color: #009900;">&#125;</span></pre></div></p>
<p>В результате выполнения данного кода на экран в столбик выводятся слова:</p>
<pre>
one
two
three
four
five
</pre><p>
При первом вызове <span class="geshifilter"><code class="c geshifilter-c">strtok<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> в функцию передается указатель на первый символ массива и строка-разделитель. После этого вызова массив <span class="monoi">str</span> изменяется, в нем остается только слово "one", также функция возвращает указатель на это слово, который присваивается <span class="monoi">sp</span>. </p>
<p>Хотя мы потеряли остаток массива в вызывающей функции, однако внутри <span class="geshifilter"><code class="c geshifilter-c">strtok<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> сохраняется указатель на остаток массива. Когда передается NULL, функция "знает", что надо работать с этим "хвостом".</p>
<h3>Копирование частей строк</h3>
<p>Когда требуется просто соединить две строки, то проблема легко решается с помощью вызова функции <span class="geshifilter"><code class="c geshifilter-c">strcat<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, которая к концу первого аргумента присоединяет второй. Похожая функция <span class="geshifilter"><code class="c geshifilter-c">strncat<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> присоединяет <span class="monoi">n</span> символов второй строки к первой. <span class="monoi">n</span> указывается в качестве третьего параметра.</p>
<p>Что если ситуация более сложная? Например, есть две непустые строки и надо соединить начало первой и конец второй. Сделать это можно с помощью функции <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span>, если передавать ссылки не на первые символы строк:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> s1<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">20</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Peter Smith&quot;</span><span style="color: #339933;">,</span> s2<span style="color: #009900;">&#91;</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;Julia Roberts&quot;</span><span style="color: #339933;">;</span>
	strcpy<span style="color: #009900;">&#40;</span>s1<span style="color: #339933;">+</span>5<span style="color: #339933;">,</span> s2<span style="color: #339933;">+</span>5<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>s1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>В данном случае на экране будет выведено "Peter Roberts". Почему так произошло? В функцию <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> был передан указатель на шестой символ первой строки. Это привело к тому, что при копировании символы этой строки затираются только начиная с 6-го, т.к. <span class="geshifilter"><code class="c geshifilter-c">strcpy<span style="color: #009900;">&#40;</span><span style="color: #009900;">&#41;</span></code></span> о предыдущих символах ничего не "знает". В качестве второго аргумента также передается только часть строки, которая и копируется в первую.</p>
<p>Как вставить одну строку в середину другой? Можно решить эту задачу, используя третью "буферную" строку, куда можно сначала скопировать первую строку, потом вторую, затерев конец первой, потом присоединить конец первой. Но можно поступить и так:<br />
<div class="geshifilter"><pre class="c geshifilter-c" style="font-family:monospace;">	<span style="color: #993333;">char</span> s1<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">20</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;one three&quot;</span><span style="color: #339933;">,</span> s2<span style="color: #009900;">&#91;</span><span style="color: #0000dd;">20</span><span style="color: #009900;">&#93;</span> <span style="color: #339933;">=</span> <span style="color: #ff0000;">&quot;two&quot;</span><span style="color: #339933;">;</span>
	strcpy<span style="color: #009900;">&#40;</span>s2<span style="color: #339933;">+</span>3<span style="color: #339933;">,</span> s1<span style="color: #339933;">+</span>3<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	strcpy<span style="color: #009900;">&#40;</span>s1<span style="color: #339933;">+</span>4<span style="color: #339933;">,</span> s2<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span>
	puts<span style="color: #009900;">&#40;</span>s1<span style="color: #009900;">&#41;</span><span style="color: #339933;">;</span></pre></div></p>
<p>Здесь сначала во вторую строку копируется конец первой, получается "two three". Затем в первую строку, минуя ее начало, копируется вторая.</p>
<h3>Описание некоторых функций для работы со строками</h3>
<p><span class="blue"><strong>Задание</strong><br />
Ниже представлены описания некоторых функций, выполняющих операции над строками. Придумайте и напишите маленькие программы, иллюстрирующие работу этих функций.</span></p>
<ul>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strchr <span style="color: #009900;">&#40;</span><span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">int</span> c<span style="color: #009900;">&#41;</span></code></span>. Возвращает указатель на первое вхождение символа <span class="monoi">с</span> в строку. Возвращает NULL, если такого символа в строке нет.</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strstr <span style="color: #009900;">&#40;</span><span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>s2<span style="color: #339933;">,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span>s1<span style="color: #009900;">&#41;</span></code></span>. Возвращает указатель на первое вхождение строки <span class="monoi">s1</span> в строку <span class="monoi">s2</span>. Если совпадений нет, возвращает NULL.</li>
<li><span class="geshifilter"><code class="c geshifilter-c"><span style="color: #993333;">char</span> <span style="color: #339933;">*</span>strncpy <span style="color: #009900;">&#40;</span><span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> size_t n<span style="color: #009900;">&#41;</span></code></span>. Копирует <span class="monoi">n</span> символов второй строки в первую.</li>
<li><span class="geshifilter"><code class="c geshifilter-c">size_t strspn <span style="color: #009900;">&#40;</span><span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*,</span> <span style="color: #993333;">const</span> <span style="color: #993333;">char</span> <span style="color: #339933;">*</span><span style="color: #009900;">&#41;</span></code></span>. Возвращает длину начала первой строки, в которую входят символы, из которых состоит вторая строка.</li>
</ul>
  </div>
    </div>
  </body>
</html>
